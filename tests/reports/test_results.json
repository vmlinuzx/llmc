{
  "timestamp": "2025-11-19T18:45:00Z",
  "branch": "fix/tests-compat-guardrails-v2",
  "commit": "183970e",
  "agent": "Ruthless Testing Agent",
  "summary": {
    "total_tests": 1201,
    "skipped": 1,
    "broken_files": 1,
    "estimated_failures": "100-150",
    "pass_rate": "~85-90%"
  },
  "critical_bugs": [
    {
      "id": "BUG-001",
      "severity": "CRITICAL",
      "component": "Data Pipeline",
      "title": "Graph enrichment data loss",
      "evidence": "0 entities in graph, 4418 in DB",
      "impact": "Graph RAG falls back to LOCAL_FALLBACK",
      "status": "BROKEN",
      "files_to_investigate": [
        "tools/rag/graph_enrich.py",
        "tools/rag/enrichment.py",
        "tools/rag/graph_index.py"
      ]
    },
    {
      "id": "BUG-002",
      "severity": "CRITICAL",
      "component": "CLI",
      "title": "CLI ModuleNotFoundError",
      "evidence": "Direct invocation failed with 'No module named tools'",
      "status": "FIXED",
      "fix": "Added PYTHONPATH setup in tools/rag_nav/cli.py"
    },
    {
      "id": "BUG-003",
      "severity": "MEDIUM",
      "component": "Testing",
      "title": "Test suite integrity",
      "evidence": "test_fuzzy_linking.py broken, test_rag_failures.py pattern violations",
      "impact": "Reduced test coverage",
      "status": "NEEDS_FIX"
    }
  ],
  "failed_test_files": [
    {
      "file": "test_enrichment_data_integration_failure.py",
      "failed": 5,
      "total": 6,
      "issues": ["Empty graph", "DB count mismatch", "API signature"]
    },
    {
      "file": "test_rag_failures.py",
      "failed": 6,
      "total": 6,
      "issues": ["pytest pattern violations (return True/False)"]
    },
    {
      "file": "test_rag_analytics.py",
      "failed": 16,
      "estimated_total": 16,
      "issues": ["Broken due to empty graph"]
    },
    {
      "file": "test_fuzzy_linking.py",
      "status": "BROKEN",
      "error": "Collection error",
      "impact": "Prevents running full test suite"
    }
  ],
  "graph_rag_status": {
    "wired": true,
    "evidence": [
      "CLI commands exposed: search, lineage, where-used",
      "API functions available: tool_rag_search, tool_rag_lineage, tool_rag_where_used",
      "Handlers implemented: tools/rag_nav/tool_handlers.py",
      "Adapters working: tools/rag/__init__.py",
      "End-to-end tested and functional"
    ],
    "caveat": "Falls back to LOCAL_FALLBACK due to empty graph"
  },
  "api_analysis": {
    "tools.rag.tool_rag_search": {
      "signature": "tool_rag_search(query: str, repo_root: Path, limit: int = 10)",
      "status": "CORRECT",
      "test_bug": "test_enrichment_data_integration_failure.py line 113 missing repo_root"
    },
    "tools.rag_nav.tool_handlers.tool_rag_search": {
      "signature": "tool_rag_search(repo_root, query: str, limit: Optional[int] = None)",
      "status": "CORRECT",
      "note": "Internal API, exposed via adapters"
    }
  },
  "static_analysis": {
    "mypy": {
      "missing_stubs": ["pytest", "click", "tiktoken", "numpy", "torch", "sentence_transformers", "tree_sitter", "tree_sitter_languages", "jsonschema"]
    },
    "ruff": {
      "violations": ["Import organization", "Deprecated top-level linter settings"]
    }
  },
  "recommendations": {
    "immediate": [
      "Investigate graph enrichment pipeline data flow",
      "Fix test_fuzzy_linking.py collection error",
      "Update test expectations (2426 â†’ 4418)"
    ],
    "short_term": [
      "Review all test failures",
      "Install missing type stubs",
      "Fix ruff configuration"
    ],
    "medium_term": [
      "Improve test design",
      "Add integration tests"
    ]
  }
}
