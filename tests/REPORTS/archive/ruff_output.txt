I001 [*] Import block is un-sorted or un-formatted
  --> llmc/commands/docs.py:5:1
   |
 3 |   """
 4 |
 5 | / import logging
 6 | | from pathlib import Path
 7 | | import sys
 8 | | import toml
 9 | | import typer
10 | |
11 | | from llmc.docgen.config import load_docgen_backend, get_output_dir, get_require_rag_fresh
12 | | from llmc.docgen.orchestrator import DocgenOrchestrator
13 | | from tools.rag.database import Database
   | |_______________________________________^
14 |
15 |   logger = logging.getLogger(__name__)
   |
help: Organize imports

F401 [*] `sys` imported but unused
 --> llmc/commands/docs.py:7:8
  |
5 | import logging
6 | from pathlib import Path
7 | import sys
  |        ^^^
8 | import toml
9 | import typer
  |
help: Remove unused import: `sys`

UP015 [*] Unnecessary mode argument
  --> llmc/commands/docs.py:37:28
   |
35 |         raise typer.Exit(1)
36 |     
37 |     with open(config_path, "r") as f:
   |                            ^^^
38 |         toml_data = toml.load(f)
   |
help: Remove mode argument

UP015 [*] Unnecessary mode argument
   --> llmc/commands/docs.py:114:28
    |
112 |         raise typer.Exit(1)
113 |     
114 |     with open(config_path, "r") as f:
    |                            ^^^
115 |         toml_data = toml.load(f)
    |
help: Remove mode argument

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> llmc/docgen/gating.py:167:9
    |
165 |       except ValueError:
166 |           # relative_to() raises ValueError if doc_path_resolved is not a child of output_base
167 | /         raise ValueError(
168 | |             f"Path traversal detected: {relative_path} resolves outside {output_dir}. "
169 | |             f"Attempted path: {doc_path_resolved}, allowed base: {output_base}"
170 | |         )
    | |_________^
171 |       
172 |       return doc_path_resolved
    |

I001 [*] Import block is un-sorted or un-formatted
  --> llmc/enrichment/__init__.py:1:1
   |
 1 | / from .classifier import (
 2 | |     FileClassifier,
 3 | |     PathWeightDecision,
 4 | |     classify_content_type,
 5 | |     compute_final_priority,
 6 | |     get_path_weight,
 7 | | )
 8 | | from .config import DEFAULT_PATH_WEIGHT, MAX_PATH_WEIGHT, MIN_PATH_WEIGHT, load_path_weight_map, validate_path_weight
   | |_____________________________________________________________________________________________________________________^
 9 |
10 |   __all__ = [
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> llmc/main.py:4:1
   |
 2 |   """LLMC Unified CLI - Main entry point."""
 3 |
 4 | / import typer
 5 | |
 6 | | from llmc.commands import service as service_commands
 7 | | from llmc.commands.init import init as init_command
 8 | | from llmc.commands.rag import (
 9 | |     benchmark,
10 | |     doctor,
11 | |     embed,
12 | |     enrich,
13 | |     export,
14 | |     graph,
15 | |     enrich_status,
16 | |     index,
17 | |     inspect,
18 | |     nav_lineage,
19 | |     nav_search,
20 | |     nav_where_used,
21 | |     plan,
22 | |     search,
23 | |     stats,
24 | |     # Phase 5: Advanced RAG
25 | |     sync,
26 | | )
27 | | from llmc.commands.tui import monitor, tui
28 | | from llmc.core import LLMC_VERSION, find_repo_root, load_config
   | |_______________________________________________________________^
29 |
30 |   app = typer.Typer(
   |
help: Organize imports

E402 Module level import not at top of file
   --> llmc/main.py:98:1
    |
 97 | # Docs subcommand group (Docgen v2)
 98 | from llmc.commands import docs as docs_commands
    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
 99 | docs_app = typer.Typer(
100 |     help="Documentation generation",
    |

I001 [*] Import block is un-sorted or un-formatted
   --> llmc/main.py:98:1
    |
 97 | # Docs subcommand group (Docgen v2)
 98 | from llmc.commands import docs as docs_commands
    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
 99 | docs_app = typer.Typer(
100 |     help="Documentation generation",
    |
help: Organize imports

F841 Local variable `path_str` is assigned to but never used
  --> llmc/routing/content_type.py:90:5
   |
88 |     # 0. ERP/Product check (High priority)
89 |     # Path heuristics
90 |     path_str = str(path).lower()
   |     ^^^^^^^^
91 |     is_erp_path = any(part in path.parts for part in ["erp", "pim", "products", "catalog"])
   |
help: Remove assignment to unused variable `path_str`

B007 Loop control variable `slice_id` not used within loop body
   --> llmc/routing/fusion.py:100:9
    |
 98 |     # 3. Convert back to list and sort
 99 |     final_results = []
100 |     for slice_id, (fused_score, res_obj) in merged_map.items():
    |         ^^^^^^^^
101 |         # Create a copy to avoid mutating input
102 |         final_res = res_obj.copy()
    |
help: Rename unused `slice_id` to `_slice_id`

I001 [*] Import block is un-sorted or un-formatted
  --> llmc_mcp/admin_tools.py:12:1
   |
10 |   """
11 |
12 | / import time
13 | | from dataclasses import asdict
14 | | from typing import Dict, List, Optional
15 | |
16 | | from .docgen_guard import DocgenCoordinator
17 | | from .locks import get_lock_manager
18 | | from .telemetry import get_telemetry_sink
   | |_________________________________________^
   |
help: Organize imports

UP035 `typing.Dict` is deprecated, use `dict` instead
  --> llmc_mcp/admin_tools.py:14:1
   |
12 | import time
13 | from dataclasses import asdict
14 | from typing import Dict, List, Optional
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
15 |
16 | from .docgen_guard import DocgenCoordinator
   |

UP035 `typing.List` is deprecated, use `list` instead
  --> llmc_mcp/admin_tools.py:14:1
   |
12 | import time
13 | from dataclasses import asdict
14 | from typing import Dict, List, Optional
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
15 |
16 | from .docgen_guard import DocgenCoordinator
   |

F401 [*] `typing.List` imported but unused
  --> llmc_mcp/admin_tools.py:14:26
   |
12 | import time
13 | from dataclasses import asdict
14 | from typing import Dict, List, Optional
   |                          ^^^^
15 |
16 | from .docgen_guard import DocgenCoordinator
   |
help: Remove unused import: `typing.List`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> llmc_mcp/admin_tools.py:21:22
   |
21 | def maasl_locks() -> Dict:
   |                      ^^^^
22 |     """
23 |     List all currently active MAASL locks.
   |
help: Replace with `dict`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> llmc_mcp/admin_tools.py:53:28
   |
53 | def maasl_stomp_stats() -> Dict:
   |                            ^^^^
54 |     """
55 |     Get aggregated MAASL contention and coordination statistics.
   |
help: Replace with `dict`

UP045 [*] Use `X | None` for type annotations
   --> llmc_mcp/admin_tools.py:112:18
    |
111 | def maasl_docgen_status(
112 |     coordinator: Optional[DocgenCoordinator] = None,
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
113 |     limit: int = 10
114 | ) -> Dict:
    |
help: Convert to `X | None`

UP006 [*] Use `dict` instead of `Dict` for type annotation
   --> llmc_mcp/admin_tools.py:114:6
    |
112 |     coordinator: Optional[DocgenCoordinator] = None,
113 |     limit: int = 10
114 | ) -> Dict:
    |      ^^^^
115 |     """
116 |     Get recent documentation generation operations.
    |
help: Replace with `dict`

I001 [*] Import block is un-sorted or un-formatted
  --> llmc_mcp/cli.py:3:1
   |
 1 |   """CLI for managing LLMC MCP daemon."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | import subprocess
 6 | | import sys
 7 | | from pathlib import Path
 8 | |
 9 | | import typer
10 | | from rich.console import Console
11 | | from rich.table import Table
   | |____________________________^
12 |
13 |   app = typer.Typer(
   |
help: Organize imports

F401 [*] `sys` imported but unused
 --> llmc_mcp/cli.py:6:8
  |
5 | import subprocess
6 | import sys
  |        ^^^
7 | from pathlib import Path
  |
help: Remove unused import: `sys`

PLW1510 [*] `subprocess.run` without explicit `check` argument
   --> llmc_mcp/cli.py:132:9
    |
131 |     if follow:
132 |         subprocess.run(["tail", "-f", str(logfile)])
    |         ^^^^^^^^^^^^^^
133 |     else:
134 |         subprocess.run(["tail", "-n", str(lines), str(logfile)])
    |
help: Add explicit `check=False`

PLW1510 [*] `subprocess.run` without explicit `check` argument
   --> llmc_mcp/cli.py:134:9
    |
132 |         subprocess.run(["tail", "-f", str(logfile)])
133 |     else:
134 |         subprocess.run(["tail", "-n", str(lines), str(logfile)])
    |         ^^^^^^^^^^^^^^
    |
help: Add explicit `check=False`

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> llmc_mcp/cli.py:185:9
    |
183 |     except Exception as e:
184 |         console.print(f"[red]âœ—[/] Health check failed: {e}")
185 |         raise typer.Exit(1)
    |         ^^^^^^^^^^^^^^^^^^^
    |

I001 [*] Import block is un-sorted or un-formatted
  --> llmc_mcp/daemon.py:3:1
   |
 1 |   """Daemon process manager for LLMC MCP server."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | import atexit
 6 | | import logging
 7 | | import os
 8 | | import signal
 9 | | import sys
10 | | from collections.abc import Callable
11 | | from pathlib import Path
12 | | from typing import Any
   | |______________________^
13 |
14 |   logger = logging.getLogger(__name__)
   |
help: Organize imports

UP015 [*] Unnecessary mode argument
   --> llmc_mcp/daemon.py:177:32
    |
176 |         # Redirect stdin to /dev/null
177 |         with open("/dev/null", "r") as devnull:
    |                                ^^^
178 |             os.dup2(devnull.fileno(), sys.stdin.fileno())
    |
help: Remove mode argument

I001 [*] Import block is un-sorted or un-formatted
  --> llmc_mcp/db_guard.py:12:1
   |
10 |   """
11 |
12 | / from __future__ import annotations
13 | |
14 | | from contextlib import contextmanager
15 | | import logging
16 | | import sqlite3
17 | | import time
18 | | from typing import Iterator, Optional
19 | |
20 | | from llmc_mcp.maasl import DbBusyError, get_maasl, ResourceDescriptor
   | |_____________________________________________________________________^
21 |
22 |   logger = logging.getLogger("llmc-mcp.maasl.db_guard")
   |
help: Organize imports

UP035 [*] Import from `collections.abc` instead: `Iterator`
  --> llmc_mcp/db_guard.py:18:1
   |
16 | import sqlite3
17 | import time
18 | from typing import Iterator, Optional
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
19 |
20 | from llmc_mcp.maasl import DbBusyError, get_maasl, ResourceDescriptor
   |
help: Import from `collections.abc`

UP045 [*] Use `X | None` for type annotations
   --> llmc_mcp/db_guard.py:111:29
    |
109 |                 # Start transaction with retry logic for SQLite BUSY
110 |                 retries = 0
111 |                 last_error: Optional[Exception] = None
    |                             ^^^^^^^^^^^^^^^^^^^
112 |                 
113 |                 while retries <= self.max_retries:
    |
help: Convert to `X | None`

F841 [*] Local variable `e` is assigned to but never used
   --> llmc_mcp/db_guard.py:156:37
    |
154 |                         transaction_started = False
155 |                         
156 |                 except Exception as e:
    |                                     ^
157 |                     # Caller raised exception - rollback
158 |                     if transaction_started:
    |
help: Remove assignment to unused variable `e`

I001 [*] Import block is un-sorted or un-formatted
  --> llmc_mcp/docgen_guard.py:27:1
   |
25 |   """
26 |
27 | / import hashlib
28 | | import os
29 | | import tempfile
30 | | import time
31 | | from collections import deque
32 | | from dataclasses import dataclass, field
33 | | from pathlib import Path
34 | | from typing import Optional, Deque, List
35 | |
36 | | from .maasl import MAASL, ResourceDescriptor
   | |____________________________________________^
   |
help: Organize imports

UP035 `typing.Deque` is deprecated, use `collections.deque` instead
  --> llmc_mcp/docgen_guard.py:34:1
   |
32 | from dataclasses import dataclass, field
33 | from pathlib import Path
34 | from typing import Optional, Deque, List
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
35 |
36 | from .maasl import MAASL, ResourceDescriptor
   |

UP035 `typing.List` is deprecated, use `list` instead
  --> llmc_mcp/docgen_guard.py:34:1
   |
32 | from dataclasses import dataclass, field
33 | from pathlib import Path
34 | from typing import Optional, Deque, List
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
35 |
36 | from .maasl import MAASL, ResourceDescriptor
   |

UP045 [*] Use `X | None` for type annotations
  --> llmc_mcp/docgen_guard.py:44:15
   |
42 |     status: str  # "generated", "noop", "skipped", "error"
43 |     source_file: str
44 |     doc_path: Optional[str] = None
   |               ^^^^^^^^^^^^^
45 |     hash: Optional[str] = None
46 |     duration_ms: int = 0
   |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
  --> llmc_mcp/docgen_guard.py:45:11
   |
43 |     source_file: str
44 |     doc_path: Optional[str] = None
45 |     hash: Optional[str] = None
   |           ^^^^^^^^^^^^^
46 |     duration_ms: int = 0
47 |     error: Optional[str] = None
   |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
  --> llmc_mcp/docgen_guard.py:47:12
   |
45 |     hash: Optional[str] = None
46 |     duration_ms: int = 0
47 |     error: Optional[str] = None
   |            ^^^^^^^^^^^^^
48 |     agent_id: Optional[str] = None
49 |     session_id: Optional[str] = None
   |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
  --> llmc_mcp/docgen_guard.py:48:15
   |
46 |     duration_ms: int = 0
47 |     error: Optional[str] = None
48 |     agent_id: Optional[str] = None
   |               ^^^^^^^^^^^^^
49 |     session_id: Optional[str] = None
50 |     timestamp: float = field(default_factory=time.time)
   |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
  --> llmc_mcp/docgen_guard.py:49:17
   |
47 |     error: Optional[str] = None
48 |     agent_id: Optional[str] = None
49 |     session_id: Optional[str] = None
   |                 ^^^^^^^^^^^^^
50 |     timestamp: float = field(default_factory=time.time)
   |
help: Convert to `X | None`

UP006 [*] Use `collections.deque` instead of `Deque` for type annotation
  --> llmc_mcp/docgen_guard.py:85:24
   |
84 |         # Circular buffer for status tracking (thread-safe due to deque)
85 |         self._history: Deque[DocgenResult] = deque(maxlen=self.BUFFER_SIZE)
   |                        ^^^^^
86 |     
87 |     def compute_source_hash(self, source_path: str) -> str:
   |
help: Replace with `collections.deque`

UP045 [*] Use `X | None` for type annotations
   --> llmc_mcp/docgen_guard.py:131:48
    |
129 |         return self.docs_dir / doc_name
130 |     
131 |     def read_doc_hash(self, doc_path: Path) -> Optional[str]:
    |                                                ^^^^^^^^^^^^^
132 |         """
133 |         Extract SHA256 hash from existing doc header.
    |
help: Convert to `X | None`

UP024 [*] Replace aliased errors with `OSError`
   --> llmc_mcp/docgen_guard.py:151:16
    |
149 |                 if hash_part.endswith("-->"):
150 |                     return hash_part[:-3].strip()
151 |         except (IOError, IndexError):
    |                ^^^^^^^^^^^^^^^^^^^^^
152 |             pass
    |
help: Replace with builtin `OSError`

UP006 [*] Use `list` instead of `List` for type annotation
   --> llmc_mcp/docgen_guard.py:309:46
    |
307 |             raise
308 |     
309 |     def get_status(self, limit: int = 10) -> List[DocgenResult]:
    |                                              ^^^^
310 |         """
311 |         Get recent docgen operation history.
    |
help: Replace with `list`

I001 [*] Import block is un-sorted or un-formatted
  --> llmc_mcp/locks.py:12:1
   |
10 |   """
11 |
12 | / import threading
13 | | import time
14 | | from dataclasses import dataclass, field
15 | | from typing import Dict, Optional, List
16 | | import logging
17 | |
18 | | from llmc_mcp.telemetry import get_telemetry_sink
   | |_________________________________________________^
19 |
20 |   logger = logging.getLogger("llmc-mcp.maasl.locks")
   |
help: Organize imports

UP035 `typing.Dict` is deprecated, use `dict` instead
  --> llmc_mcp/locks.py:15:1
   |
13 | import time
14 | from dataclasses import dataclass, field
15 | from typing import Dict, Optional, List
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
16 | import logging
   |

UP035 `typing.List` is deprecated, use `list` instead
  --> llmc_mcp/locks.py:15:1
   |
13 | import time
14 | from dataclasses import dataclass, field
15 | from typing import Dict, Optional, List
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
16 | import logging
   |

UP045 [*] Use `X | None` for type annotations
  --> llmc_mcp/locks.py:32:22
   |
30 |     resource_key: str
31 |     mutex: threading.Lock = field(default_factory=threading.Lock)
32 |     holder_agent_id: Optional[str] = None
   |                      ^^^^^^^^^^^^^
33 |     holder_session_id: Optional[str] = None
34 |     lease_expiry_ts: float = 0.0  # epoch seconds
   |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
  --> llmc_mcp/locks.py:33:24
   |
31 |     mutex: threading.Lock = field(default_factory=threading.Lock)
32 |     holder_agent_id: Optional[str] = None
33 |     holder_session_id: Optional[str] = None
   |                        ^^^^^^^^^^^^^
34 |     lease_expiry_ts: float = 0.0  # epoch seconds
35 |     fencing_token: int = 0  # monotonic increasing
   |
help: Convert to `X | None`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> llmc_mcp/locks.py:80:22
   |
79 |     def __init__(self):
80 |         self._locks: Dict[str, LockState] = {}
   |                      ^^^^
81 |         self._global_lock = threading.Lock()  # Protects _locks dict
82 |         self._next_token = 1  # Global monotonic counter
   |
help: Replace with `dict`

UP006 [*] Use `list` instead of `List` for type annotation
   --> llmc_mcp/locks.py:316:27
    |
314 |         )
315 |     
316 |     def snapshot(self) -> List[Dict]:
    |                           ^^^^
317 |         """
318 |         Get snapshot of all active locks for introspection.
    |
help: Replace with `list`

UP006 [*] Use `dict` instead of `Dict` for type annotation
   --> llmc_mcp/locks.py:316:32
    |
314 |         )
315 |     
316 |     def snapshot(self) -> List[Dict]:
    |                                ^^^^
317 |         """
318 |         Get snapshot of all active locks for introspection.
    |
help: Replace with `dict`

UP045 [*] Use `X | None` for type annotations
   --> llmc_mcp/locks.py:351:26
    |
349 |         self,
350 |         resource_key: str,
351 |         holder_agent_id: Optional[str],
    |                          ^^^^^^^^^^^^^
352 |         holder_session_id: Optional[str],
353 |         wait_ms: float,
    |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
   --> llmc_mcp/locks.py:352:28
    |
350 |         resource_key: str,
351 |         holder_agent_id: Optional[str],
352 |         holder_session_id: Optional[str],
    |                            ^^^^^^^^^^^^^
353 |         wait_ms: float,
354 |         max_wait_ms: int,
    |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
   --> llmc_mcp/locks.py:383:16
    |
382 | # Global singleton instance
383 | _lock_manager: Optional[LockManager] = None
    |                ^^^^^^^^^^^^^^^^^^^^^
    |
help: Convert to `X | None`

PLW0603 Using the global statement to update `_lock_manager` is discouraged
   --> llmc_mcp/locks.py:388:12
    |
386 | def get_lock_manager() -> LockManager:
387 |     """Get or create global lock manager."""
388 |     global _lock_manager
    |            ^^^^^^^^^^^^^
389 |     if _lock_manager is None:
390 |         _lock_manager = LockManager()
    |

I001 [*] Import block is un-sorted or un-formatted
  --> llmc_mcp/maasl.py:12:1
   |
10 |   """
11 |
12 | / import time
13 | | from contextlib import contextmanager
14 | | from dataclasses import dataclass
15 | | from typing import Any, Callable, Dict, Iterator, List, Optional
16 | | import logging
17 | |
18 | | from llmc_mcp.locks import get_lock_manager, LockHandle, ResourceBusyError
19 | | from llmc_mcp.telemetry import get_telemetry_sink
   | |_________________________________________________^
20 |
21 |   logger = logging.getLogger("llmc-mcp.maasl")
   |
help: Organize imports

UP035 [*] Import from `collections.abc` instead: `Callable`, `Iterator`
  --> llmc_mcp/maasl.py:15:1
   |
13 | from contextlib import contextmanager
14 | from dataclasses import dataclass
15 | from typing import Any, Callable, Dict, Iterator, List, Optional
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
16 | import logging
   |
help: Import from `collections.abc`

UP035 `typing.Dict` is deprecated, use `dict` instead
  --> llmc_mcp/maasl.py:15:1
   |
13 | from contextlib import contextmanager
14 | from dataclasses import dataclass
15 | from typing import Any, Callable, Dict, Iterator, List, Optional
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
16 | import logging
   |

UP035 `typing.List` is deprecated, use `list` instead
  --> llmc_mcp/maasl.py:15:1
   |
13 | from contextlib import contextmanager
14 | from dataclasses import dataclass
15 | from typing import Any, Callable, Dict, Iterator, List, Optional
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
16 | import logging
   |

UP045 [*] Use `X | None` for type annotations
   --> llmc_mcp/maasl.py:99:32
    |
 97 |     }
 98 |     
 99 |     def __init__(self, config: Optional[Dict] = None):
    |                                ^^^^^^^^^^^^^^
100 |         """
101 |         Initialize policy registry.
    |
help: Convert to `X | None`

UP006 [*] Use `dict` instead of `Dict` for type annotation
   --> llmc_mcp/maasl.py:99:41
    |
 97 |     }
 98 |     
 99 |     def __init__(self, config: Optional[Dict] = None):
    |                                         ^^^^
100 |         """
101 |         Initialize policy registry.
    |
help: Replace with `dict`

UP045 [*] Use `X | None` for type annotations
   --> llmc_mcp/maasl.py:180:56
    |
178 | class DbBusyError(MAASLError):
179 |     """Database lock timeout."""
180 |     def __init__(self, description: str, sqlite_error: Optional[str] = None):
    |                                                        ^^^^^^^^^^^^^
181 |         self.description = description
182 |         self.sqlite_error = sqlite_error
    |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
   --> llmc_mcp/maasl.py:211:58
    |
209 | class MaaslInternalError(MAASLError):
210 |     """Unexpected internal error."""
211 |     def __init__(self, message: str, original_exception: Optional[Exception] = None):
    |                                                          ^^^^^^^^^^^^^^^^^^^
212 |         self.message = message
213 |         self.original_exception = original_exception
    |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
   --> llmc_mcp/maasl.py:224:41
    |
222 |     """
223 |     
224 |     def __init__(self, policy_registry: Optional[PolicyRegistry] = None):
    |                                         ^^^^^^^^^^^^^^^^^^^^^^^^
225 |         self.policy = policy_registry or PolicyRegistry()
226 |         self.lock_manager = get_lock_manager()
    |
help: Convert to `X | None`

UP006 [*] Use `list` instead of `List` for type annotation
   --> llmc_mcp/maasl.py:232:20
    |
230 |         self,
231 |         op: Callable[[], Any],
232 |         resources: List[ResourceDescriptor],
    |                    ^^^^
233 |         intent: str,
234 |         mode: str,
    |
help: Replace with `list`

UP006 [*] Use `list` instead of `List` for type annotation
   --> llmc_mcp/maasl.py:260:25
    |
258 |         """
259 |         start_time = time.time()
260 |         acquired_locks: List[LockHandle] = []
    |                         ^^^^
261 |         
262 |         try:
    |
help: Replace with `list`

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> llmc_mcp/maasl.py:353:13
    |
351 |               )
352 |               logger.exception(f"Unexpected error in stomp guard for {intent}")
353 | /             raise MaaslInternalError(
354 | |                 message=f"Unexpected error during {intent}: {str(e)}",
355 | |                 original_exception=e,
356 | |             )
    | |_____________^
357 |           
358 |           finally:
    |

UP006 [*] Use `list` instead of `List` for type annotation
   --> llmc_mcp/maasl.py:376:20
    |
374 |     def stomp_guard(
375 |         self,
376 |         resources: List[ResourceDescriptor],
    |                    ^^^^
377 |         intent: str,
378 |         mode: str,
    |
help: Replace with `list`

UP006 [*] Use `list` instead of `List` for type annotation
   --> llmc_mcp/maasl.py:381:19
    |
379 |         agent_id: str,
380 |         session_id: str,
381 |     ) -> Iterator[List[LockHandle]]:
    |                   ^^^^
382 |         """
383 |         Context manager for long-running protected sections.
    |
help: Replace with `list`

UP006 [*] Use `list` instead of `List` for type annotation
   --> llmc_mcp/maasl.py:411:25
    |
409 |         """
410 |         start_time = time.time()
411 |         acquired_locks: List[LockHandle] = []
    |                         ^^^^
412 |         success = False
413 |         error_type: Optional[str] = None
    |
help: Replace with `list`

UP045 [*] Use `X | None` for type annotations
   --> llmc_mcp/maasl.py:413:21
    |
411 |         acquired_locks: List[LockHandle] = []
412 |         success = False
413 |         error_type: Optional[str] = None
    |                     ^^^^^^^^^^^^^
414 |         
415 |         try:
    |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
   --> llmc_mcp/maasl.py:498:9
    |
497 | # Global singleton instance
498 | _maasl: Optional[MAASL] = None
    |         ^^^^^^^^^^^^^^^
    |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
   --> llmc_mcp/maasl.py:501:23
    |
501 | def get_maasl(config: Optional[Dict] = None) -> MAASL:
    |                       ^^^^^^^^^^^^^^
502 |     """Get or create global MAASL instance."""
503 |     global _maasl
    |
help: Convert to `X | None`

UP006 [*] Use `dict` instead of `Dict` for type annotation
   --> llmc_mcp/maasl.py:501:32
    |
501 | def get_maasl(config: Optional[Dict] = None) -> MAASL:
    |                                ^^^^
502 |     """Get or create global MAASL instance."""
503 |     global _maasl
    |
help: Replace with `dict`

PLW0603 Using the global statement to update `_maasl` is discouraged
   --> llmc_mcp/maasl.py:503:12
    |
501 | def get_maasl(config: Optional[Dict] = None) -> MAASL:
502 |     """Get or create global MAASL instance."""
503 |     global _maasl
    |            ^^^^^^
504 |     if _maasl is None:
505 |         policy = PolicyRegistry(config=config)
    |

UP006 [*] Use `dict` instead of `Dict` for type annotation
   --> llmc_mcp/maasl.py:510:29
    |
510 | def configure_maasl(config: Dict):
    |                             ^^^^
511 |     """Configure global MAASL instance."""
512 |     global _maasl
    |
help: Replace with `dict`

PLW0603 Using the global statement to update `_maasl` is discouraged
   --> llmc_mcp/maasl.py:512:12
    |
510 | def configure_maasl(config: Dict):
511 |     """Configure global MAASL instance."""
512 |     global _maasl
    |            ^^^^^^
513 |     policy = PolicyRegistry(config=config)
514 |     _maasl = MAASL(policy_registry=policy)
    |

I001 [*] Import block is un-sorted or un-formatted
  --> llmc_mcp/merge_meta.py:12:1
   |
10 |   """
11 |
12 | / from __future__ import annotations
13 | |
14 | | from dataclasses import dataclass, field
15 | | import logging
16 | | import time
17 | | from typing import Any, Dict, List, Optional, Set
18 | |
19 | | from llmc_mcp.maasl import get_maasl, ResourceDescriptor
   | |________________________________________________________^
20 |
21 |   logger = logging.getLogger("llmc-mcp.maasl.merge")
   |
help: Organize imports

UP035 `typing.Dict` is deprecated, use `dict` instead
  --> llmc_mcp/merge_meta.py:17:1
   |
15 | import logging
16 | import time
17 | from typing import Any, Dict, List, Optional, Set
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
18 |
19 | from llmc_mcp.maasl import get_maasl, ResourceDescriptor
   |

UP035 `typing.List` is deprecated, use `list` instead
  --> llmc_mcp/merge_meta.py:17:1
   |
15 | import logging
16 | import time
17 | from typing import Any, Dict, List, Optional, Set
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
18 |
19 | from llmc_mcp.maasl import get_maasl, ResourceDescriptor
   |

UP035 `typing.Set` is deprecated, use `set` instead
  --> llmc_mcp/merge_meta.py:17:1
   |
15 | import logging
16 | import time
17 | from typing import Any, Dict, List, Optional, Set
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
18 |
19 | from llmc_mcp.maasl import get_maasl, ResourceDescriptor
   |

F401 [*] `typing.Set` imported but unused
  --> llmc_mcp/merge_meta.py:17:47
   |
15 | import logging
16 | import time
17 | from typing import Any, Dict, List, Optional, Set
   |                                               ^^^
18 |
19 | from llmc_mcp.maasl import get_maasl, ResourceDescriptor
   |
help: Remove unused import: `typing.Set`

UP006 [*] Use `list` instead of `List` for type annotation
  --> llmc_mcp/merge_meta.py:31:19
   |
29 |     Used to batch multiple graph updates into a single atomic operation.
30 |     """
31 |     nodes_to_add: List[Dict[str, Any]] = field(default_factory=list)
   |                   ^^^^
32 |     edges_to_add: List[Dict[str, Any]] = field(default_factory=list)
33 |     properties_to_set: Dict[str, Dict[str, Any]] = field(default_factory=dict)  # {node_id: {key: value}}
   |
help: Replace with `list`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> llmc_mcp/merge_meta.py:31:24
   |
29 |     Used to batch multiple graph updates into a single atomic operation.
30 |     """
31 |     nodes_to_add: List[Dict[str, Any]] = field(default_factory=list)
   |                        ^^^^
32 |     edges_to_add: List[Dict[str, Any]] = field(default_factory=list)
33 |     properties_to_set: Dict[str, Dict[str, Any]] = field(default_factory=dict)  # {node_id: {key: value}}
   |
help: Replace with `dict`

UP006 [*] Use `list` instead of `List` for type annotation
  --> llmc_mcp/merge_meta.py:32:19
   |
30 |     """
31 |     nodes_to_add: List[Dict[str, Any]] = field(default_factory=list)
32 |     edges_to_add: List[Dict[str, Any]] = field(default_factory=list)
   |                   ^^^^
33 |     properties_to_set: Dict[str, Dict[str, Any]] = field(default_factory=dict)  # {node_id: {key: value}}
34 |     properties_to_clear: Dict[str, List[str]] = field(default_factory=dict)  # {node_id: [keys]}
   |
help: Replace with `list`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> llmc_mcp/merge_meta.py:32:24
   |
30 |     """
31 |     nodes_to_add: List[Dict[str, Any]] = field(default_factory=list)
32 |     edges_to_add: List[Dict[str, Any]] = field(default_factory=list)
   |                        ^^^^
33 |     properties_to_set: Dict[str, Dict[str, Any]] = field(default_factory=dict)  # {node_id: {key: value}}
34 |     properties_to_clear: Dict[str, List[str]] = field(default_factory=dict)  # {node_id: [keys]}
   |
help: Replace with `dict`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> llmc_mcp/merge_meta.py:33:24
   |
31 |     nodes_to_add: List[Dict[str, Any]] = field(default_factory=list)
32 |     edges_to_add: List[Dict[str, Any]] = field(default_factory=list)
33 |     properties_to_set: Dict[str, Dict[str, Any]] = field(default_factory=dict)  # {node_id: {key: value}}
   |                        ^^^^
34 |     properties_to_clear: Dict[str, List[str]] = field(default_factory=dict)  # {node_id: [keys]}
   |
help: Replace with `dict`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> llmc_mcp/merge_meta.py:33:34
   |
31 |     nodes_to_add: List[Dict[str, Any]] = field(default_factory=list)
32 |     edges_to_add: List[Dict[str, Any]] = field(default_factory=list)
33 |     properties_to_set: Dict[str, Dict[str, Any]] = field(default_factory=dict)  # {node_id: {key: value}}
   |                                  ^^^^
34 |     properties_to_clear: Dict[str, List[str]] = field(default_factory=dict)  # {node_id: [keys]}
   |
help: Replace with `dict`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> llmc_mcp/merge_meta.py:34:26
   |
32 |     edges_to_add: List[Dict[str, Any]] = field(default_factory=list)
33 |     properties_to_set: Dict[str, Dict[str, Any]] = field(default_factory=dict)  # {node_id: {key: value}}
34 |     properties_to_clear: Dict[str, List[str]] = field(default_factory=dict)  # {node_id: [keys]}
   |                          ^^^^
35 |     
36 |     def __post_init__(self):
   |
help: Replace with `dict`

UP006 [*] Use `list` instead of `List` for type annotation
  --> llmc_mcp/merge_meta.py:34:36
   |
32 |     edges_to_add: List[Dict[str, Any]] = field(default_factory=list)
33 |     properties_to_set: Dict[str, Dict[str, Any]] = field(default_factory=dict)  # {node_id: {key: value}}
34 |     properties_to_clear: Dict[str, List[str]] = field(default_factory=dict)  # {node_id: [keys]}
   |                                    ^^^^
35 |     
36 |     def __post_init__(self):
   |
help: Replace with `list`

UP006 [*] Use `list` instead of `List` for type annotation
  --> llmc_mcp/merge_meta.py:63:16
   |
61 |     properties_updated: int = 0
62 |     properties_cleared: int = 0
63 |     conflicts: List[str] = field(default_factory=list)
   |                ^^^^
64 |     error: Optional[str] = None
65 |     merge_timestamp: float = field(default_factory=time.time)
   |
help: Replace with `list`

UP045 [*] Use `X | None` for type annotations
  --> llmc_mcp/merge_meta.py:64:12
   |
62 |     properties_cleared: int = 0
63 |     conflicts: List[str] = field(default_factory=list)
64 |     error: Optional[str] = None
   |            ^^^^^^^^^^^^^
65 |     merge_timestamp: float = field(default_factory=time.time)
   |
help: Convert to `X | None`

UP006 [*] Use `list` instead of `List` for type annotation
   --> llmc_mcp/merge_meta.py:155:20
    |
153 |         properties_updated = 0
154 |         properties_cleared = 0
155 |         conflicts: List[str] = []
    |                    ^^^^
156 |         
157 |         try:
    |
help: Replace with `list`

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> llmc_mcp/te/process.py:155:9
    |
153 |         )
154 |     except Exception as e:
155 |         raise RuntimeError(f"Failed to start process: {e}")
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
156 |
157 |     # Create managed process
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> llmc_mcp/te/process.py:205:9
    |
203 |         mp.last_activity = time.time()
204 |     except Exception as e:
205 |         raise OSError(f"Failed to write to process {proc_id}: {e}")
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |

F401 [*] `typing.Any` imported but unused
  --> llmc_mcp/telemetry.py:10:20
   |
 8 | import logging
 9 | import time
10 | from typing import Any, Optional
   |                    ^^^
11 |
12 | logger = logging.getLogger("llmc-mcp.maasl")
   |
help: Remove unused import: `typing.Any`

UP045 [*] Use `X | None` for type annotations
  --> llmc_mcp/telemetry.py:84:26
   |
82 |         session_id: str,
83 |         max_wait_ms: int,
84 |         holder_agent_id: Optional[str] = None,
   |                          ^^^^^^^^^^^^^
85 |         holder_session_id: Optional[str] = None,
86 |     ):
   |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
  --> llmc_mcp/telemetry.py:85:28
   |
83 |         max_wait_ms: int,
84 |         holder_agent_id: Optional[str] = None,
85 |         holder_session_id: Optional[str] = None,
   |                            ^^^^^^^^^^^^^
86 |     ):
87 |         """Log lock acquisition timeout (contention)."""
   |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
   --> llmc_mcp/telemetry.py:137:16
    |
135 |         duration_ms: float,
136 |         success: bool,
137 |         error: Optional[str] = None,
    |                ^^^^^^^^^^^^^
138 |     ):
139 |         """Log database write operation."""
    |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
   --> llmc_mcp/telemetry.py:194:16
    |
192 |         agent_id: str,
193 |         session_id: str,
194 |         error: Optional[str] = None,
    |                ^^^^^^^^^^^^^
195 |     ):
196 |         """Log documentation generation event."""
    |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
   --> llmc_mcp/telemetry.py:233:21
    |
231 |         duration_ms: float,
232 |         success: bool,
233 |         error_type: Optional[str] = None,
    |                     ^^^^^^^^^^^^^
234 |     ):
235 |         """Log high-level call_with_stomp_guard invocation."""
    |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
   --> llmc_mcp/telemetry.py:259:18
    |
258 | # Global singleton instance
259 | _telemetry_sink: Optional[TelemetrySink] = None
    |                  ^^^^^^^^^^^^^^^^^^^^^^^
    |
help: Convert to `X | None`

PLW0603 Using the global statement to update `_telemetry_sink` is discouraged
   --> llmc_mcp/telemetry.py:264:12
    |
262 | def get_telemetry_sink() -> TelemetrySink:
263 |     """Get or create global telemetry sink."""
264 |     global _telemetry_sink
    |            ^^^^^^^^^^^^^^^
265 |     if _telemetry_sink is None:
266 |         _telemetry_sink = TelemetrySink()
    |

PLW0603 Using the global statement to update `_telemetry_sink` is discouraged
   --> llmc_mcp/telemetry.py:272:12
    |
270 | def configure_telemetry(enabled: bool = True):
271 |     """Configure global telemetry sink."""
272 |     global _telemetry_sink
    |            ^^^^^^^^^^^^^^^
273 |     _telemetry_sink = TelemetrySink(enabled=enabled)
    |

E402 Module level import not at top of file
   --> llmc_mcp/tools/fs.py:400:1
    |
398 | # ============================================================================
399 |
400 | import hashlib
    | ^^^^^^^^^^^^^^
401 | import shutil
    |

E402 Module level import not at top of file
   --> llmc_mcp/tools/fs.py:401:1
    |
400 | import hashlib
401 | import shutil
    | ^^^^^^^^^^^^^
    |

I001 [*] Import block is un-sorted or un-formatted
  --> llmc_mcp/tools/fs_protected.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from pathlib import Path
11 | | from typing import Any
12 | |
13 | | from llmc_mcp.maasl import get_maasl, ResourceDescriptor, ResourceBusyError
14 | | from llmc_mcp.tools.fs import (
15 | |     FsResult,
16 | |     write_file as _write_file_unprotected,
17 | |     edit_block as _edit_block_unprotected,
18 | |     move_file as _move_file_unprotected,
19 | |     delete_file as _delete_file_unprotected,
20 | |     validate_path,
21 | | )
   | |_^
   |
help: Organize imports

F401 [*] `typing.Any` imported but unused
  --> llmc_mcp/tools/fs_protected.py:11:20
   |
10 | from pathlib import Path
11 | from typing import Any
   |                    ^^^
12 |
13 | from llmc_mcp.maasl import get_maasl, ResourceDescriptor, ResourceBusyError
   |
help: Remove unused import: `typing.Any`

F401 `psutil` imported but unused; consider using `importlib.util.find_spec` to test for availability
   --> llmc_mcp/tools/linux_ops/proc.py:193:16
    |
191 |     # Try psutil first, fall back to shell
192 |     try:
193 |         import psutil
    |                ^^^^^^
194 |
195 |         processes = _list_processes_psutil(user)
    |
help: Remove unused import: `psutil`

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> llmc_mcp/tools/linux_ops/proc.py:265:9
    |
263 |         os.kill(pid, 0)  # Signal 0 just checks existence
264 |     except ProcessLookupError:
265 |         raise ProcessNotFoundError(f"Process {pid} not found")
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
266 |     except PermissionError:
267 |         # Process exists but we can't signal it
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> llmc_mcp/tools/linux_ops/proc.py:291:9
    |
289 |         }
290 |     except ProcessLookupError:
291 |         raise ProcessNotFoundError(f"Process {pid} no longer exists")
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
292 |     except PermissionError as e:
293 |         raise PermissionDeniedError(f"Permission denied killing pid {pid}: {e}")
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> llmc_mcp/tools/linux_ops/proc.py:293:9
    |
291 |         raise ProcessNotFoundError(f"Process {pid} no longer exists")
292 |     except PermissionError as e:
293 |         raise PermissionDeniedError(f"Permission denied killing pid {pid}: {e}")
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
294 |     except Exception as e:
295 |         logger.error(f"Failed to kill pid {pid}: {e}")
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> llmc_mcp/tools/linux_ops/proc.py:345:9
    |
343 |         mp = start_process(command=command, cwd=cwd, env=env)
344 |     except ValueError as e:
345 |         raise InvalidArgumentError(str(e))
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
346 |     except RuntimeError as e:
347 |         raise ProcessStartError(str(e))
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> llmc_mcp/tools/linux_ops/proc.py:347:9
    |
345 |         raise InvalidArgumentError(str(e))
346 |     except RuntimeError as e:
347 |         raise ProcessStartError(str(e))
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
348 |
349 |     # Read initial output
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> llmc_mcp/tools/linux_ops/proc.py:387:9
    |
385 |         return {"acknowledged": True}
386 |     except KeyError:
387 |         raise ProcessNotFoundError(f"Process not found: {proc_id}")
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
388 |     except OSError as e:
389 |         return {"acknowledged": False, "error": str(e)}
    |

F401 `psutil` imported but unused; consider using `importlib.util.find_spec` to test for availability
   --> llmc_mcp/tools/linux_ops/sysinfo.py:206:16
    |
204 |     # Try psutil first
205 |     try:
206 |         import psutil
    |                ^^^^^^
207 |
208 |         snapshot = _get_snapshot_psutil()
    |
help: Remove unused import: `psutil`

F401 [*] `tools.rag.config.load_config` imported but unused
  --> llmc_mcp/tools/rag.py:85:38
   |
84 |         # Config reloads automatically every time (no caching)
85 |         from tools.rag.config import load_config
   |                                      ^^^^^^^^^^^
86 |
87 |         # Direct import - module stays loaded between calls
   |
help: Remove unused import: `tools.rag.config.load_config`

F401 [*] `tools.rag.config.load_config` imported but unused
   --> llmc_mcp/tools/rag.py:171:38
    |
170 |         # Config reloads automatically every time (no caching)
171 |         from tools.rag.config import load_config
    |                                      ^^^^^^^^^^^
172 |
173 |         # For now, we'll use the existing search_spans with debug=True to get graph data
    |
help: Remove unused import: `tools.rag.config.load_config`

I001 [*] Import block is un-sorted or un-formatted
  --> llmc_mcp/tools/rag_protected.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from collections.abc import Callable
11 | | import logging
12 | | from pathlib import Path
13 | | from typing import Any
14 | |
15 | | from llmc_mcp.db_guard import get_db_transaction_manager
16 | | from llmc_mcp.maasl import DbBusyError, get_maasl, ResourceDescriptor
   | |_____________________________________________________________________^
17 |
18 |   logger = logging.getLogger("llmc-mcp.rag.protected")
   |
help: Organize imports

F401 [*] `llmc_mcp.db_guard.get_db_transaction_manager` imported but unused
  --> llmc_mcp/tools/rag_protected.py:15:31
   |
13 | from typing import Any
14 |
15 | from llmc_mcp.db_guard import get_db_transaction_manager
   |                               ^^^^^^^^^^^^^^^^^^^^^^^^^^
16 | from llmc_mcp.maasl import DbBusyError, get_maasl, ResourceDescriptor
   |
help: Remove unused import: `llmc_mcp.db_guard.get_db_transaction_manager`

F401 [*] `llmc_mcp.maasl.DbBusyError` imported but unused
  --> llmc_mcp/tools/rag_protected.py:16:28
   |
15 | from llmc_mcp.db_guard import get_db_transaction_manager
16 | from llmc_mcp.maasl import DbBusyError, get_maasl, ResourceDescriptor
   |                            ^^^^^^^^^^^
17 |
18 | logger = logging.getLogger("llmc-mcp.rag.protected")
   |
help: Remove unused import: `llmc_mcp.maasl.DbBusyError`

E402 Module level import not at top of file
  --> llmc_mcp/tools/test_code_exec.py:19:1
   |
17 | Tool = MockTool
18 |
19 | from llmc_mcp.tools.code_exec import execute_code, generate_stubs
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |

I001 [*] Import block is un-sorted or un-formatted
  --> llmc_mcp/transport/auth.py:3:1
   |
 1 |   """API key authentication middleware for HTTP transport."""
 2 |
 3 | / from __future__ import annotations
 4 | |
 5 | | import logging
 6 | | import os
 7 | | import secrets
 8 | | from pathlib import Path
 9 | | from typing import TYPE_CHECKING
10 | |
11 | | from starlette.middleware.base import BaseHTTPMiddleware
12 | | from starlette.responses import JSONResponse
   | |____________________________________________^
13 |
14 |   if TYPE_CHECKING:
   |
help: Organize imports

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
  --> llmcwrapper/llmcwrapper/adapter.py:51:21
   |
49 |                     info(yellow("[WARN] " + msg + " (force)"))
50 |                 else:
51 |                     raise AdapterError(msg)
   |                     ^^^^^^^^^^^^^^^^^^^^^^^
52 |     else:
53 |         raise AdapterError(f"Unknown mode: {mode}")
   |

F841 Local variable `existing_doc` is assigned to but never used
  --> scripts/docgen_stub.py:23:5
   |
21 |     file_sha256 = data.get("file_sha256")
22 |     source_contents = data.get("source_contents", "")
23 |     existing_doc = data.get("existing_doc_contents")
   |     ^^^^^^^^^^^^
24 |     graph_context = data.get("graph_context")
   |
help: Remove assignment to unused variable `existing_doc`

B007 Loop control variable `i` not used within loop body
  --> scripts/docgen_stub.py:43:13
   |
41 |         doc_lines.append("")
42 |         doc_lines.append("```")
43 |         for i, line in enumerate(lines[:10], 1):
   |             ^
44 |             doc_lines.append(line)
45 |         if len(lines) > 10:
   |
help: Rename unused `i` to `_i`

F541 [*] f-string without any placeholders
  --> scripts/docgen_stub.py:59:22
   |
57 |         doc_lines.append("")
58 |     
59 |     doc_lines.append(f"**Generated by:** docgen_stub.py")
   |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
60 |     doc_lines.append(f"**Repository:** {repo_root}")
   |
help: Remove extraneous `f` prefix

I001 [*] Import block is un-sorted or un-formatted
  --> scripts/maasl_stress_test.py:13:1
   |
11 |   """
12 |
13 | / import argparse
14 | | import multiprocessing as mp
15 | | import random
16 | | import tempfile
17 | | import time
18 | | from pathlib import Path
19 | | from typing import List
20 | | import sys
   | |__________^
21 |
22 |   # Add repo root to path
   |
help: Organize imports

UP035 `typing.List` is deprecated, use `list` instead
  --> scripts/maasl_stress_test.py:19:1
   |
17 | import time
18 | from pathlib import Path
19 | from typing import List
   | ^^^^^^^^^^^^^^^^^^^^^^^
20 | import sys
   |

I001 [*] Import block is un-sorted or un-formatted
  --> scripts/maasl_stress_test.py:25:1
   |
23 |   sys.path.insert(0, str(Path(__file__).parent.parent))
24 |
25 | / from llmc_mcp.maasl import call_with_stomp_guard
26 | | from llmc_mcp.locks import LockManager
27 | | from llmc_mcp.telemetry import TelemetrySink
   | |____________________________________________^
   |
help: Organize imports

F401 [*] `llmc_mcp.locks.LockManager` imported but unused
  --> scripts/maasl_stress_test.py:26:28
   |
25 | from llmc_mcp.maasl import call_with_stomp_guard
26 | from llmc_mcp.locks import LockManager
   |                            ^^^^^^^^^^^
27 | from llmc_mcp.telemetry import TelemetrySink
   |
help: Remove unused import: `llmc_mcp.locks.LockManager`

F401 [*] `llmc_mcp.telemetry.TelemetrySink` imported but unused
  --> scripts/maasl_stress_test.py:27:32
   |
25 | from llmc_mcp.maasl import call_with_stomp_guard
26 | from llmc_mcp.locks import LockManager
27 | from llmc_mcp.telemetry import TelemetrySink
   |                                ^^^^^^^^^^^^^
   |
help: Remove unused import: `llmc_mcp.telemetry.TelemetrySink`

B023 Function definition does not bind loop variable `target_file`
  --> scripts/maasl_stress_test.py:58:31
   |
56 |                 # Simulate file edit with MAASL protection
57 |                 def edit_file():
58 |                     content = target_file.read_text()
   |                               ^^^^^^^^^^^
59 |                     lines = content.split('\n')
60 |                     # Increment value
   |

B023 Function definition does not bind loop variable `target_file`
  --> scripts/maasl_stress_test.py:65:21
   |
63 |                             current = int(line.split('=')[1].strip())
64 |                             lines[i] = f'value = {current + 1}'
65 |                     target_file.write_text('\n'.join(lines))
   |                     ^^^^^^^^^^^
66 |                     return True
   |

UP006 [*] Use `list` instead of `List` for type annotation
   --> scripts/maasl_stress_test.py:161:30
    |
161 | def analyze_results(results: List[dict]):
    |                              ^^^^
162 |     """Analyze and report test results."""
163 |     print("\n" + "=" * 70)
    |
help: Replace with `list`

F541 [*] f-string without any placeholders
   --> scripts/maasl_stress_test.py:173:11
    |
171 |         all_waits.extend(r['lock_waits'])
172 |     
173 |     print(f"\nðŸ“Š Operations Summary:")
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
174 |     print(f"  Total operations:     {total_ops}")
175 |     print(f"  Total errors:         {total_errors}")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> scripts/maasl_stress_test.py:185:15
    |
183 |         p99 = all_waits[int(len(all_waits) * 0.99)]
184 |         
185 |         print(f"\nâ±ï¸  Lock Wait Times:")
    |               ^^^^^^^^^^^^^^^^^^^^^^^^
186 |         print(f"  Min:    {min(all_waits):.2f}ms")
187 |         print(f"  P50:    {p50:.2f}ms")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> scripts/maasl_stress_test.py:192:11
    |
190 |         print(f"  Max:    {max(all_waits):.2f}ms")
191 |     
192 |     print(f"\nðŸ¤– Per-Agent Breakdown:")
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
193 |     for r in results:
194 |         print(f"  Agent {r['agent_id']}: {r['operations']} ops, "
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> scripts/maasl_stress_test.py:201:11
    |
200 |     # Success criteria check
201 |     print(f"\nâœ… Success Criteria:")
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
202 |     success = True
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> scripts/maasl_stress_test.py:212:15
    |
211 |     if total_errors == 0:
212 |         print(f"  âœ… Zero errors")
    |               ^^^^^^^^^^^^^^^^^^^
213 |     else:
214 |         print(f"  âŒ {total_errors} errors occurred")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> scripts/maasl_stress_test.py:218:15
    |
217 |     if total_ops > 0:
218 |         print(f"  âœ… Operations completed successfully")
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
219 |     else:
220 |         print(f"  âŒ No operations completed")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> scripts/maasl_stress_test.py:220:15
    |
218 |         print(f"  âœ… Operations completed successfully")
219 |     else:
220 |         print(f"  âŒ No operations completed")
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
221 |         success = False
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> scripts/maasl_stress_test.py:246:11
    |
244 |     args = parser.parse_args()
245 |     
246 |     print(f"\nðŸš€ Starting MAASL Stress Test")
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
247 |     print(f"   Agents:   {args.agents}")
248 |     print(f"   Duration: {args.duration}s")
    |
help: Remove extraneous `f` prefix

E402 Module level import not at top of file
  --> scripts/migrate_fts5_no_stopwords.py:25:1
   |
23 | sys.path.insert(0, str(REPO_ROOT))
24 |
25 | from tools.rag.database import Database
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
26 | from tools.rag.config import index_path_for_read
   |

I001 [*] Import block is un-sorted or un-formatted
  --> scripts/migrate_fts5_no_stopwords.py:25:1
   |
23 |   sys.path.insert(0, str(REPO_ROOT))
24 |
25 | / from tools.rag.database import Database
26 | | from tools.rag.config import index_path_for_read
   | |________________________________________________^
   |
help: Organize imports

E402 Module level import not at top of file
  --> scripts/migrate_fts5_no_stopwords.py:26:1
   |
25 | from tools.rag.database import Database
26 | from tools.rag.config import index_path_for_read
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |

F541 [*] f-string without any placeholders
  --> scripts/migrate_fts5_no_stopwords.py:66:15
   |
65 |         print(f"  âœ… Migration complete! Indexed {count} enrichments")
66 |         print(f"  ðŸŽ¯ Keyword 'model' is now searchable!")
   |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
67 |         
68 |     except Exception as e:
   |
help: Remove extraneous `f` prefix

E722 Do not use bare `except`
   --> scripts/rag/index_workspace.py:160:9
    |
158 |             self.collection = self.client.get_collection(COLLECTION_NAME)
159 |             print(f"âœ… Loaded existing collection: {COLLECTION_NAME}")
160 |         except:
    |         ^^^^^^
161 |             self.collection = self.client.create_collection(
162 |                 name=COLLECTION_NAME, metadata={"description": "Workspace code embeddings"}
    |

E722 Do not use bare `except`
   --> scripts/rag/index_workspace.py:187:9
    |
185 |             if file_path.stat().st_size > 1_000_000:  # 1MB
186 |                 return False
187 |         except:
    |         ^^^^^^
188 |             return False
    |

E722 Do not use bare `except`
   --> scripts/rag/index_workspace.py:197:9
    |
195 |             relative = file_path.relative_to(self.workspace_root)
196 |             return str(relative.parts[0]) if relative.parts else "unknown"
197 |         except:
    |         ^^^^^^
198 |             return "unknown"
    |

E722 Do not use bare `except`
   --> scripts/rag/index_workspace.py:210:9
    |
208 |                 "last_modified": datetime.fromtimestamp(last_commit.committed_date).isoformat(),
209 |             }
210 |         except:
    |         ^^^^^^
211 |             return None
    |

E722 Do not use bare `except`
   --> scripts/rag/index_workspace.py:231:9
    |
229 |                 hasher.update(f.read())
230 |             return hasher.hexdigest()
231 |         except:
    |         ^^^^^^
232 |             return ""
    |

E722 Do not use bare `except`
   --> scripts/rag/index_workspace.py:323:17
    |
321 |                     if not str(rel).startswith(project_filter):
322 |                         continue
323 |                 except:
    |                 ^^^^^^
324 |                     continue
    |

E402 Module level import not at top of file
  --> scripts/rag/watch_workspace.py:24:1
   |
23 | EXCLUDE_DIRS = {".git", "__pycache__", ".venv", "node_modules", "dist", "build", ".rag", ".llmc"}
24 | from watchdog.events import FileSystemEventHandler
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
25 | from watchdog.observers import Observer
   |

E402 Module level import not at top of file
  --> scripts/rag/watch_workspace.py:25:1
   |
23 | EXCLUDE_DIRS = {".git", "__pycache__", ".venv", "node_modules", "dist", "build", ".rag", ".llmc"}
24 | from watchdog.events import FileSystemEventHandler
25 | from watchdog.observers import Observer
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |

E722 Do not use bare `except`
  --> scripts/rag/watch_workspace.py:52:13
   |
50 |                 if not str(rel).startswith(self.project_filter):
51 |                     return False
52 |             except:
   |             ^^^^^^
53 |                 return False
   |

F401 `_setup_path` imported but unused; consider using `importlib.util.find_spec` to test for availability
 --> scripts/rag_plan_snippet.py:7:12
  |
6 | try:
7 |     import _setup_path
  |            ^^^^^^^^^^^
8 | except ImportError:
9 |     pass
  |
help: Remove unused import: `_setup_path`

F401 `_setup_path` imported but unused; consider using `importlib.util.find_spec` to test for availability
  --> scripts/rag_quality_check.py:20:12
   |
19 | try:
20 |     import _setup_path
   |            ^^^^^^^^^^^
21 | except ImportError:
22 |     pass
   |
help: Remove unused import: `_setup_path`

E402 Module level import not at top of file
  --> scripts/test_code_first_fix.py:21:1
   |
19 | sys.path.insert(0, str(project_root))
20 |
21 | from tools.rag.database import Database
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |

F541 [*] f-string without any placeholders
  --> scripts/test_code_first_fix.py:67:11
   |
66 |     # Show first 10 files
67 |     print(f"\nðŸ“ First 10 files in sample:")
   |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
68 |     for i, item in enumerate(items[:10], 1):
69 |         print(f"   {i:2d}. {item.file_path} (type={item.slice_type})")
   |
help: Remove extraneous `f` prefix

E402 Module level import not at top of file
  --> scripts/test_model_search_fix.py:14:1
   |
12 | sys.path.insert(0, str(repo_root))
13 |
14 | from tools.rag.search import search_spans
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
15 |
16 | # Test 1: Direct search
   |

E402 Module level import not at top of file
  --> scripts/test_model_search_fix.py:40:1
   |
38 | print("="*60)
39 |
40 | from tools.rag.config import load_config
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
41 |
42 | config_file = repo_root / "llmc.toml"
   |

E402 Module level import not at top of file
  --> scripts/test_model_search_fix.py:54:1
   |
53 | # Load and check
54 | import time
   | ^^^^^^^^^^^
55 | time.sleep(0.1)
56 | config = load_config(repo_root)
   |

I001 [*] Import block is un-sorted or un-formatted
  --> scripts/test_model_search_fix.py:54:1
   |
53 | # Load and check
54 | import time
   | ^^^^^^^^^^^
55 | time.sleep(0.1)
56 | config = load_config(repo_root)
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> scripts/verify_docgen_phase1.py:7:1
   |
 5 |   """
 6 |
 7 | / import toml
 8 | | from pathlib import Path
 9 | | from llmc.docgen import load_docgen_backend, DocgenResult
10 | | from llmc.docgen.config import get_output_dir, get_require_rag_fresh
   | |____________________________________________________________________^
   |
help: Organize imports

UP015 [*] Unnecessary mode argument
  --> scripts/verify_docgen_phase1.py:23:26
   |
22 |     print(f"\nðŸ“„ Loading config from: {toml_path}")
23 |     with open(toml_path, "r") as f:
   |                          ^^^
24 |         toml_data = toml.load(f)
   |
help: Remove mode argument

F541 [*] f-string without any placeholders
  --> scripts/verify_docgen_phase1.py:30:11
   |
28 |     backend = load_docgen_backend(repo_root, toml_data)
29 |     print(f"   Backend loaded: {backend}")
30 |     print(f"   (None is expected since enabled=false)")
   |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
31 |     
32 |     # Test helper functions
   |
help: Remove extraneous `f` prefix

E402 Module level import not at top of file
  --> scripts/verify_idle_throttling.py:17:1
   |
15 | sys.path.insert(0, str(repo_root))
16 |
17 | from tools.rag.service import FailureTracker, RAGService, ServiceState
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |

E721 Use `is` and `is not` for type comparisons, or `isinstance()` for isinstance checks
  --> scripts/verify_idle_throttling.py:68:12
   |
66 |         return_annotation = sig.return_annotation
67 |         print(f"   Return type: {return_annotation}")
68 |         if return_annotation == bool:
   |            ^^^^^^^^^^^^^^^^^^^^^^^^^
69 |             print("   âœ“ Correct return type annotation")
70 |         else:
   |

F841 Local variable `event` is assigned to but never used
   --> tests/REPORTS/adversarial_enrichment_test.py:148:13
    |
146 |         # Test with negative confidence
147 |         try:
148 |             event = EnrichmentRouterMetricsEvent(
    |             ^^^^^
149 |                 timestamp=1234567890,
150 |                 query="test",
    |
help: Remove assignment to unused variable `event`

I001 [*] Import block is un-sorted or un-formatted
  --> tests/docgen/test_config.py:5:1
   |
 3 |   """
 4 |
 5 | / import pytest
 6 | |
 7 | | from llmc.docgen.config import (
 8 | |     DocgenConfigError,
 9 | |     get_output_dir,
10 | |     get_require_rag_fresh,
11 | |     load_docgen_backend,
12 | | )
13 | | from pathlib import Path
   | |________________________^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> tests/docgen/test_gating.py:5:1
   |
 3 |   """
 4 |
 5 | / import hashlib
 6 | | import pytest
 7 | | import sqlite3
 8 | | import tempfile
 9 | | from pathlib import Path
10 | |
11 | | from llmc.docgen.gating import (
12 | |     compute_file_sha256,
13 | |     read_doc_sha256,
14 | |     should_skip_sha_gate,
15 | |     resolve_doc_path,
16 | |     check_rag_freshness,
17 | | )
   | |_^
   |
help: Organize imports

F401 [*] `sqlite3` imported but unused
 --> tests/docgen/test_gating.py:7:8
  |
5 | import hashlib
6 | import pytest
7 | import sqlite3
  |        ^^^^^^^
8 | import tempfile
9 | from pathlib import Path
  |
help: Remove unused import: `sqlite3`

F401 [*] `tempfile` imported but unused
 --> tests/docgen/test_gating.py:8:8
  |
6 | import pytest
7 | import sqlite3
8 | import tempfile
  |        ^^^^^^^^
9 | from pathlib import Path
  |
help: Remove unused import: `tempfile`

I001 [*] Import block is un-sorted or un-formatted
 --> tests/security/test_path_traversal.py:7:1
  |
5 |   """
6 |
7 | / import pytest
8 | | from pathlib import Path
  | |________________________^
  |
help: Organize imports

F401 [*] `pytest` imported but unused
 --> tests/security/test_path_traversal.py:7:8
  |
5 | """
6 |
7 | import pytest
  |        ^^^^^^
8 | from pathlib import Path
  |
help: Remove unused import: `pytest`

F401 [*] `pathlib.Path` imported but unused
 --> tests/security/test_path_traversal.py:8:21
  |
7 | import pytest
8 | from pathlib import Path
  |                     ^^^^
  |
help: Remove unused import: `pathlib.Path`

B007 Loop control variable `malicious_path` not used within loop body
  --> tests/security/test_path_traversal.py:23:9
   |
21 |     ]
22 |     
23 |     for malicious_path in malicious_paths:
   |         ^^^^^^^^^^^^^^
24 |         # TODO: Replace with actual code under test
25 |         # with pytest.raises(ValueError, match="path.*invalid"):
   |
help: Rename unused `malicious_path` to `_malicious_path`

B007 Loop control variable `path` not used within loop body
  --> tests/security/test_path_traversal.py:45:9
   |
43 |     ]
44 |     
45 |     for path in tricky_paths:
   |         ^^^^
46 |         # TODO: Verify these are blocked after normalization
47 |         pass
   |
help: Rename unused `path` to `_path`

B007 Loop control variable `path` not used within loop body
  --> tests/security/test_path_traversal.py:57:9
   |
55 |     ]
56 |     
57 |     for path in null_byte_paths:
   |         ^^^^
58 |         # TODO: Verify null bytes are rejected
59 |         pass
   |
help: Rename unused `path` to `_path`

B007 Loop control variable `path` not used within loop body
  --> tests/security/test_path_traversal.py:70:9
   |
68 |     ]
69 |     
70 |     for path in absolute_paths:
   |         ^^^^
71 |         # TODO: Verify absolute paths outside repo are blocked
72 |         pass
   |
help: Rename unused `path` to `_path`

F401 `textual.widgets.Static` imported but unused; consider using `importlib.util.find_spec` to test for availability
  --> tests/smoke_analytics_screen.py:10:33
   |
 8 | try:
 9 |     from textual.app import App
10 |     from textual.widgets import Static
   |                                 ^^^^^^
11 |
12 |     from llmc.tui.screens.analytics import AnalyticsScreen
   |
help: Remove unused import: `textual.widgets.Static`

F841 Local variable `errored` is assigned to but never used
  --> tests/test_analyzer.py:42:5
   |
40 |     passed = 0
41 |     failed = 0
42 |     errored = 0
   |     ^^^^^^^
43 |
44 |     for line in lines:
   |
help: Remove assignment to unused variable `errored`

F841 Local variable `result` is assigned to but never used
  --> tests/test_cli_contracts.py:57:9
   |
55 |         """Test that --jsonl and --jsonl-compact cannot be used together."""
56 |         # Both jsonl flags together might be invalid
57 |         result = runner.invoke(cli, ["nav", "search", "--jsonl", "--jsonl-compact", "test query"])
   |         ^^^^^^
58 |
59 |         # May or may not error, but both compact flags should be handled
   |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
  --> tests/test_cli_contracts.py:91:17
   |
89 |                 mock_search.return_value = mock_result
90 |
91 |                 result = runner.invoke(
   |                 ^^^^^^
92 |                     cli, ["nav", "search", "test query", "--repo", str(repo_root)]
93 |                 )
   |
help: Remove assignment to unused variable `result`

E712 Avoid equality comparisons to `False`; use `not route.use_rag:` for false checks
   --> tests/test_context_gateway_edge_cases.py:348:16
    |
346 |         route = mock_compute_route(repo_root, status=None)
347 |         assert route.freshness_state == "UNKNOWN"
348 |         assert route.use_rag == False
    |                ^^^^^^^^^^^^^^^^^^^^^^
349 |
350 |     def test_compute_route_no_status_module(self, tmp_path: Path):
    |
help: Replace with `not route.use_rag`

E712 Avoid equality comparisons to `False`; use `not route.use_rag:` for false checks
   --> tests/test_context_gateway_edge_cases.py:364:16
    |
362 |         route = mock_compute_route(Path("/tmp"), status)
363 |         assert route.freshness_state == "STALE"
364 |         assert route.use_rag == False
    |                ^^^^^^^^^^^^^^^^^^^^^^
365 |
366 |     def test_compute_route_fresh_matching_head(self, tmp_path: Path):
    |
help: Replace with `not route.use_rag`

E712 Avoid equality comparisons to `True`; use `route.use_rag:` for truth checks
   --> tests/test_context_gateway_edge_cases.py:377:20
    |
375 |             route = mock_compute_route(Path("/tmp"), status)
376 |             assert route.freshness_state == "FRESH"
377 |             assert route.use_rag == True
    |                    ^^^^^^^^^^^^^^^^^^^^^
378 |
379 |     def test_compute_route_fresh_mismatched_head_is_stale(self, tmp_path: Path):
    |
help: Replace with `route.use_rag`

E712 Avoid equality comparisons to `False`; use `not route.use_rag:` for false checks
   --> tests/test_context_gateway_edge_cases.py:390:20
    |
388 |             route = mock_compute_route(Path("/tmp"), status)
389 |             assert route.freshness_state == "STALE"
390 |             assert route.use_rag == False
    |                    ^^^^^^^^^^^^^^^^^^^^^^
391 |
392 |     def test_compute_route_missing_git_head(self, tmp_path: Path):
    |
help: Replace with `not route.use_rag`

E712 Avoid equality comparisons to `False`; use `not route.use_rag:` for false checks
   --> tests/test_context_gateway_edge_cases.py:403:20
    |
401 |             route = mock_compute_route(Path("/tmp"), status)
402 |             assert route.freshness_state == "UNKNOWN"
403 |             assert route.use_rag == False
    |                    ^^^^^^^^^^^^^^^^^^^^^^
404 |
405 |     def test_compute_route_missing_last_indexed_commit(self, tmp_path: Path):
    |
help: Replace with `not route.use_rag`

E712 Avoid equality comparisons to `False`; use `not route.use_rag:` for false checks
   --> tests/test_context_gateway_edge_cases.py:416:20
    |
414 |             route = mock_compute_route(Path("/tmp"), status)
415 |             assert route.freshness_state == "UNKNOWN"
416 |             assert route.use_rag == False
    |                    ^^^^^^^^^^^^^^^^^^^^^^
417 |
418 |     def test_compute_route_case_insensitive_fresh(self, tmp_path: Path):
    |
help: Replace with `not route.use_rag`

E712 Avoid equality comparisons to `False`; use `not route.use_rag:` for false checks
   --> tests/test_context_gateway_edge_cases.py:440:16
    |
438 |         route = mock_compute_route(Path("/tmp"), status)
439 |         assert route.freshness_state == "STALE"
440 |         assert route.use_rag == False
    |                ^^^^^^^^^^^^^^^^^^^^^^
441 |
442 |     def test_compute_route_non_fresh_variations(self, tmp_path: Path):
    |
help: Replace with `not route.use_rag`

E712 Avoid equality comparisons to `False`; use `not route.use_rag:` for false checks
   --> tests/test_context_gateway_edge_cases.py:452:20
    |
451 |             route = mock_compute_route(Path("/tmp"), status)
452 |             assert route.use_rag == False
    |                    ^^^^^^^^^^^^^^^^^^^^^^
453 |
454 |     def test_compute_route_returns_route_decision(self, tmp_path: Path):
    |
help: Replace with `not route.use_rag`

E712 Avoid equality comparisons to `False`; use `not route.use_rag:` for false checks
   --> tests/test_context_gateway_edge_cases.py:481:20
    |
479 |             route = compute_route(repo_root)
480 |             assert route.freshness_state == "UNKNOWN"
481 |             assert route.use_rag == False
    |                    ^^^^^^^^^^^^^^^^^^^^^^
482 |
483 |     def test_compute_route_partial_status_data(self, tmp_path: Path):
    |
help: Replace with `not route.use_rag`

F841 Local variable `route` is assigned to but never used
   --> tests/test_context_gateway_edge_cases.py:498:13
    |
496 |             status.last_indexed_commit = "abc123"
497 |
498 |             route = mock_compute_route(Path("/tmp"), status)
    |             ^^^^^
499 |             # Should handle git errors gracefully
    |
help: Remove assignment to unused variable `route`

F841 Local variable `route` is assigned to but never used
   --> tests/test_context_gateway_edge_cases.py:511:9
    |
510 |         start = time.time()
511 |         route = mock_compute_route(Path("/tmp"), None)
    |         ^^^^^
512 |         elapsed = time.time() - start
    |
help: Remove assignment to unused variable `route`

B011 Do not `assert False` (`python -O` removes these calls), raise `AssertionError()`
   --> tests/test_context_gateway_edge_cases.py:574:20
    |
572 |             with open(graph_file) as f:
573 |                 json.load(f)
574 |             assert False, "Should fail to parse malformed JSON"
    |                    ^^^^^
575 |         except json.JSONDecodeError:
576 |             pass  # Expected
    |
help: Replace `assert False`

F841 Local variable `data` is assigned to but never used
   --> tests/test_context_gateway_edge_cases.py:717:17
    |
715 |         try:
716 |             with open(graph_file) as f:
717 |                 data = json.load(f)
    |                 ^^^^
718 |             assert False, "Should fail to read"
719 |         except PermissionError:
    |
help: Remove assignment to unused variable `data`

B011 Do not `assert False` (`python -O` removes these calls), raise `AssertionError()`
   --> tests/test_context_gateway_edge_cases.py:718:20
    |
716 |             with open(graph_file) as f:
717 |                 data = json.load(f)
718 |             assert False, "Should fail to read"
    |                    ^^^^^
719 |         except PermissionError:
720 |             pass  # Expected
    |
help: Replace `assert False`

F841 Local variable `route` is assigned to but never used
   --> tests/test_context_gateway_edge_cases.py:749:13
    |
748 |             start = time.time()
749 |             route = compute_route(repo_root)
    |             ^^^^^
750 |             elapsed = time.time() - start
    |
help: Remove assignment to unused variable `route`

F841 Local variable `route` is assigned to but never used
   --> tests/test_context_gateway_edge_cases.py:776:13
    |
774 |             mock_load.return_value = None
775 |
776 |             route = compute_route(repo_root)
    |             ^^^^^
777 |             # Should work with git
    |
help: Remove assignment to unused variable `route`

F841 Local variable `route` is assigned to but never used
   --> tests/test_context_gateway_edge_cases.py:835:13
    |
833 |             status.last_indexed_commit = "abc123"
834 |
835 |             route = mock_compute_route(Path("/tmp"), status)
    |             ^^^^^
836 |             # Should handle git error gracefully
    |
help: Remove assignment to unused variable `route`

B011 Do not `assert False` (`python -O` removes these calls), raise `AssertionError()`
  --> tests/test_db_fts_basic.py:62:12
   |
60 |     except RagDbNotFound:
61 |         return
62 |     assert False, "Expected RagDbNotFound when no RAG DB exists"
   |            ^^^^^
   |
help: Replace `assert False`

I001 [*] Import block is un-sorted or un-formatted
 --> tests/test_docgen_path_traversal.py:2:1
  |
2 | / import pytest
3 | | from pathlib import Path
4 | | from llmc.docgen.gating import resolve_doc_path
  | |_______________________________________________^
5 |
6 |   def test_resolve_doc_path_traversal_blocked(tmp_path):
  |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
 --> tests/test_docgen_perf_ren.py:2:1
  |
2 | / import pytest
3 | | import json
4 | | import time
5 | | import sys
6 | | from pathlib import Path
  | |________________________^
7 |
8 |   # Try to import Database, if fails, skip tests
  |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> tests/test_docgen_perf_ren.py:16:1
   |
14 |     HAS_DATABASE = False
15 |
16 | from llmc.docgen.graph_context import build_graph_context
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
17 |
18 | class StubDatabase(Database):
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> tests/test_docgen_ren.py:2:1
   |
 2 | / import pytest
 3 | | import json
 4 | | import sys
 5 | | import subprocess
 6 | | from pathlib import Path
 7 | | from unittest.mock import MagicMock, patch
 8 | | from llmc.docgen.backends.shell import ShellDocgenBackend, DocgenResult
   | |_______________________________________________________________________^
 9 |
10 |   # Fixture to create a dummy script
   |
help: Organize imports

F401 [*] `json` imported but unused
 --> tests/test_docgen_ren.py:3:8
  |
2 | import pytest
3 | import json
  |        ^^^^
4 | import sys
5 | import subprocess
  |
help: Remove unused import: `json`

F401 [*] `subprocess` imported but unused
 --> tests/test_docgen_ren.py:5:8
  |
3 | import json
4 | import sys
5 | import subprocess
  |        ^^^^^^^^^^
6 | from pathlib import Path
7 | from unittest.mock import MagicMock, patch
  |
help: Remove unused import: `subprocess`

F401 [*] `unittest.mock.MagicMock` imported but unused
 --> tests/test_docgen_ren.py:7:27
  |
5 | import subprocess
6 | from pathlib import Path
7 | from unittest.mock import MagicMock, patch
  |                           ^^^^^^^^^
8 | from llmc.docgen.backends.shell import ShellDocgenBackend, DocgenResult
  |
help: Remove unused import

F401 [*] `unittest.mock.patch` imported but unused
 --> tests/test_docgen_ren.py:7:38
  |
5 | import subprocess
6 | from pathlib import Path
7 | from unittest.mock import MagicMock, patch
  |                                      ^^^^^
8 | from llmc.docgen.backends.shell import ShellDocgenBackend, DocgenResult
  |
help: Remove unused import

F401 [*] `llmc.docgen.backends.shell.DocgenResult` imported but unused
  --> tests/test_docgen_ren.py:8:60
   |
 6 | from pathlib import Path
 7 | from unittest.mock import MagicMock, patch
 8 | from llmc.docgen.backends.shell import ShellDocgenBackend, DocgenResult
   |                                                            ^^^^^^^^^^^^
 9 |
10 | # Fixture to create a dummy script
   |
help: Remove unused import: `llmc.docgen.backends.shell.DocgenResult`

I001 [*] Import block is un-sorted or un-formatted
 --> tests/test_docgen_ruthless.py:1:1
  |
1 | / import pytest
2 | | import time
3 | | import os
4 | | from pathlib import Path
5 | | from unittest.mock import MagicMock, patch
6 | | from llmc.docgen.orchestrator import DocgenOrchestrator, DocgenResult, DocgenBackend
7 | | from llmc.docgen.locks import DocgenLock
  | |________________________________________^
8 |
9 |   class MockBackend(DocgenBackend):
  |
help: Organize imports

F401 [*] `time` imported but unused
 --> tests/test_docgen_ruthless.py:2:8
  |
1 | import pytest
2 | import time
  |        ^^^^
3 | import os
4 | from pathlib import Path
  |
help: Remove unused import: `time`

F401 [*] `os` imported but unused
 --> tests/test_docgen_ruthless.py:3:8
  |
1 | import pytest
2 | import time
3 | import os
  |        ^^
4 | from pathlib import Path
5 | from unittest.mock import MagicMock, patch
  |
help: Remove unused import: `os`

F401 [*] `unittest.mock.patch` imported but unused
 --> tests/test_docgen_ruthless.py:5:38
  |
3 | import os
4 | from pathlib import Path
5 | from unittest.mock import MagicMock, patch
  |                                      ^^^^^
6 | from llmc.docgen.orchestrator import DocgenOrchestrator, DocgenResult, DocgenBackend
7 | from llmc.docgen.locks import DocgenLock
  |
help: Remove unused import: `unittest.mock.patch`

I001 [*] Import block is un-sorted or un-formatted
  --> tests/test_docgen_ruthless.py:69:1
   |
67 |         orch.process_file(Path("src/test.py"), force=True)
68 |
69 | from llmc.docgen.gating import resolve_doc_path
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
 --> tests/test_docgen_ruthless_batch.py:1:1
  |
1 | / import pytest
2 | | from pathlib import Path
3 | | from unittest.mock import MagicMock
4 | | from llmc.docgen.orchestrator import DocgenOrchestrator, DocgenResult, DocgenBackend
  | |____________________________________________________________________________________^
5 |
6 |   @pytest.fixture
  |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
 --> tests/test_docgen_ruthless_config.py:2:1
  |
2 | / import pytest
3 | | from pathlib import Path
4 | | from llmc.docgen.backends.shell import load_shell_backend
  | |_________________________________________________________^
5 |
6 |   def test_load_shell_backend_allows_path_traversal(tmp_path):
  |
help: Organize imports

F401 [*] `pytest` imported but unused
 --> tests/test_docgen_ruthless_config.py:2:8
  |
2 | import pytest
  |        ^^^^^^
3 | from pathlib import Path
4 | from llmc.docgen.backends.shell import load_shell_backend
  |
help: Remove unused import: `pytest`

F401 [*] `pathlib.Path` imported but unused
 --> tests/test_docgen_ruthless_config.py:3:21
  |
2 | import pytest
3 | from pathlib import Path
  |                     ^^^^
4 | from llmc.docgen.backends.shell import load_shell_backend
  |
help: Remove unused import: `pathlib.Path`

I001 [*] Import block is un-sorted or un-formatted
 --> tests/test_docgen_ruthless_graph.py:1:1
  |
1 | / import pytest
2 | | import json
3 | | from pathlib import Path
4 | | from unittest.mock import MagicMock
5 | | from llmc.docgen.graph_context import build_graph_context, load_graph_indices
  | |_____________________________________________________________________________^
6 |
7 |   class StubDatabase:
  |
help: Organize imports

F401 [*] `json` imported but unused
 --> tests/test_docgen_ruthless_graph.py:2:8
  |
1 | import pytest
2 | import json
  |        ^^^^
3 | from pathlib import Path
4 | from unittest.mock import MagicMock
  |
help: Remove unused import: `json`

F401 [*] `unittest.mock.MagicMock` imported but unused
 --> tests/test_docgen_ruthless_graph.py:4:27
  |
2 | import json
3 | from pathlib import Path
4 | from unittest.mock import MagicMock
  |                           ^^^^^^^^^
5 | from llmc.docgen.graph_context import build_graph_context, load_graph_indices
  |
help: Remove unused import: `unittest.mock.MagicMock`

I001 [*] Import block is un-sorted or un-formatted
 --> tests/test_docgen_ruthless_lock.py:2:1
  |
2 | / import pytest
3 | | import fcntl
4 | | import time
5 | | from pathlib import Path
6 | | from unittest.mock import MagicMock, patch
7 | | from llmc.docgen.locks import DocgenLock
  | |________________________________________^
8 |
9 |   def test_docgen_lock_leak_on_timeout(tmp_path):
  |
help: Organize imports

F401 [*] `pytest` imported but unused
 --> tests/test_docgen_ruthless_lock.py:2:8
  |
2 | import pytest
  |        ^^^^^^
3 | import fcntl
4 | import time
  |
help: Remove unused import: `pytest`

F401 [*] `fcntl` imported but unused
 --> tests/test_docgen_ruthless_lock.py:3:8
  |
2 | import pytest
3 | import fcntl
  |        ^^^^^
4 | import time
5 | from pathlib import Path
  |
help: Remove unused import: `fcntl`

F401 [*] `time` imported but unused
 --> tests/test_docgen_ruthless_lock.py:4:8
  |
2 | import pytest
3 | import fcntl
4 | import time
  |        ^^^^
5 | from pathlib import Path
6 | from unittest.mock import MagicMock, patch
  |
help: Remove unused import: `time`

F401 [*] `pathlib.Path` imported but unused
 --> tests/test_docgen_ruthless_lock.py:5:21
  |
3 | import fcntl
4 | import time
5 | from pathlib import Path
  |                     ^^^^
6 | from unittest.mock import MagicMock, patch
7 | from llmc.docgen.locks import DocgenLock
  |
help: Remove unused import: `pathlib.Path`

F401 [*] `unittest.mock.MagicMock` imported but unused
 --> tests/test_docgen_ruthless_lock.py:6:27
  |
4 | import time
5 | from pathlib import Path
6 | from unittest.mock import MagicMock, patch
  |                           ^^^^^^^^^
7 | from llmc.docgen.locks import DocgenLock
  |
help: Remove unused import: `unittest.mock.MagicMock`

PLW2901 `with` statement variable `home` overwritten by assignment target
  --> tests/test_e2e_daemon_operation.py:29:9
   |
28 |     with tempfile.TemporaryDirectory() as home:
29 |         home = Path(home)
   |         ^^^^
30 |
31 |         # Create dummy job runner that logs calls
   |

F841 Local variable `registry` is assigned to but never used
  --> tests/test_e2e_daemon_operation.py:89:9
   |
88 |         # Create daemon components
89 |         registry = (
   |         ^^^^^^^^
90 |             RegistryAdapter(cfg.registry_path) if hasattr(RegistryAdapter, "__init__") else None
91 |         )
   |
help: Remove assignment to unused variable `registry`

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_e2e_daemon_operation.py:124:9
    |
122 |     """End-to-end test: daemon processes multiple repos."""
123 |     with tempfile.TemporaryDirectory() as home:
124 |         home = Path(home)
    |         ^^^^
125 |
126 |         # Create dummy runner
    |

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_e2e_daemon_operation.py:210:9
    |
208 |     """End-to-end test: daemon handles job failures correctly."""
209 |     with tempfile.TemporaryDirectory() as home:
210 |         home = Path(home)
    |         ^^^^
211 |
212 |         # Create failing runner
    |

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_e2e_daemon_operation.py:287:9
    |
285 |     """End-to-end test: control flags trigger immediate refresh."""
286 |     with tempfile.TemporaryDirectory() as home:
287 |         home = Path(home)
    |         ^^^^
288 |
289 |         # Create runner
    |

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_e2e_daemon_operation.py:376:9
    |
374 |     """End-to-end test: daemon state persists across restarts."""
375 |     with tempfile.TemporaryDirectory() as home:
376 |         home = Path(home)
    |         ^^^^
377 |
378 |         # Create runner
    |

F841 Local variable `scheduler2` is assigned to but never used
   --> tests/test_e2e_daemon_operation.py:440:9
    |
438 |         # Create second daemon instance (simulates restart)
439 |         workers2 = WorkerPool(cfg, state_store)
440 |         scheduler2 = Scheduler(cfg, registry_client, state_store, workers2)
    |         ^^^^^^^^^^
441 |
442 |         # Verify state persisted
    |
help: Remove assignment to unused variable `scheduler2`

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_e2e_daemon_operation.py:455:9
    |
453 |     """End-to-end test: daemon respects max_concurrent_jobs."""
454 |     with tempfile.TemporaryDirectory() as home:
455 |         home = Path(home)
    |         ^^^^
456 |
457 |         # Create slow runner
    |

PLW2901 `with` statement variable `temp_home` overwritten by assignment target
   --> tests/test_e2e_daemon_operation.py:531:9
    |
529 |     """End-to-end test using temporary HOME directory."""
530 |     with tempfile.TemporaryDirectory() as temp_home:
531 |         temp_home = Path(temp_home)
    |         ^^^^^^^^^
532 |
533 |         # Set up fake home environment
    |

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_e2e_daemon_operation.py:594:9
    |
592 |     """End-to-end test: shutdown flag stops daemon."""
593 |     with tempfile.TemporaryDirectory() as home:
594 |         home = Path(home)
    |         ^^^^
595 |
596 |         # This test would require a running daemon which is complex in pytest
    |

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_e2e_daemon_operation.py:621:9
    |
619 |     """End-to-end test: complete workflow from add to daemon processing."""
620 |     with tempfile.TemporaryDirectory() as home:
621 |         home = Path(home)
    |         ^^^^
622 |
623 |         # Step 1: Create job runner
    |

F841 Local variable `result` is assigned to but never used
  --> tests/test_e2e_operator_workflows.py:39:17
   |
37 |             if llmc_rag_repo.exists():
38 |                 # Try to register the repo
39 |                 result = subprocess.run(
   |                 ^^^^^^
40 |                     [str(llmc_rag_repo), "add", str(repo_path)],
41 |                     check=False,
   |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
  --> tests/test_e2e_operator_workflows.py:72:17
   |
71 |                 # Try to run with --help or check it fails gracefully
72 |                 result = subprocess.run(
   |                 ^^^^^^
73 |                     [str(cmw), "--repo", str(repo_path), "test"],
74 |                     check=False,
   |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
  --> tests/test_e2e_operator_workflows.py:94:17
   |
92 |             helper_script = Path(__file__).parent.parent / "scripts" / "rag_plan_helper.sh"
93 |             if helper_script.exists():
94 |                 result = subprocess.run(
   |                 ^^^^^^
95 |                     [str(helper_script), "--repo", str(repo_path)],
96 |                     check=False,
   |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_e2e_operator_workflows.py:133:17
    |
132 |                 # Test with --repo flag
133 |                 result = subprocess.run(
    |                 ^^^^^^
134 |                     [str(cw), "--repo", str(repo_path), "test query"],
135 |                     check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_e2e_operator_workflows.py:160:21
    |
158 |                 # Should work with either repo
159 |                 for repo in [repo1, repo2]:
160 |                     result = subprocess.run(
    |                     ^^^^^^
161 |                         [str(cmw), "--repo", str(repo), "test"],
162 |                         check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_e2e_operator_workflows.py:187:17
    |
185 |                 env["LLMC_TARGET_REPO"] = str(repo_path)
186 |
187 |                 result = subprocess.run(
    |                 ^^^^^^
188 |                     [str(cmw), "test"],
189 |                     check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_e2e_operator_workflows.py:212:17
    |
211 |                 # Run cron wrapper
212 |                 result = subprocess.run(
    |                 ^^^^^^
213 |                     [str(cron_script), "--repo", str(tmpdir)],
214 |                     check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `span_hash` is assigned to but never used
  --> tests/test_enrichment_aegis_data.py:34:5
   |
32 |     Returns a valid enrichment payload based on the prompt content.
33 |     """
34 |     span_hash = prompt.get("span_hash", "unknown")
   |     ^^^^^^^^^
35 |     path = prompt.get("path", "unknown")
36 |     lines = prompt.get("lines", [1, 10])
   |
help: Remove assignment to unused variable `span_hash`

B905 `zip()` without an explicit `strict=` parameter
  --> tests/test_enrichment_batch.py:77:27
   |
75 |     span_hashes = ["span_f1", "span_f2", "span_f3"]
76 |     symbols = ["f1", "f2", "f3"]
77 |     for span_hash, sym in zip(span_hashes, symbols):
   |                           ^^^^^^^^^^^^^^^^^^^^^^^^^
78 |         _insert_file_and_span(db, repo_root, "mod.py", sym, span_hash)
   |
help: Add explicit value for parameter `strict=`

F841 Local variable `db_path` is assigned to but never used
   --> tests/test_enrichment_integration_edge_cases.py:196:9
    |
194 |         workspace.mkdir(parents=True)
195 |
196 |         db_path = create_test_db(workspace, "enrichment.db")
    |         ^^^^^^^
197 |
198 |         # Should find DB in workspace
    |
help: Remove assignment to unused variable `db_path`

F841 Local variable `db_path` is assigned to but never used
   --> tests/test_enrichment_integration_edge_cases.py:209:9
    |
207 |         llmc_dir.mkdir()
208 |
209 |         db_path = create_test_db(llmc_dir, "enrichment.db")
    |         ^^^^^^^
210 |
211 |         # Should find DB in .llmc
    |
help: Remove assignment to unused variable `db_path`

F841 Local variable `db_path` is assigned to but never used
   --> tests/test_enrichment_integration_edge_cases.py:240:9
    |
239 |         # Create DB with items
240 |         db_path = create_test_db(workspace, "enrichment.db")
    |         ^^^^^^^
241 |
242 |         # Simulate search items
    |
help: Remove assignment to unused variable `db_path`

B011 Do not `assert False` (`python -O` removes these calls), raise `AssertionError()`
   --> tests/test_enrichment_integration_edge_cases.py:318:20
    |
316 |             conn.execute("SELECT * FROM sqlite_master")
317 |             conn.close()
318 |             assert False, "Should have failed to open corrupted DB"
    |                    ^^^^^
319 |         except sqlite3.DatabaseError:
320 |             pass  # Expected
    |
help: Replace `assert False`

F841 Local variable `db_path` is assigned to but never used
   --> tests/test_enrichment_integration_edge_cases.py:370:9
    |
368 |     def test_attach_enrichments_where_used(self, tmp_path: Path):
369 |         """Test attaching enrichments to WhereUsedResult."""
370 |         db_path = create_test_db(tmp_path)
    |         ^^^^^^^
371 |
372 |         # Similar to search result test
    |
help: Remove assignment to unused variable `db_path`

F841 Local variable `db_path` is assigned to but never used
   --> tests/test_enrichment_integration_edge_cases.py:381:9
    |
379 |     def test_attach_enrichments_lineage(self, tmp_path: Path):
380 |         """Test attaching enrichments to LineageResult."""
381 |         db_path = create_test_db(tmp_path)
    |         ^^^^^^^
382 |
383 |         lineage_result = Mock()
    |
help: Remove assignment to unused variable `db_path`

F841 Local variable `db_path` is assigned to but never used
   --> tests/test_enrichment_integration_edge_cases.py:424:9
    |
422 |     def test_no_enrichment_data(self, tmp_path: Path):
423 |         """Test behavior when DB has no enrichment data."""
424 |         db_path = create_test_db(tmp_path)
    |         ^^^^^^^
425 |
426 |         # Don't add any data
    |
help: Remove assignment to unused variable `db_path`

F841 Local variable `logger` is assigned to but never used
   --> tests/test_enrichment_integration_edge_cases.py:541:13
    |
540 |             # Should not log when disabled
541 |             logger = Mock()
    |             ^^^^^^
542 |
543 |             # Simulate no-op (logging disabled)
    |
help: Remove assignment to unused variable `logger`

F841 Local variable `db_path` is assigned to but never used
   --> tests/test_enrichment_integration_edge_cases.py:651:9
    |
649 |         import time
650 |
651 |         db_path = create_test_db(tmp_path)
    |         ^^^^^^^
652 |
653 |         # Measure time with metrics
    |
help: Remove assignment to unused variable `db_path`

B011 Do not `assert False` (`python -O` removes these calls), raise `AssertionError()`
   --> tests/test_enrichment_integration_edge_cases.py:701:20
    |
699 |             conn.execute("SELECT * FROM sqlite_master")
700 |             conn.close()
701 |             assert False, "Should fail to open empty DB as SQLite"
    |                    ^^^^^
702 |         except sqlite3.DatabaseError:
703 |             pass  # Expected
    |
help: Replace `assert False`

F841 Local variable `db_path` is assigned to but never used
   --> tests/test_enrichment_integration_edge_cases.py:707:9
    |
705 |     def test_enrichment_with_very_large_result_set(self, tmp_path: Path):
706 |         """Test enrichment with 1000+ search results."""
707 |         db_path = create_test_db(tmp_path)
    |         ^^^^^^^
708 |
709 |         # Create large result set
    |
help: Remove assignment to unused variable `db_path`

F841 Local variable `items` is assigned to but never used
   --> tests/test_enrichment_integration_edge_cases.py:710:9
    |
709 |         # Create large result set
710 |         items = [Mock(file=f"file_{i}.py") for i in range(1000)]
    |         ^^^^^
711 |
712 |         # Should handle large sets without memory issues
    |
help: Remove assignment to unused variable `items`

F841 Local variable `count` is assigned to but never used
   --> tests/test_enrichment_integration_edge_cases.py:818:9
    |
816 |         conn = sqlite3.connect(str(db_path))
817 |         cursor = conn.execute("SELECT COUNT(*) FROM enrichments WHERE file_path = ?", ("test.py",))
818 |         count = cursor.fetchone()[0]
    |         ^^^^^
819 |         conn.close()
    |
help: Remove assignment to unused variable `count`

F401 `tools.rag.enrichment.enrich_spans` imported but unused; consider using `importlib.util.find_spec` to test for availability
  --> tests/test_error_handling_comprehensive.py:27:38
   |
25 | # Import enrichment functions - these may not exist yet
26 | try:
27 |     from tools.rag.enrichment import enrich_spans
   |                                      ^^^^^^^^^^^^
28 |
29 |     ENRICHMENT_AVAILABLE = True
   |
help: Remove unused import: `tools.rag.enrichment.enrich_spans`

F841 Local variable `tmpdir` is assigned to but never used
   --> tests/test_error_handling_comprehensive.py:257:47
    |
255 |         mock_post.side_effect = Exception("Connection timeout")
256 |
257 |         with tempfile.TemporaryDirectory() as tmpdir:
    |                                               ^^^^^^
258 |             # Should handle timeout gracefully
259 |             try:
    |
help: Remove assignment to unused variable `tmpdir`

F841 Local variable `nonexistent_path` is assigned to but never used
   --> tests/test_error_handling_comprehensive.py:324:9
    |
322 |     def test_handles_nonexistent_directory(self):
323 |         """Test handling of non-existent directories."""
324 |         nonexistent_path = Path("/nonexistent/path/to/nowhere")
    |         ^^^^^^^^^^^^^^^^
325 |
326 |         # Attempting to create something in non-existent path should fail
    |
help: Remove assignment to unused variable `nonexistent_path`

F841 Local variable `large_input` is assigned to but never used
   --> tests/test_error_handling_comprehensive.py:566:13
    |
564 |         with tempfile.TemporaryDirectory():
565 |             # Create very large input
566 |             large_input = "x" * (1024 * 1024 * 10)  # 10MB
    |             ^^^^^^^^^^^
567 |
568 |             try:
    |
help: Remove assignment to unused variable `large_input`

F841 Local variable `binary_data` is assigned to but never used
   --> tests/test_error_handling_comprehensive.py:579:13
    |
577 |         with tempfile.TemporaryDirectory():
578 |             # Create binary data
579 |             binary_data = bytes(range(256))
    |             ^^^^^^^^^^^
580 |
581 |             try:
    |
help: Remove assignment to unused variable `binary_data`

B011 Do not `assert False` (`python -O` removes these calls), raise `AssertionError()`
   --> tests/test_error_handling_comprehensive.py:725:24
    |
723 |             try:
724 |                 result = safe_resolve("../../../etc/passwd", base)
725 |                 assert False, "Path traversal should have been blocked!"
    |                        ^^^^^
726 |             except ValueError as e:
727 |                 assert "Path traversal blocked" in str(e)
    |
help: Replace `assert False`

F841 Local variable `tmpdir` is assigned to but never used
   --> tests/test_error_handling_comprehensive.py:742:47
    |
740 |         import tempfile
741 |
742 |         with tempfile.TemporaryDirectory() as tmpdir:
    |                                               ^^^^^^
743 |             # Test that subprocess calls don't use shell=True with user input
744 |             # The safe pattern is: subprocess.run(['cmd', 'arg'], shell=False)
    |
help: Remove assignment to unused variable `tmpdir`

F841 Local variable `unicode_attack` is assigned to but never used
   --> tests/test_error_handling_comprehensive.py:830:13
    |
828 |         with tempfile.TemporaryDirectory():
829 |             # Unicode null, control characters, etc.
830 |             unicode_attack = "test\u0000\u200b\u2060\ufeff"
    |             ^^^^^^^^^^^^^^
831 |
832 |             try:
    |
help: Remove assignment to unused variable `unicode_attack`

B011 Do not `assert False` (`python -O` removes these calls), raise `AssertionError()`
   --> tests/test_error_handling_comprehensive.py:859:28
    |
857 |                 try:
858 |                     conn2.execute("CREATE TABLE test2 (id INTEGER)")
859 |                     assert False, "Should have raised OperationalError (locked)"
    |                            ^^^^^
860 |                 except sqlite3.OperationalError as e:
861 |                     assert "locked" in str(e).lower()
    |
help: Replace `assert False`

E722 Do not use bare `except`
   --> tests/test_error_handling_comprehensive.py:939:21
    |
937 |                     try:
938 |                         f.close()
939 |                     except:
    |                     ^^^^^^
940 |                         pass
    |

F841 Local variable `old_time` is assigned to but never used
  --> tests/test_file_mtime_guard.py:43:9
   |
41 |         # Create a file from 2 hours ago
42 |         old_file = tmp_path / "old.py"
43 |         old_time = last_indexed.timestamp() - 3600  # 1 hour before indexing
   |         ^^^^^^^^
44 |         old_file.write_text("# old code")
   |
help: Remove assignment to unused variable `old_time`

F841 Local variable `new_time` is assigned to but never used
  --> tests/test_file_mtime_guard.py:63:9
   |
61 |         # Create a file from 30 minutes ago (after indexing)
62 |         new_file = tmp_path / "new.py"
63 |         new_time = last_indexed.timestamp() + 1800  # 30 minutes after indexing
   |         ^^^^^^^^
64 |         new_file.write_text("# new code")
   |
help: Remove assignment to unused variable `new_time`

F841 Local variable `exact_time` is assigned to but never used
  --> tests/test_file_mtime_guard.py:86:9
   |
85 |         # Set mtime to match last_indexed
86 |         exact_time = last_indexed.timestamp()
   |         ^^^^^^^^^^
87 |         # Note: mtime is set via os.utime or touch command
   |
help: Remove assignment to unused variable `exact_time`

F841 Local variable `nonexistent` is assigned to but never used
   --> tests/test_file_mtime_guard.py:107:9
    |
105 |         Checking a non-existent file should handle gracefully.
106 |         """
107 |         nonexistent = tmp_path / "does_not_exist.py"
    |         ^^^^^^^^^^^
108 |         last_indexed = datetime.now(UTC)
    |
help: Remove assignment to unused variable `nonexistent`

F841 Local variable `last_indexed` is assigned to but never used
   --> tests/test_file_mtime_guard.py:108:9
    |
106 |         """
107 |         nonexistent = tmp_path / "does_not_exist.py"
108 |         last_indexed = datetime.now(UTC)
    |         ^^^^^^^^^^^^
109 |
110 |         # This might raise FileNotFoundError or return a safe default
    |
help: Remove assignment to unused variable `last_indexed`

F841 Local variable `last_indexed` is assigned to but never used
   --> tests/test_file_mtime_guard.py:121:9
    |
119 |         dir_path = tmp_path / "subdir"
120 |         dir_path.mkdir()
121 |         last_indexed = datetime.now(UTC)
    |         ^^^^^^^^^^^^
122 |
123 |         # Directories have mtimes too - should this be allowed?
    |
help: Remove assignment to unused variable `last_indexed`

F841 Local variable `link_file` is assigned to but never used
   --> tests/test_file_mtime_guard.py:139:9
    |
138 |         # Create symlink
139 |         link_file = tmp_path / "link.py"
    |         ^^^^^^^^^
140 |         # link_file.symlink_to(target_file)
    |
help: Remove assignment to unused variable `link_file`

F841 Local variable `last_indexed` is assigned to but never used
   --> tests/test_file_mtime_guard.py:142:9
    |
140 |         # link_file.symlink_to(target_file)
141 |
142 |         last_indexed = datetime.fromtimestamp(target_time, UTC)
    |         ^^^^^^^^^^^^
143 |
144 |         # Should follow symlink and get target's mtime
    |
help: Remove assignment to unused variable `last_indexed`

F841 Local variable `target_time` is assigned to but never used
   --> tests/test_file_mtime_guard.py:156:9
    |
154 |         # Create an old file
155 |         target_file = tmp_path / "target.py"
156 |         target_time = time.time() + 3600  # 1 hour in future
    |         ^^^^^^^^^^^
157 |         target_file.write_text("# target")
158 |         # target_file.utime((target_time, target_time))
    |
help: Remove assignment to unused variable `target_time`

F841 Local variable `link_file` is assigned to but never used
   --> tests/test_file_mtime_guard.py:161:9
    |
160 |         # Create symlink
161 |         link_file = tmp_path / "link.py"
    |         ^^^^^^^^^
162 |         # link_file.symlink_to(target_file)
    |
help: Remove assignment to unused variable `link_file`

F841 Local variable `last_indexed` is assigned to but never used
   --> tests/test_file_mtime_guard.py:164:9
    |
162 |         # link_file.symlink_to(target_file)
163 |
164 |         last_indexed = datetime.now(UTC)
    |         ^^^^^^^^^^^^
165 |
166 |         # Should follow symlink and detect new mtime
    |
help: Remove assignment to unused variable `last_indexed`

F841 Local variable `link_file` is assigned to but never used
   --> tests/test_file_mtime_guard.py:177:9
    |
175 |         """
176 |         # Create symlink to non-existent target
177 |         link_file = tmp_path / "broken.py"
    |         ^^^^^^^^^
178 |         # link_file.symlink_to("nonexistent.py")
    |
help: Remove assignment to unused variable `link_file`

F841 Local variable `last_indexed` is assigned to but never used
   --> tests/test_file_mtime_guard.py:180:9
    |
178 |         # link_file.symlink_to("nonexistent.py")
179 |
180 |         last_indexed = datetime.now(UTC)
    |         ^^^^^^^^^^^^
181 |
182 |         # Should handle the error gracefully
    |
help: Remove assignment to unused variable `last_indexed`

F841 Local variable `index_status` is assigned to but never used
   --> tests/test_file_mtime_guard.py:200:9
    |
198 |         """
199 |         # Create a realistic IndexStatus
200 |         index_status = IndexStatus(
    |         ^^^^^^^^^^^^
201 |             repo="test",
202 |             index_state="fresh",
    |
help: Remove assignment to unused variable `index_status`

F841 Local variable `timestamp` is assigned to but never used
   --> tests/test_file_mtime_guard.py:250:17
    |
248 |             else:
249 |                 # New files
250 |                 timestamp = last_indexed.timestamp() + (i - 1) * 3600
    |                 ^^^^^^^^^
251 |
252 |             f.write_text(f"# file {i}")
    |
help: Remove assignment to unused variable `timestamp`

I001 [*] Import block is un-sorted or un-formatted
  --> tests/test_fts5_stopwords_regression.py:11:1
   |
 9 |   """
10 |
11 | / from pathlib import Path
12 | | import pytest
13 | |
14 | | from tools.rag.database import Database
15 | | from tools.rag.types import FileRecord, SpanRecord
   | |__________________________________________________^
   |
help: Organize imports

B007 Loop control variable `score` not used within loop body
   --> tests/test_fts5_stopwords_regression.py:121:30
    |
119 |         # Verify result contains the keyword
120 |         found_keyword = False
121 |         for symbol, summary, score in results:
    |                              ^^^^^
122 |             if summary and keyword.lower() in summary.lower():
123 |                 found_keyword = True
    |
help: Rename unused `score` to `_score`

F841 Local variable `main_db` is assigned to but never used
  --> tests/test_fts_backend_edge_cases.py:97:9
   |
95 |     def test_fts_search_with_fresh_db(self, tmp_path: Path):
96 |         """Test FTS search when both DBs are available."""
97 |         main_db = create_test_db(tmp_path)
   |         ^^^^^^^
98 |         fts_db = create_fts_db(tmp_path)
   |
help: Remove assignment to unused variable `main_db`

F841 Local variable `fts_db` is assigned to but never used
   --> tests/test_fts_backend_edge_cases.py:98:9
    |
 96 |         """Test FTS search when both DBs are available."""
 97 |         main_db = create_test_db(tmp_path)
 98 |         fts_db = create_fts_db(tmp_path)
    |         ^^^^^^
 99 |
100 |         # Both databases exist
    |
help: Remove assignment to unused variable `fts_db`

F841 Local variable `main_db` is assigned to but never used
   --> tests/test_fts_backend_edge_cases.py:106:9
    |
104 |     def test_fallback_to_traditional_when_fts_missing(self, tmp_path: Path):
105 |         """Test fallback when FTS table doesn't exist."""
106 |         main_db = create_test_db(tmp_path)
    |         ^^^^^^^
107 |
108 |         # Create FTS DB but drop the FTS table
    |
help: Remove assignment to unused variable `main_db`

F841 Local variable `queries` is assigned to but never used
   --> tests/test_fts_backend_edge_cases.py:180:9
    |
178 |     def test_fallback_with_special_characters(self, tmp_path: Path):
179 |         """Test fallback handles special characters in query."""
180 |         queries = [
    |         ^^^^^^^
181 |             "def test():",
182 |             "class MyClass:",
    |
help: Remove assignment to unused variable `queries`

F841 Local variable `queries` is assigned to but never used
   --> tests/test_fts_backend_edge_cases.py:191:9
    |
189 |     def test_fallback_with_unicode_query(self, tmp_path: Path):
190 |         """Test fallback with unicode characters."""
191 |         queries = [
    |         ^^^^^^^
192 |             "Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ",
193 |             "é–¢æ•°",
    |
help: Remove assignment to unused variable `queries`

F841 Local variable `fts_db` is assigned to but never used
   --> tests/test_fts_backend_edge_cases.py:333:9
    |
331 |     def test_fts_search_empty_query(self, tmp_path: Path):
332 |         """Test FTS search with empty query."""
333 |         fts_db = create_fts_db(tmp_path)
    |         ^^^^^^
334 |
335 |         # Empty query should return all results or none
    |
help: Remove assignment to unused variable `fts_db`

F841 Local variable `long_query` is assigned to but never used
   --> tests/test_fts_backend_edge_cases.py:340:9
    |
338 |     def test_fts_search_very_long_query(self, tmp_path: Path):
339 |         """Test FTS search with very long query."""
340 |         long_query = " ".join(["word"] * 10000)
    |         ^^^^^^^^^^
341 |
342 |         # Should handle or reject long queries
    |
help: Remove assignment to unused variable `long_query`

F841 Local variable `patterns` is assigned to but never used
   --> tests/test_fts_backend_edge_cases.py:347:9
    |
345 |     def test_fts_search_wildcard_patterns(self, tmp_path: Path):
346 |         """Test FTS search with wildcards."""
347 |         patterns = [
    |         ^^^^^^^^
348 |             "func*",  # Prefix match
349 |             "*_test",  # Suffix match
    |
help: Remove assignment to unused variable `patterns`

F841 Local variable `patterns` is assigned to but never used
   --> tests/test_fts_backend_edge_cases.py:357:9
    |
355 |     def test_fts_search_regex_patterns(self, tmp_path: Path):
356 |         """Test FTS search with regex patterns."""
357 |         patterns = [
    |         ^^^^^^^^
358 |             r"def \w+",  # Function definitions
359 |             r"class \w+:",  # Class definitions
    |
help: Remove assignment to unused variable `patterns`

F841 Local variable `dangerous_queries` is assigned to but never used
   --> tests/test_fts_backend_edge_cases.py:368:9
    |
366 |     def test_fts_search_special_characters(self, tmp_path: Path):
367 |         """Test FTS search with special SQL characters."""
368 |         dangerous_queries = [
    |         ^^^^^^^^^^^^^^^^^
369 |             "'; DROP TABLE files; --",
370 |             "100 OR 1=1",
    |
help: Remove assignment to unused variable `dangerous_queries`

F841 Local variable `queries` is assigned to but never used
   --> tests/test_fts_backend_edge_cases.py:411:9
    |
409 |     def test_fts_search_boolean_operators(self, tmp_path: Path):
410 |         """Test FTS search with AND/OR/NOT."""
411 |         queries = [
    |         ^^^^^^^
412 |             "function AND test",
413 |             "class OR struct",
    |
help: Remove assignment to unused variable `queries`

F841 Local variable `fts_db` is assigned to but never used
   --> tests/test_fts_backend_edge_cases.py:421:9
    |
419 |     def test_fts_search_limit_parameter(self, tmp_path: Path):
420 |         """Test FTS search with limit parameter."""
421 |         fts_db = create_fts_db(tmp_path)
    |         ^^^^^^
422 |
423 |         # Test various limits: 1, 10, 100, 1000
    |
help: Remove assignment to unused variable `fts_db`

F841 Local variable `main_db` is assigned to but never used
   --> tests/test_fts_backend_edge_cases.py:473:9
    |
471 |         """Test migration from traditional to FTS."""
472 |         # Create traditional DB
473 |         main_db = create_test_db(tmp_path)
    |         ^^^^^^^
474 |
475 |         # Migrate to FTS
    |
help: Remove assignment to unused variable `main_db`

F401 `tools.rag.enrichment_db_helpers.EnrichmentRecord` imported but unused; consider using `importlib.util.find_spec` to test for availability
  --> tests/test_graph_enrichment_merge.py:9:49
   |
 7 | # Ideally these imports would work once the code is written.
 8 | try:
 9 |     from tools.rag.enrichment_db_helpers import EnrichmentRecord, load_enrichment_data
   |                                                 ^^^^^^^^^^^^^^^^
10 |     from tools.rag.schema import Entity, SchemaGraph
11 |     from tools.rag_nav.tool_handlers import build_enriched_schema_graph
   |
help: Remove unused import

F401 `tools.rag.enrichment_db_helpers.load_enrichment_data` imported but unused; consider using `importlib.util.find_spec` to test for availability
  --> tests/test_graph_enrichment_merge.py:9:67
   |
 7 | # Ideally these imports would work once the code is written.
 8 | try:
 9 |     from tools.rag.enrichment_db_helpers import EnrichmentRecord, load_enrichment_data
   |                                                                   ^^^^^^^^^^^^^^^^^^^^
10 |     from tools.rag.schema import Entity, SchemaGraph
11 |     from tools.rag_nav.tool_handlers import build_enriched_schema_graph
   |
help: Remove unused import

F401 `tools.rag.schema.Entity` imported but unused; consider using `importlib.util.find_spec` to test for availability
  --> tests/test_graph_enrichment_merge.py:10:34
   |
 8 | try:
 9 |     from tools.rag.enrichment_db_helpers import EnrichmentRecord, load_enrichment_data
10 |     from tools.rag.schema import Entity, SchemaGraph
   |                                  ^^^^^^
11 |     from tools.rag_nav.tool_handlers import build_enriched_schema_graph
12 | except ImportError:
   |
help: Remove unused import

F401 `tools.rag.schema.SchemaGraph` imported but unused; consider using `importlib.util.find_spec` to test for availability
  --> tests/test_graph_enrichment_merge.py:10:42
   |
 8 | try:
 9 |     from tools.rag.enrichment_db_helpers import EnrichmentRecord, load_enrichment_data
10 |     from tools.rag.schema import Entity, SchemaGraph
   |                                          ^^^^^^^^^^^
11 |     from tools.rag_nav.tool_handlers import build_enriched_schema_graph
12 | except ImportError:
   |
help: Remove unused import

F401 `tools.rag_nav.tool_handlers.build_enriched_schema_graph` imported but unused; consider using `importlib.util.find_spec` to test for availability
  --> tests/test_graph_enrichment_merge.py:11:45
   |
 9 |     from tools.rag.enrichment_db_helpers import EnrichmentRecord, load_enrichment_data
10 |     from tools.rag.schema import Entity, SchemaGraph
11 |     from tools.rag_nav.tool_handlers import build_enriched_schema_graph
   |                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
12 | except ImportError:
13 |     pass  # Allow test collection to fail gracefully if modules don't exist yet
   |
help: Remove unused import: `tools.rag_nav.tool_handlers.build_enriched_schema_graph`

F841 Local variable `repo_root` is assigned to but never used
  --> tests/test_graph_stitching_edge_cases.py:47:9
   |
45 |     def test_expand_search_items_with_neighbors(self, tmp_path: Path):
46 |         """Test expanding search items with graph neighbors."""
47 |         repo_root = self.create_test_graph(tmp_path)
   |         ^^^^^^^^^
48 |
49 |         # Mock search items (starting points)
   |
help: Remove assignment to unused variable `repo_root`

F841 Local variable `search_items` is assigned to but never used
  --> tests/test_graph_stitching_edge_cases.py:50:9
   |
49 |         # Mock search items (starting points)
50 |         search_items = [
   |         ^^^^^^^^^^^^
51 |             Mock(file="file1.py"),
52 |             Mock(file="file2.py"),
   |
help: Remove assignment to unused variable `search_items`

F841 Local variable `neighbors` is assigned to but never used
  --> tests/test_graph_stitching_edge_cases.py:56:9
   |
55 |         # Mock neighbors from graph
56 |         neighbors = [
   |         ^^^^^^^^^
57 |             Mock(path="file3.py"),
58 |             Mock(path="file4.py"),
   |
help: Remove assignment to unused variable `neighbors`

F841 Local variable `repo_root` is assigned to but never used
  --> tests/test_graph_stitching_edge_cases.py:67:9
   |
65 |     def test_max_expansion_limit(self, tmp_path: Path):
66 |         """Test that max_expansion limits number of neighbors added."""
67 |         repo_root = self.create_test_graph(tmp_path)
   |         ^^^^^^^^^
68 |
69 |         search_items = [Mock(file="file1.py")]
   |
help: Remove assignment to unused variable `repo_root`

F841 Local variable `search_items` is assigned to but never used
  --> tests/test_graph_stitching_edge_cases.py:69:9
   |
67 |         repo_root = self.create_test_graph(tmp_path)
68 |
69 |         search_items = [Mock(file="file1.py")]
   |         ^^^^^^^^^^^^
70 |
71 |         # Graph has 4 neighbors but max_expansion is 2
   |
help: Remove assignment to unused variable `search_items`

F841 Local variable `max_expansion` is assigned to but never used
  --> tests/test_graph_stitching_edge_cases.py:72:9
   |
71 |         # Graph has 4 neighbors but max_expansion is 2
72 |         max_expansion = 2
   |         ^^^^^^^^^^^^^
73 |         hops = 1
   |
help: Remove assignment to unused variable `max_expansion`

F841 Local variable `hops` is assigned to but never used
  --> tests/test_graph_stitching_edge_cases.py:73:9
   |
71 |         # Graph has 4 neighbors but max_expansion is 2
72 |         max_expansion = 2
73 |         hops = 1
   |         ^^^^
74 |
75 |         # Should only add 2 neighbors
   |
help: Remove assignment to unused variable `hops`

F841 Local variable `repo_root` is assigned to but never used
  --> tests/test_graph_stitching_edge_cases.py:79:9
   |
77 |     def test_one_hop_only(self, tmp_path: Path):
78 |         """Test that only 1-hop neighbors are expanded (not 2-hop)."""
79 |         repo_root = self.create_test_graph(tmp_path)
   |         ^^^^^^^^^
80 |
81 |         # Graph structure: func_a -> func_b -> func_c -> func_d
   |
help: Remove assignment to unused variable `repo_root`

F841 Local variable `search_items` is assigned to but never used
  --> tests/test_graph_stitching_edge_cases.py:87:9
   |
85 |         # Should only include func_b, not func_c
86 |
87 |         search_items = [Mock(file="file1.py")]  # func_a
   |         ^^^^^^^^^^^^
88 |
89 |         # Should not include func_c (2-hop away)
   |
help: Remove assignment to unused variable `search_items`

F841 Local variable `repo_root` is assigned to but never used
  --> tests/test_graph_stitching_edge_cases.py:93:9
   |
91 |     def test_zero_hop_expansion(self, tmp_path: Path):
92 |         """Test expansion with hops=0 (no expansion)."""
93 |         repo_root = self.create_test_graph(tmp_path)
   |         ^^^^^^^^^
94 |
95 |         search_items = [
   |
help: Remove assignment to unused variable `repo_root`

F841 Local variable `search_items` is assigned to but never used
  --> tests/test_graph_stitching_edge_cases.py:95:9
   |
93 |         repo_root = self.create_test_graph(tmp_path)
94 |
95 |         search_items = [
   |         ^^^^^^^^^^^^
96 |             Mock(file="file1.py"),
97 |             Mock(file="file2.py"),
   |
help: Remove assignment to unused variable `search_items`

F841 Local variable `search_items` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:108:9
    |
106 |         repo_root.mkdir()
107 |
108 |         search_items = [Mock(file="file1.py")]
    |         ^^^^^^^^^^^^
109 |
110 |         # Should handle missing graph gracefully
    |
help: Remove assignment to unused variable `search_items`

F841 Local variable `search_items` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:124:9
    |
122 |         graph_path.write_text(json.dumps(graph))
123 |
124 |         search_items = [Mock(file="file1.py")]
    |         ^^^^^^^^^^^^
125 |
126 |         # Empty graph means no neighbors to find
    |
help: Remove assignment to unused variable `search_items`

F841 Local variable `search_items` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:145:9
    |
143 |         graph_path.write_text(json.dumps(graph))
144 |
145 |         search_items = [Mock(file="file1.py")]
    |         ^^^^^^^^^^^^
146 |
147 |         # No edges means no neighbors
    |
help: Remove assignment to unused variable `search_items`

F841 Local variable `search_items` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:171:9
    |
169 |         graph_path.write_text(json.dumps(graph))
170 |
171 |         search_items = [Mock(file="file1.py")]
    |         ^^^^^^^^^^^^
172 |
173 |         # Should handle cycles without infinite loop
    |
help: Remove assignment to unused variable `search_items`

F841 Local variable `search_items` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:194:9
    |
192 |         graph_path.write_text(json.dumps(graph))
193 |
194 |         search_items = [Mock(file="file1.py")]
    |         ^^^^^^^^^^^^
195 |
196 |         # Should handle self-loops gracefully
    |
help: Remove assignment to unused variable `search_items`

F841 Local variable `repo_root` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:224:9
    |
222 |     def test_neighbors_from_multiple_items(self, tmp_path: Path):
223 |         """Test expansion from multiple starting items."""
224 |         repo_root = self.create_test_graph(tmp_path)
    |         ^^^^^^^^^
225 |
226 |         # Multiple starting points
    |
help: Remove assignment to unused variable `repo_root`

F841 Local variable `search_items` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:227:9
    |
226 |         # Multiple starting points
227 |         search_items = [
    |         ^^^^^^^^^^^^
228 |             Mock(file="file1.py"),  # func_a
229 |             Mock(file="file2.py"),  # func_b
    |
help: Remove assignment to unused variable `search_items`

F841 Local variable `search_items` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:258:9
    |
256 |         graph_path.write_text(json.dumps(graph))
257 |
258 |         search_items = [Mock(file="file1.py")]
    |         ^^^^^^^^^^^^
259 |
260 |         # Should handle missing target nodes
    |
help: Remove assignment to unused variable `search_items`

F841 Local variable `search_items` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:278:9
    |
276 |         graph_path.write_text(json.dumps(graph))
277 |
278 |         search_items = [Mock(file="file_0.py")]
    |         ^^^^^^^^^^^^
279 |
280 |         # Should handle large graphs efficiently
    |
help: Remove assignment to unused variable `search_items`

F841 Local variable `search_items` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:304:9
    |
302 |         graph_path.write_text(json.dumps(graph))
303 |
304 |         search_items = [Mock(file="Ñ„Ð°Ð¹Ð».py")]
    |         ^^^^^^^^^^^^
305 |
306 |         # Should handle unicode properly
    |
help: Remove assignment to unused variable `search_items`

F841 Local variable `search_items` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:349:9
    |
347 |         graph_path.write_text("{ corrupt json !@#$ }")
348 |
349 |         search_items = [Mock(file="file1.py")]
    |         ^^^^^^^^^^^^
350 |
351 |         # Should handle parse error gracefully
    |
help: Remove assignment to unused variable `search_items`

F841 Local variable `search_items` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:373:9
    |
371 |         graph_path.chmod(0o000)
372 |
373 |         search_items = [Mock(file="file1.py")]
    |         ^^^^^^^^^^^^
374 |
375 |         # Should handle permission error
    |
help: Remove assignment to unused variable `search_items`

F841 Local variable `search_items` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:384:13
    |
382 |         # Simulate I/O error
383 |         with patch("builtins.open", side_effect=OSError("Disk error")):
384 |             search_items = [Mock(file="file1.py")]
    |             ^^^^^^^^^^^^
385 |
386 |             # Should handle I/O error gracefully
    |
help: Remove assignment to unused variable `search_items`

F841 Local variable `search_items` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:407:9
    |
405 |         graph_path.write_text(json.dumps(graph))
406 |
407 |         search_items = [Mock(file="file_0.py")]
    |         ^^^^^^^^^^^^
408 |
409 |         # Should have timeout protection
    |
help: Remove assignment to unused variable `search_items`

F841 Local variable `search_items` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:436:9
    |
434 |         graph_path.write_text(json.dumps(graph))
435 |
436 |         search_items = [Mock(file="file1.py")]
    |         ^^^^^^^^^^^^
437 |
438 |         # Should validate node structure
    |
help: Remove assignment to unused variable `search_items`

F841 Local variable `search_items` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:462:9
    |
460 |         graph_path.write_text(json.dumps(graph))
461 |
462 |         search_items = [Mock(file="file1.py")]
    |         ^^^^^^^^^^^^
463 |
464 |         # Should validate edge structure
    |
help: Remove assignment to unused variable `search_items`

F841 Local variable `search_items` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:483:9
    |
481 |         graph_path.write_text(json.dumps(graph))
482 |
483 |         search_items = [Mock(file="file1.py")]
    |         ^^^^^^^^^^^^
484 |
485 |         # Should handle or deduplicate
    |
help: Remove assignment to unused variable `search_items`

F841 Local variable `search_items` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:507:9
    |
505 |         graph_path.write_text(json.dumps(graph))
506 |
507 |         search_items = [Mock(file="file1.py")]
    |         ^^^^^^^^^^^^
508 |
509 |         # Should deduplicate or handle
    |
help: Remove assignment to unused variable `search_items`

F841 Local variable `search_items` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:535:9
    |
533 |         graph_path.write_text(json.dumps(graph))
534 |
535 |         search_items = [Mock(file="file1.py")]  # In component 1
    |         ^^^^^^^^^^^^
536 |
537 |         # Should only find neighbors in same component
    |
help: Remove assignment to unused variable `search_items`

F841 Local variable `repo_root` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:548:9
    |
546 |         import threading
547 |
548 |         repo_root = self.create_test_graph(tmp_path)
    |         ^^^^^^^^^
549 |         results = []
    |
help: Remove assignment to unused variable `repo_root`

F841 Local variable `repo_root` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:598:9
    |
596 |     def test_mix_rag_and_stitched_results(self, tmp_path: Path):
597 |         """Test combining original RAG results with stitched neighbors."""
598 |         repo_root = self.create_test_graph(tmp_path)
    |         ^^^^^^^^^
599 |
600 |         # Original RAG results
    |
help: Remove assignment to unused variable `repo_root`

F841 Local variable `rag_items` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:601:9
    |
600 |         # Original RAG results
601 |         rag_items = [
    |         ^^^^^^^^^
602 |             Mock(file="file1.py"),
603 |             Mock(file="file2.py"),
    |
help: Remove assignment to unused variable `rag_items`

F841 Local variable `stitched_items` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:607:9
    |
606 |         # Stitched neighbors
607 |         stitched_items = [
    |         ^^^^^^^^^^^^^^
608 |             Mock(file="file3.py"),
609 |             Mock(file="file4.py"),
    |
help: Remove assignment to unused variable `stitched_items`

F841 Local variable `repo_root` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:618:9
    |
616 |     def test_duplicate_files_deduplication(self, tmp_path: Path):
617 |         """Test that duplicate files between RAG and stitched are deduplicated."""
618 |         repo_root = self.create_test_graph(tmp_path)
    |         ^^^^^^^^^
619 |
620 |         # Original RAG results
    |
help: Remove assignment to unused variable `repo_root`

F841 Local variable `rag_items` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:621:9
    |
620 |         # Original RAG results
621 |         rag_items = [
    |         ^^^^^^^^^
622 |             Mock(file="file1.py"),
623 |             Mock(file="file2.py"),
    |
help: Remove assignment to unused variable `rag_items`

F841 Local variable `stitched_items` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:628:9
    |
627 |         # Stitched neighbors (file3.py overlaps)
628 |         stitched_items = [
    |         ^^^^^^^^^^^^^^
629 |             Mock(file="file3.py"),  # Duplicate!
630 |             Mock(file="file4.py"),
    |
help: Remove assignment to unused variable `stitched_items`

F841 Local variable `repo_root` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:654:9
    |
652 |     def test_max_results_enforcement(self, tmp_path: Path):
653 |         """Test that max_results limit is enforced after stitching."""
654 |         repo_root = self.create_test_graph(tmp_path)
    |         ^^^^^^^^^
655 |
656 |         rag_items = [Mock(file=f"file{i}.py") for i in range(15)]
    |
help: Remove assignment to unused variable `repo_root`

F841 Local variable `rag_items` is assigned to but never used
   --> tests/test_graph_stitching_edge_cases.py:656:9
    |
654 |         repo_root = self.create_test_graph(tmp_path)
655 |
656 |         rag_items = [Mock(file=f"file{i}.py") for i in range(15)]
    |         ^^^^^^^^^
    |
help: Remove assignment to unused variable `rag_items`

F841 Local variable `status` is assigned to but never used
   --> tests/test_index_status.py:106:9
    |
105 |     try:
106 |         status = IndexStatus.load("/nonexistent/path/status.json")
    |         ^^^^^^
107 |         print("  âœ— Should have raised FileNotFoundError")
108 |     except FileNotFoundError:
    |
help: Remove assignment to unused variable `status`

F841 Local variable `status` is assigned to but never used
   --> tests/test_index_status.py:124:13
    |
122 |     try:
123 |         try:
124 |             status = IndexStatus.load(corrupt_path)
    |             ^^^^^^
125 |             print("  âœ— Should have raised JSONDecodeError")
126 |         except json.JSONDecodeError:
    |
help: Remove assignment to unused variable `status`

I001 [*] Import block is un-sorted or un-formatted
 --> tests/test_locks_ren.py:2:1
  |
2 | / import pytest
3 | | import time
4 | | import multiprocessing
5 | | from pathlib import Path
6 | | from llmc.docgen.locks import DocgenLock
  | |________________________________________^
7 |
8 |   def hold_lock(repo_root, duration):
  |
help: Organize imports

F401 [*] `pathlib.Path` imported but unused
 --> tests/test_locks_ren.py:5:21
  |
3 | import time
4 | import multiprocessing
5 | from pathlib import Path
  |                     ^^^^
6 | from llmc.docgen.locks import DocgenLock
  |
help: Remove unused import: `pathlib.Path`

F841 Local variable `start` is assigned to but never used
  --> tests/test_locks_ren.py:65:5
   |
63 |     lock = DocgenLock(tmp_path)
64 |     # Try to acquire with 2s timeout -> succeed
65 |     start = time.time()
   |     ^^^^^
66 |     assert lock.acquire(timeout=2.0)
67 |     lock.release()
   |
help: Remove assignment to unused variable `start`

F841 Local variable `result` is assigned to but never used
  --> tests/test_log_management_scripts.py:77:13
   |
75 |         script_path = scripts_dir / "llmc-clean-logs.sh"
76 |         with tempfile.TemporaryDirectory() as tmpdir:
77 |             result = subprocess.run(
   |             ^^^^^^
78 |                 [str(script_path), "--dir", tmpdir, "--check"],
79 |                 check=False,
   |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
  --> tests/test_log_management_scripts.py:89:13
   |
87 |         script_path = scripts_dir / "llmc-clean-logs.sh"
88 |         with tempfile.TemporaryDirectory() as tmpdir:
89 |             result = subprocess.run(
   |             ^^^^^^
90 |                 [str(script_path), "--dir", tmpdir, "--size", "5MB", "--check"],
91 |                 check=False,
   |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_log_management_scripts.py:101:13
    |
 99 |         script_path = scripts_dir / "llmc-clean-logs.sh"
100 |         with tempfile.TemporaryDirectory() as tmpdir:
101 |             result = subprocess.run(
    |             ^^^^^^
102 |                 [str(script_path), "--dir", tmpdir, "--check"],
103 |                 check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_log_management_scripts.py:113:13
    |
111 |         script_path = scripts_dir / "llmc-clean-logs.sh"
112 |         with tempfile.TemporaryDirectory() as tmpdir:
113 |             result = subprocess.run(
    |             ^^^^^^
114 |                 [str(script_path), "--dir", tmpdir, "--rotate"],
115 |                 check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_log_management_scripts.py:125:13
    |
123 |         script_path = scripts_dir / "llmc-clean-logs.sh"
124 |         with tempfile.TemporaryDirectory() as tmpdir:
125 |             result = subprocess.run(
    |             ^^^^^^
126 |                 [str(script_path), "--dir", tmpdir, "--rotate", "--quiet"],
127 |                 check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_log_management_scripts.py:138:13
    |
136 |         with tempfile.TemporaryDirectory() as tmpdir:
137 |             # Use a non-existent log manager path
138 |             result = subprocess.run(
    |             ^^^^^^
139 |                 [str(script_path), "--dir", tmpdir, "--check"],
140 |                 check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_log_management_scripts.py:210:13
    |
208 |         script_path = scripts_dir / "llmc_log_manager.py"
209 |         with tempfile.TemporaryDirectory() as tmpdir:
210 |             result = subprocess.run(
    |             ^^^^^^
211 |                 [str(script_path), "--check", tmpdir], check=False, capture_output=True, text=True
212 |             )
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_log_management_scripts.py:219:13
    |
217 |         script_path = scripts_dir / "llmc_log_manager.py"
218 |         with tempfile.TemporaryDirectory() as tmpdir:
219 |             result = subprocess.run(
    |             ^^^^^^
220 |                 [str(script_path), "--rotate", "--max-size", "10MB", tmpdir],
221 |                 check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_log_management_scripts.py:240:13
    |
239 |             # Test with KB suffix
240 |             result = subprocess.run(
    |             ^^^^^^
241 |                 [str(script_path), "--check", "--max-size", "512KB", tmpdir],
242 |                 check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_log_management_scripts.py:251:13
    |
249 |         script_path = scripts_dir / "llmc_log_manager.py"
250 |         with tempfile.TemporaryDirectory() as tmpdir:
251 |             result = subprocess.run(
    |             ^^^^^^
252 |                 [str(script_path), "--check", "--quiet", tmpdir],
253 |                 check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_log_management_scripts.py:262:9
    |
260 |         """Test behavior with non-existent log directory."""
261 |         script_path = scripts_dir / "llmc_log_manager.py"
262 |         result = subprocess.run(
    |         ^^^^^^
263 |             [str(script_path), "--check", "/nonexistent/path"],
264 |             check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_log_management_scripts.py:273:9
    |
271 |         """Test that log directory is required when check/rotate is specified."""
272 |         script_path = scripts_dir / "llmc_log_manager.py"
273 |         result = subprocess.run(
    |         ^^^^^^
274 |             [str(script_path), "--check"], check=False, capture_output=True, text=True
275 |         )
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_log_management_scripts.py:287:13
    |
285 |             (Path(tmpdir) / "test.jsonl").write_text('{"key": "value"}\n')
286 |
287 |             result = subprocess.run(
    |             ^^^^^^
288 |                 [str(script_path), "--check", tmpdir], check=False, capture_output=True, text=True
289 |             )
    |
help: Remove assignment to unused variable `result`

E741 Ambiguous variable name: `l`
   --> tests/test_log_management_scripts.py:299:63
    |
297 |             # Create JSONL with many lines
298 |             lines = [{"key": f"value_{i}"} for i in range(2000)]
299 |             jsonl_file.write_text("\n".join(json.dumps(l) for l in lines))
    |                                                               ^
300 |
301 |             result = subprocess.run(
    |

F841 Local variable `result` is assigned to but never used
   --> tests/test_log_management_scripts.py:301:13
    |
299 |             jsonl_file.write_text("\n".join(json.dumps(l) for l in lines))
300 |
301 |             result = subprocess.run(
    |             ^^^^^^
302 |                 [str(script_path), "--rotate", "--max-size", "0.01MB", tmpdir],
303 |                 check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `content` is assigned to but never used
   --> tests/test_log_management_scripts.py:361:13
    |
359 |         script_path = scripts_dir / "llmc_log_manager.py"
360 |         with open(script_path) as f:
361 |             content = f.read()
    |             ^^^^^^^
362 |
363 |         # Should handle config errors gracefully
    |
help: Remove assignment to unused variable `content`

I001 [*] Import block is un-sorted or un-formatted
  --> tests/test_maasl_admin_tools.py:7:1
   |
 5 |   """
 6 |
 7 | / import tempfile
 8 | | import threading
 9 | | from pathlib import Path
10 | |
11 | | import pytest
12 | |
13 | | from llmc_mcp.admin_tools import maasl_locks, maasl_stomp_stats, maasl_docgen_status
14 | | from llmc_mcp.docgen_guard import DocgenCoordinator
15 | | from llmc_mcp.locks import get_lock_manager
16 | | from llmc_mcp.maasl import MAASL
17 | | from llmc_mcp.telemetry import get_telemetry_sink, configure_telemetry
   | |______________________________________________________________________^
   |
help: Organize imports

F401 [*] `threading` imported but unused
 --> tests/test_maasl_admin_tools.py:8:8
  |
7 | import tempfile
8 | import threading
  |        ^^^^^^^^^
9 | from pathlib import Path
  |
help: Remove unused import: `threading`

F401 [*] `llmc_mcp.telemetry.configure_telemetry` imported but unused
  --> tests/test_maasl_admin_tools.py:17:52
   |
15 | from llmc_mcp.locks import get_lock_manager
16 | from llmc_mcp.maasl import MAASL
17 | from llmc_mcp.telemetry import get_telemetry_sink, configure_telemetry
   |                                                    ^^^^^^^^^^^^^^^^^^^
   |
help: Remove unused import: `llmc_mcp.telemetry.configure_telemetry`

E712 Avoid equality comparisons to `False`; use `not lock["is_expired"]:` for false checks
  --> tests/test_maasl_admin_tools.py:75:20
   |
73 |             assert lock["held_duration_ms"] >= 0
74 |             assert lock["ttl_remaining_sec"] > 0
75 |             assert lock["is_expired"] == False
   |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
76 |         finally:
77 |             lock_manager.release(
   |
help: Replace with `not lock["is_expired"]`

I001 [*] Import block is un-sorted or un-formatted
  --> tests/test_maasl_db_guard.py:8:1
   |
 6 |   """
 7 |
 8 | / import concurrent.futures
 9 | | from pathlib import Path
10 | | import pytest
11 | | import sqlite3
12 | | import tempfile
13 | | import threading
14 | | import time
15 | | from typing import List
16 | |
17 | | from llmc_mcp.db_guard import DbTransactionManager, get_db_transaction_manager
18 | | from llmc_mcp.maasl import DbBusyError, get_maasl, ResourceDescriptor
   | |_____________________________________________________________________^
   |
help: Organize imports

F401 [*] `concurrent.futures` imported but unused
  --> tests/test_maasl_db_guard.py:8:8
   |
 6 | """
 7 |
 8 | import concurrent.futures
   |        ^^^^^^^^^^^^^^^^^^
 9 | from pathlib import Path
10 | import pytest
   |
help: Remove unused import: `concurrent.futures`

UP035 `typing.List` is deprecated, use `list` instead
  --> tests/test_maasl_db_guard.py:15:1
   |
13 | import threading
14 | import time
15 | from typing import List
   | ^^^^^^^^^^^^^^^^^^^^^^^
16 |
17 | from llmc_mcp.db_guard import DbTransactionManager, get_db_transaction_manager
   |

F401 [*] `llmc_mcp.db_guard.DbTransactionManager` imported but unused
  --> tests/test_maasl_db_guard.py:17:31
   |
15 | from typing import List
16 |
17 | from llmc_mcp.db_guard import DbTransactionManager, get_db_transaction_manager
   |                               ^^^^^^^^^^^^^^^^^^^^
18 | from llmc_mcp.maasl import DbBusyError, get_maasl, ResourceDescriptor
   |
help: Remove unused import: `llmc_mcp.db_guard.DbTransactionManager`

F401 [*] `llmc_mcp.maasl.DbBusyError` imported but unused
  --> tests/test_maasl_db_guard.py:18:28
   |
17 | from llmc_mcp.db_guard import DbTransactionManager, get_db_transaction_manager
18 | from llmc_mcp.maasl import DbBusyError, get_maasl, ResourceDescriptor
   |                            ^^^^^^^^^^^
   |
help: Remove unused import

F401 [*] `llmc_mcp.maasl.get_maasl` imported but unused
  --> tests/test_maasl_db_guard.py:18:41
   |
17 | from llmc_mcp.db_guard import DbTransactionManager, get_db_transaction_manager
18 | from llmc_mcp.maasl import DbBusyError, get_maasl, ResourceDescriptor
   |                                         ^^^^^^^^^
   |
help: Remove unused import

UP006 [*] Use `list` instead of `List` for type annotation
  --> tests/test_maasl_db_guard.py:80:14
   |
78 |     """Test concurrent writes to different logical databases succeed."""
79 |     barrier = threading.Barrier(2)
80 |     results: List[bool] = []
   |              ^^^^
81 |     lock = threading.Lock()
   |
help: Replace with `list`

UP006 [*] Use `list` instead of `List` for type annotation
   --> tests/test_maasl_db_guard.py:138:14
    |
136 |     barrier = threading.Barrier(3)
137 |     start_event = threading.Event()
138 |     results: List[bool] = []
    |              ^^^^
139 |     errors: List[Exception] = []
140 |     lock = threading.Lock()
    |
help: Replace with `list`

UP006 [*] Use `list` instead of `List` for type annotation
   --> tests/test_maasl_db_guard.py:139:13
    |
137 |     start_event = threading.Event()
138 |     results: List[bool] = []
139 |     errors: List[Exception] = []
    |             ^^^^
140 |     lock = threading.Lock()
    |
help: Replace with `list`

F841 Local variable `failures` is assigned to but never used
   --> tests/test_maasl_db_guard.py:181:5
    |
179 |     # Results may vary based on timing, but these properties must hold:
180 |     successes = [r for r in results if r is True]
181 |     failures = [r for r in results if r is False]
    |     ^^^^^^^^
182 |     
183 |     # 1. At least one agent succeeded (liveness)
    |
help: Remove assignment to unused variable `failures`

E722 Do not use bare `except`
   --> tests/test_maasl_db_guard.py:272:13
    |
270 |                 with mgr2.write_transaction(agent_id="agent2", session_id="s2", operation_mode="interactive") as c2:
271 |                     c2.execute("INSERT INTO test VALUES (2, 200)")
272 |             except:
    |             ^^^^^^
273 |                 pass  # Expected - different MAASL locks would conflict
    |

UP006 [*] Use `list` instead of `List` for type annotation
   --> tests/test_maasl_db_guard.py:307:14
    |
305 |     """
306 |     barrier = threading.Barrier(5)
307 |     results: List[bool] = []
    |              ^^^^
308 |     lock = threading.Lock()
    |
help: Replace with `list`

E722 Do not use bare `except`
   --> tests/test_maasl_db_guard.py:326:13
    |
324 |                     results.append(True)
325 |                 break
326 |             except:
    |             ^^^^^^
327 |                 time.sleep(0.01)
328 |                 continue
    |

I001 [*] Import block is un-sorted or un-formatted
  --> tests/test_maasl_docgen.py:7:1
   |
 5 |   """
 6 |
 7 | / import tempfile
 8 | | import threading
 9 | | import time
10 | | from pathlib import Path
11 | |
12 | | import pytest
13 | |
14 | | from llmc_mcp.docgen_guard import DocgenCoordinator, DocgenResult
15 | | from llmc_mcp.maasl import MAASL
   | |________________________________^
   |
help: Organize imports

F401 [*] `time` imported but unused
  --> tests/test_maasl_docgen.py:9:8
   |
 7 | import tempfile
 8 | import threading
 9 | import time
   |        ^^^^
10 | from pathlib import Path
   |
help: Remove unused import: `time`

F401 [*] `llmc_mcp.docgen_guard.DocgenResult` imported but unused
  --> tests/test_maasl_docgen.py:14:54
   |
12 | import pytest
13 |
14 | from llmc_mcp.docgen_guard import DocgenCoordinator, DocgenResult
   |                                                      ^^^^^^^^^^^^
15 | from llmc_mcp.maasl import MAASL
   |
help: Remove unused import: `llmc_mcp.docgen_guard.DocgenResult`

F541 [*] f-string without any placeholders
   --> tests/test_maasl_docgen.py:399:39
    |
397 |         # Should be newest BUFFER_SIZE
398 |         assert status[0].agent_id == f"agent-{DocgenCoordinator.BUFFER_SIZE + 49}"
399 |         assert status[-1].agent_id == f"agent-50"
    |                                       ^^^^^^^^^^^
    |
help: Remove extraneous `f` prefix

I001 [*] Import block is un-sorted or un-formatted
  --> tests/test_maasl_facade.py:12:1
   |
10 |   """
11 |
12 | / import pytest
13 | | import time
14 | | import threading
15 | | from llmc_mcp.maasl import (
16 | |     ResourceClass,
17 | |     ResourceDescriptor,
18 | |     PolicyRegistry,
19 | |     MAASL,
20 | |     ResourceBusyError,
21 | |     DbBusyError,
22 | |     DocgenStaleError,
23 | |     StaleVersionError,
24 | |     MaaslInternalError,
25 | | )
   | |_^
   |
help: Organize imports

F401 [*] `time` imported but unused
  --> tests/test_maasl_facade.py:13:8
   |
12 | import pytest
13 | import time
   |        ^^^^
14 | import threading
15 | from llmc_mcp.maasl import (
   |
help: Remove unused import: `time`

I001 [*] Import block is un-sorted or un-formatted
  --> tests/test_maasl_integration.py:8:1
   |
 6 |   """
 7 |
 8 | / import concurrent.futures
 9 | | import os
10 | | from pathlib import Path
11 | | import pytest
12 | | import threading
13 | | import time
14 | | import tempfile
15 | | from typing import List
16 | |
17 | | from llmc_mcp.context import McpSessionContext
18 | | from llmc_mcp.maasl import get_maasl, ResourceBusyError
19 | | from llmc_mcp.tools.fs_protected import (
20 | |     write_file_protected,
21 | |     edit_block_protected,
22 | |     move_file_protected,
23 | |     delete_file_protected,
24 | | )
25 | | from llmc_mcp.tools.fs import FsResult
   | |______________________________________^
   |
help: Organize imports

F401 [*] `os` imported but unused
  --> tests/test_maasl_integration.py:9:8
   |
 8 | import concurrent.futures
 9 | import os
   |        ^^
10 | from pathlib import Path
11 | import pytest
   |
help: Remove unused import: `os`

UP035 `typing.List` is deprecated, use `list` instead
  --> tests/test_maasl_integration.py:15:1
   |
13 | import time
14 | import tempfile
15 | from typing import List
   | ^^^^^^^^^^^^^^^^^^^^^^^
16 |
17 | from llmc_mcp.context import McpSessionContext
   |

F401 [*] `llmc_mcp.context.McpSessionContext` imported but unused
  --> tests/test_maasl_integration.py:17:30
   |
15 | from typing import List
16 |
17 | from llmc_mcp.context import McpSessionContext
   |                              ^^^^^^^^^^^^^^^^^
18 | from llmc_mcp.maasl import get_maasl, ResourceBusyError
19 | from llmc_mcp.tools.fs_protected import (
   |
help: Remove unused import: `llmc_mcp.context.McpSessionContext`

F401 [*] `llmc_mcp.maasl.get_maasl` imported but unused
  --> tests/test_maasl_integration.py:18:28
   |
17 | from llmc_mcp.context import McpSessionContext
18 | from llmc_mcp.maasl import get_maasl, ResourceBusyError
   |                            ^^^^^^^^^
19 | from llmc_mcp.tools.fs_protected import (
20 |     write_file_protected,
   |
help: Remove unused import

F401 [*] `llmc_mcp.maasl.ResourceBusyError` imported but unused
  --> tests/test_maasl_integration.py:18:39
   |
17 | from llmc_mcp.context import McpSessionContext
18 | from llmc_mcp.maasl import get_maasl, ResourceBusyError
   |                                       ^^^^^^^^^^^^^^^^^
19 | from llmc_mcp.tools.fs_protected import (
20 |     write_file_protected,
   |
help: Remove unused import

UP006 [*] Use `list` instead of `List` for type annotation
   --> tests/test_maasl_integration.py:110:14
    |
108 |     """
109 |     barrier = threading.Barrier(3)  # Synchronize 3 agents
110 |     results: List[FsResult] = []
    |              ^^^^
111 |     lock = threading.Lock()
112 |     start_event = threading.Event()
    |
help: Replace with `list`

I001 [*] Import block is un-sorted or un-formatted
   --> tests/test_maasl_integration.py:130:9
    |
128 |             return True
129 |         
130 |         from llmc_mcp.maasl import get_maasl, ResourceDescriptor
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
131 |         
132 |         resource = ResourceDescriptor(
    |
help: Organize imports

F811 [*] Redefinition of unused `get_maasl` from line 18
   --> tests/test_maasl_integration.py:130:36
    |
128 |             return True
129 |         
130 |         from llmc_mcp.maasl import get_maasl, ResourceDescriptor
    |                                    ^^^^^^^^^ `get_maasl` redefined here
131 |         
132 |         resource = ResourceDescriptor(
    |
   ::: tests/test_maasl_integration.py:18:28
    |
 17 | from llmc_mcp.context import McpSessionContext
 18 | from llmc_mcp.maasl import get_maasl, ResourceBusyError
    |                            --------- previous definition of `get_maasl` here
 19 | from llmc_mcp.tools.fs_protected import (
 20 |     write_file_protected,
    |
help: Remove definition: `get_maasl`

UP006 [*] Use `list` instead of `List` for type annotation
   --> tests/test_maasl_integration.py:221:14
    |
219 |     """Test concurrent edits to same file - protected by MAASL."""
220 |     barrier = threading.Barrier(2)
221 |     results: List[FsResult] = []
    |              ^^^^
222 |     lock = threading.Lock()
    |
help: Replace with `list`

UP006 [*] Use `list` instead of `List` for type annotation
   --> tests/test_maasl_integration.py:272:14
    |
271 |     barrier = threading.Barrier(2)
272 |     results: List[FsResult] = []
    |              ^^^^
273 |     lock = threading.Lock()
    |
help: Replace with `list`

UP006 [*] Use `list` instead of `List` for type annotation
   --> tests/test_maasl_integration.py:320:14
    |
319 |     barrier = threading.Barrier(2)
320 |     results: List[FsResult] = []
    |              ^^^^
321 |     lock = threading.Lock()
    |
help: Replace with `list`

UP006 [*] Use `list` instead of `List` for type annotation
   --> tests/test_maasl_integration.py:460:14
    |
459 |     barrier = threading.Barrier(5)
460 |     results: List[FsResult] = []
    |              ^^^^
461 |     lock = threading.Lock()
    |
help: Replace with `list`

I001 [*] Import block is un-sorted or un-formatted
  --> tests/test_maasl_locks.py:13:1
   |
11 |   """
12 |
13 | / import pytest
14 | | import time
15 | | import threading
16 | | from llmc_mcp.locks import (
17 | |     LockManager,
18 | |     LockState,
19 | |     LockHandle,
20 | |     ResourceBusyError,
21 | | )
   | |_^
   |
help: Organize imports

F401 [*] `llmc_mcp.locks.LockHandle` imported but unused
  --> tests/test_maasl_locks.py:19:5
   |
17 |     LockManager,
18 |     LockState,
19 |     LockHandle,
   |     ^^^^^^^^^^
20 |     ResourceBusyError,
21 | )
   |
help: Remove unused import: `llmc_mcp.locks.LockHandle`

F841 Local variable `initial_expiry` is assigned to but never used
   --> tests/test_maasl_locks.py:260:9
    |
258 |         )
259 |         
260 |         initial_expiry = handle.lease_expiry_ts
    |         ^^^^^^^^^^^^^^
261 |         
262 |         # Renew lease
    |
help: Remove assignment to unused variable `initial_expiry`

I001 [*] Import block is un-sorted or un-formatted
  --> tests/test_maasl_merge.py:8:1
   |
 6 |   """
 7 |
 8 | / import pytest
 9 | | import threading
10 | | from typing import List
11 | |
12 | | from llmc_mcp.merge_meta import GraphPatch, MergeEngine, MergeResult, get_merge_engine
13 | | from tools.rag.graph import GraphStore
14 | | from tools.rag.schema import Entity
   | |___________________________________^
   |
help: Organize imports

UP035 `typing.List` is deprecated, use `list` instead
  --> tests/test_maasl_merge.py:10:1
   |
 8 | import pytest
 9 | import threading
10 | from typing import List
   | ^^^^^^^^^^^^^^^^^^^^^^^
11 |
12 | from llmc_mcp.merge_meta import GraphPatch, MergeEngine, MergeResult, get_merge_engine
   |

F401 [*] `llmc_mcp.merge_meta.MergeEngine` imported but unused
  --> tests/test_maasl_merge.py:12:45
   |
10 | from typing import List
11 |
12 | from llmc_mcp.merge_meta import GraphPatch, MergeEngine, MergeResult, get_merge_engine
   |                                             ^^^^^^^^^^^
13 | from tools.rag.graph import GraphStore
14 | from tools.rag.schema import Entity
   |
help: Remove unused import: `llmc_mcp.merge_meta.MergeEngine`

F401 [*] `tools.rag.schema.Entity` imported but unused
  --> tests/test_maasl_merge.py:14:30
   |
12 | from llmc_mcp.merge_meta import GraphPatch, MergeEngine, MergeResult, get_merge_engine
13 | from tools.rag.graph import GraphStore
14 | from tools.rag.schema import Entity
   |                              ^^^^^^
   |
help: Remove unused import: `tools.rag.schema.Entity`

UP006 [*] Use `list` instead of `List` for type annotation
   --> tests/test_maasl_merge.py:162:14
    |
160 |     Core anti-stomp test for graph operations.
161 |     """
162 |     results: List[MergeResult] = []
    |              ^^^^
163 |     lock = threading.Lock()
    |
help: Replace with `list`

I001 [*] Import block is un-sorted or un-formatted
  --> tests/test_maasl_phase8.py:8:1
   |
 6 |   """
 7 |
 8 | / import tempfile
 9 | | import threading
10 | | import time
11 | | from pathlib import Path
12 | | from typing import List
13 | |
14 | | import pytest
15 | |
16 | | from llmc_mcp.admin_tools import maasl_locks, maasl_stomp_stats
17 | | from llmc_mcp.docgen_guard import DocgenCoordinator
18 | | from llmc_mcp.maasl import MAASL, ResourceDescriptor
19 | | from llmc_mcp.tools.fs_protected import write_file_protected
20 | | from llmc_mcp.merge_meta import MergeEngine, GraphPatch
   | |_______________________________________________________^
   |
help: Organize imports

F401 [*] `tempfile` imported but unused
  --> tests/test_maasl_phase8.py:8:8
   |
 6 | """
 7 |
 8 | import tempfile
   |        ^^^^^^^^
 9 | import threading
10 | import time
   |
help: Remove unused import: `tempfile`

F401 [*] `pathlib.Path` imported but unused
  --> tests/test_maasl_phase8.py:11:21
   |
 9 | import threading
10 | import time
11 | from pathlib import Path
   |                     ^^^^
12 | from typing import List
   |
help: Remove unused import: `pathlib.Path`

UP035 `typing.List` is deprecated, use `list` instead
  --> tests/test_maasl_phase8.py:12:1
   |
10 | import time
11 | from pathlib import Path
12 | from typing import List
   | ^^^^^^^^^^^^^^^^^^^^^^^
13 |
14 | import pytest
   |

F401 [*] `typing.List` imported but unused
  --> tests/test_maasl_phase8.py:12:20
   |
10 | import time
11 | from pathlib import Path
12 | from typing import List
   |                    ^^^^
13 |
14 | import pytest
   |
help: Remove unused import: `typing.List`

F401 [*] `llmc_mcp.tools.fs_protected.write_file_protected` imported but unused
  --> tests/test_maasl_phase8.py:19:41
   |
17 | from llmc_mcp.docgen_guard import DocgenCoordinator
18 | from llmc_mcp.maasl import MAASL, ResourceDescriptor
19 | from llmc_mcp.tools.fs_protected import write_file_protected
   |                                         ^^^^^^^^^^^^^^^^^^^^
20 | from llmc_mcp.merge_meta import MergeEngine, GraphPatch
   |
help: Remove unused import: `llmc_mcp.tools.fs_protected.write_file_protected`

F401 [*] `llmc_mcp.merge_meta.MergeEngine` imported but unused
  --> tests/test_maasl_phase8.py:20:33
   |
18 | from llmc_mcp.maasl import MAASL, ResourceDescriptor
19 | from llmc_mcp.tools.fs_protected import write_file_protected
20 | from llmc_mcp.merge_meta import MergeEngine, GraphPatch
   |                                 ^^^^^^^^^^^
   |
help: Remove unused import: `llmc_mcp.merge_meta.MergeEngine`

F841 Local variable `patch` is assigned to but never used
  --> tests/test_maasl_phase8.py:43:13
   |
42 |             # 3. Graph update (MERGE_META)
43 |             patch = GraphPatch(
   |             ^^^^^
44 |                 nodes_to_add=[{"id": "test_node", "kind": "file"}],
45 |                 edges_to_add=[],
   |
help: Remove assignment to unused variable `patch`

B007 Loop control variable `i` not used within loop body
   --> tests/test_maasl_phase8.py:390:13
    |
389 |         # SUCCESS: All files have correct content (no stomps)
390 |         for i, file in enumerate(files):
    |             ^
391 |             content = file.read_text()
392 |             assert "initial" in content
    |
help: Rename unused `i` to `_i`

I001 [*] Import block is un-sorted or un-formatted
   --> tests/test_maasl_phase8.py:408:9
    |
407 |         # Verify the engine exists and is importable
408 |         from llmc_mcp.merge_meta import MergeEngine, GraphPatch
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
409 |         
410 |         engine = MergeEngine()
    |
help: Organize imports

F811 [*] Redefinition of unused `MergeEngine` from line 20
   --> tests/test_maasl_phase8.py:408:41
    |
407 |         # Verify the engine exists and is importable
408 |         from llmc_mcp.merge_meta import MergeEngine, GraphPatch
    |                                         ^^^^^^^^^^^ `MergeEngine` redefined here
409 |         
410 |         engine = MergeEngine()
    |
   ::: tests/test_maasl_phase8.py:20:33
    |
 18 | from llmc_mcp.maasl import MAASL, ResourceDescriptor
 19 | from llmc_mcp.tools.fs_protected import write_file_protected
 20 | from llmc_mcp.merge_meta import MergeEngine, GraphPatch
    |                                 ----------- previous definition of `MergeEngine` here
    |
help: Remove definition: `MergeEngine`

F401 [*] `llmc_mcp.merge_meta.GraphPatch` imported but unused
   --> tests/test_maasl_phase8.py:408:54
    |
407 |         # Verify the engine exists and is importable
408 |         from llmc_mcp.merge_meta import MergeEngine, GraphPatch
    |                                                      ^^^^^^^^^^
409 |         
410 |         engine = MergeEngine()
    |
help: Remove unused import: `llmc_mcp.merge_meta.GraphPatch`

F841 Local variable `mock_routing_enabled` is assigned to but never used
  --> tests/test_multi_route_retrieval.py:22:14
   |
20 |         patch(
21 |             "tools.rag.search.is_query_routing_enabled", return_value=True
22 |         ) as mock_routing_enabled,
   |              ^^^^^^^^^^^^^^^^^^^^
23 |     ):
24 |         # Setup basic mocks
   |
help: Remove assignment to unused variable `mock_routing_enabled`

PLW0127 Self-assignment of variable `UTC`
  --> tests/test_multiple_registry_entries.py:16:1
   |
14 | from tools.rag_daemon.workers import WorkerPool
15 |
16 | UTC = UTC
   | ^^^
17 |
18 | # Calculate REPO_ROOT dynamically
   |

PLW2901 `with` statement variable `home` overwritten by assignment target
  --> tests/test_multiple_registry_entries.py:25:9
   |
23 |     """Registry with multiple repos respects different min_refresh_interval."""
24 |     with tempfile.TemporaryDirectory() as home:
25 |         home = Path(home)
   |         ^^^^
26 |
27 |         # Create multiple repos
   |

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_multiple_registry_entries.py:180:9
    |
178 |     """Registry with mixed eligibility states (some eligible, some not)."""
179 |     with tempfile.TemporaryDirectory() as home:
180 |         home = Path(home)
    |         ^^^^
181 |
182 |         # Create 5 repos
    |

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_multiple_registry_entries.py:269:9
    |
267 |     """Registry entries without explicit interval use default (tick_interval)."""
268 |     with tempfile.TemporaryDirectory() as home:
269 |         home = Path(home)
    |         ^^^^
270 |
271 |         # Create repos
    |

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_multiple_registry_entries.py:361:9
    |
359 |     """Registry.load_all() returns all registered entries."""
360 |     with tempfile.TemporaryDirectory() as home:
361 |         home = Path(home)
    |         ^^^^
362 |
363 |         # Create repos
    |

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_multiple_registry_entries.py:424:9
    |
422 |     """Registry with empty file returns empty dict."""
423 |     with tempfile.TemporaryDirectory() as home:
424 |         home = Path(home)
    |         ^^^^
425 |
426 |         registry_path = home / "empty.yml"
    |

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_multiple_registry_entries.py:453:9
    |
451 |     """Registry with non-existent file returns empty dict (doesn't crash)."""
452 |     with tempfile.TemporaryDirectory() as home:
453 |         home = Path(home)
    |         ^^^^
454 |
455 |         registry_path = home / "nonexistent.yml"
    |

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_multiple_registry_entries.py:482:9
    |
480 |     """Registry with invalid repo paths doesn't crash on load."""
481 |     with tempfile.TemporaryDirectory() as home:
482 |         home = Path(home)
    |         ^^^^
483 |
484 |         # Create registry with non-existent paths
    |

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_multiple_registry_entries.py:533:9
    |
531 |     """Registry entries can use timedelta objects for intervals."""
532 |     with tempfile.TemporaryDirectory() as home:
533 |         home = Path(home)
    |         ^^^^
534 |
535 |         repo = home / "repo"
    |

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_multiple_registry_entries.py:582:9
    |
580 |     """refresh_all flag forces all repos to refresh regardless of intervals."""
581 |     with tempfile.TemporaryDirectory() as home:
582 |         home = Path(home)
    |         ^^^^
583 |
584 |         # Create 3 repos with different intervals
    |

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_multiple_registry_entries.py:677:9
    |
675 |     """refresh_<repo_id>.flag forces specific repo to refresh."""
676 |     with tempfile.TemporaryDirectory() as home:
677 |         home = Path(home)
    |         ^^^^
678 |
679 |         # Create repos
    |

E741 Ambiguous variable name: `l`
  --> tests/test_p0_acceptance.py:59:5
   |
57 |     s = tool_rag_search(repo_root=str(repo), query=q, limit=5)
58 |     w = tool_rag_where_used(repo_root=str(repo), symbol=q, limit=5)
59 |     l = tool_rag_lineage(repo_root=str(repo), symbol=q, direction="downstream", max_results=5)
   |     ^
60 |     for res in (s, w, l):
61 |         assert hasattr(res, "items")
   |

F841 Local variable `tracker` is assigned to but never used
  --> tests/test_rag_analytics.py:88:13
   |
86 |             db_path = Path(tmpdir) / "analytics.db"
87 |
88 |             tracker = QueryTracker(db_path)
   |             ^^^^^^^
89 |
90 |             # Verify database file was created
   |
help: Remove assignment to unused variable `tracker`

B017 Do not assert blind exception: `Exception`
   --> tests/test_rag_benchmark.py:199:14
    |
198 |         # Should not be able to modify after creation
199 |         with pytest.raises(Exception):
    |              ^^^^^^^^^^^^^^^^^^^^^^^^
200 |             case.name = "modified"
    |

F841 Local variable `results` is assigned to but never used
   --> tests/test_rag_benchmark.py:399:9
    |
397 |         mock_build_backend.return_value = mock_backend
398 |
399 |         results = run_embedding_benchmark()
    |         ^^^^^^^
400 |
401 |         # Should call embed_queries for each case
    |
help: Remove assignment to unused variable `results`

B017 Do not assert blind exception: `Exception`
   --> tests/test_rag_benchmark.py:440:14
    |
439 |         # Should raise exception
440 |         with pytest.raises(Exception):
    |              ^^^^^^^^^^^^^^^^^^^^^^^^
441 |             run_embedding_benchmark()
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
  --> tests/test_rag_comprehensive.py:87:13
   |
85 |             return result
86 |         except subprocess.TimeoutExpired:
87 |             raise Exception(f"Command timed out after {timeout}s: {' '.join(cmd)}")
   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
88 |
89 |     def create_temp_repo(self) -> Path:
   |

B017 Do not assert blind exception: `Exception`
  --> tests/test_rag_daemon_complete.py:95:14
   |
93 |         mock_env.return_value = str(config_file)
94 |         # PyYAML should raise an exception
95 |         with pytest.raises(Exception):
   |              ^^^^^^^^^^^^^^^^^^^^^^^^
96 |             load_config()
   |

F841 Local variable `state_store_dir` is assigned to but never used
   --> tests/test_rag_daemon_complete.py:104:5
    |
102 |     config_file.write_text(yaml.dump({}))
103 |
104 |     state_store_dir = tmp_path / "state"
    |     ^^^^^^^^^^^^^^^
105 |     log_dir = tmp_path / "logs"
106 |     control_dir = tmp_path / "control"
    |
help: Remove assignment to unused variable `state_store_dir`

F841 Local variable `log_dir` is assigned to but never used
   --> tests/test_rag_daemon_complete.py:105:5
    |
104 |     state_store_dir = tmp_path / "state"
105 |     log_dir = tmp_path / "logs"
    |     ^^^^^^^
106 |     control_dir = tmp_path / "control"
    |
help: Remove assignment to unused variable `log_dir`

F841 Local variable `control_dir` is assigned to but never used
   --> tests/test_rag_daemon_complete.py:106:5
    |
104 |     state_store_dir = tmp_path / "state"
105 |     log_dir = tmp_path / "logs"
106 |     control_dir = tmp_path / "control"
    |     ^^^^^^^^^^^
107 |
108 |     with patch("os.environ.get") as mock_env:
    |
help: Remove assignment to unused variable `control_dir`

F601 Dictionary key literal `"max_concurrent_jobs"` repeated
   --> tests/test_rag_daemon_e2e_smoke.py:124:17
    |
122 |                 "tick_interval_seconds": 60,
123 |                 "max_concurrent_jobs": 2,
124 |                 "max_concurrent_jobs": 2,
    |                 ^^^^^^^^^^^^^^^^^^^^^
125 |                 "max_consecutive_failures": 3,
126 |                 "base_backoff_seconds": 60,
    |
help: Remove repeated key literal `"max_concurrent_jobs"`

F841 Local variable `initial_status` is assigned to but never used
   --> tests/test_rag_daemon_e2e_smoke.py:213:5
    |
212 |     # Test 9: Verify idempotent behavior - running again should work
213 |     initial_status = final_state.last_run_status
    |     ^^^^^^^^^^^^^^
214 |     scheduler.run_once()
    |
help: Remove assignment to unused variable `initial_status`

B007 Loop control variable `expected_id_prefix` not used within loop body
   --> tests/test_rag_daemon_e2e_smoke.py:283:20
    |
281 |     from tools.rag_repo.utils import generate_repo_id
282 |
283 |     for repo_path, expected_id_prefix in repos:
    |                    ^^^^^^^^^^^^^^^^^^
284 |         inspection = inspect_repo(repo_path, tool_config)
285 |         plan = plan_workspace(repo_path, tool_config, inspection)
    |
help: Rename unused `expected_id_prefix` to `_expected_id_prefix`

F841 Local variable `state` is assigned to but never used
  --> tests/test_rag_daemon_scheduler_edge_cases.py:62:9
   |
61 |         # Simulate many failures
62 |         state = RepoState(
   |         ^^^^^
63 |             repo_id="test_repo",
64 |             last_run_status="error",
   |
help: Remove assignment to unused variable `state`

F841 Local variable `base` is assigned to but never used
   --> tests/test_rag_daemon_scheduler_edge_cases.py:99:9
    |
 97 |     def test_exponential_backoff_multiplier_progression(self, failure_count, expected_multiplier):
 98 |         """Test backoff multiplier increases as 2^(n-1)."""
 99 |         base = 60
    |         ^^^^
100 |         multiplier = 2 ** (failure_count - 1)
101 |         assert multiplier == expected_multiplier
    |
help: Remove assignment to unused variable `base`

F841 Local variable `scheduler` is assigned to but never used
   --> tests/test_rag_daemon_scheduler_edge_cases.py:163:9
    |
161 |         mock_state_store.load_all.return_value = {}
162 |
163 |         scheduler = Scheduler(config, mock_registry, mock_state_store, mock_workers)
    |         ^^^^^^^^^
164 |
165 |         # The scheduler should handle this situation
    |
help: Remove assignment to unused variable `scheduler`

F841 Local variable `config` is assigned to but never used
  --> tests/test_rag_failures.py:76:9
   |
74 |     with tempfile.TemporaryDirectory() as tmpdir:
75 |         # Create a config
76 |         config = {
   |         ^^^^^^
77 |             "tick_interval_seconds": 60,
78 |             "max_concurrent_jobs": 2,
   |
help: Remove assignment to unused variable `config`

F841 Local variable `status` is assigned to but never used
  --> tests/test_rag_nav_build_graph.py:30:5
   |
29 |     # Act: build graph.
30 |     status = build_graph_for_repo(repo_root)
   |     ^^^^^^
31 |
32 |     # Assert: status persisted and marked fresh.
   |
help: Remove assignment to unused variable `status`

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
  --> tests/test_rag_nav_comprehensive.py:86:13
   |
84 |             return result
85 |         except subprocess.TimeoutExpired:
86 |             raise Exception(f"Command timed out after {timeout}s: {' '.join(cmd)}")
   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
87 |
88 |     def create_temp_repo(self) -> Path:
   |

F401 `tools.rag_nav.metadata.IndexStatus` imported but unused; consider using `importlib.util.find_spec` to test for availability
   --> tests/test_rag_nav_comprehensive.py:312:52
    |
310 |         try:
311 |             try:
312 |                 from tools.rag_nav.metadata import IndexStatus, load_status, save_status
    |                                                    ^^^^^^^^^^^
313 |
314 |                 # Create corrupt file
    |
help: Remove unused import

F401 `tools.rag_nav.metadata.save_status` imported but unused; consider using `importlib.util.find_spec` to test for availability
   --> tests/test_rag_nav_comprehensive.py:312:78
    |
310 |         try:
311 |             try:
312 |                 from tools.rag_nav.metadata import IndexStatus, load_status, save_status
    |                                                                              ^^^^^^^^^^^
313 |
314 |                 # Create corrupt file
    |
help: Remove unused import

F841 Local variable `data` is assigned to but never used
   --> tests/test_rag_nav_comprehensive.py:346:21
    |
344 |                 # Try to parse
345 |                 try:
346 |                     data = json.loads(status_file.read_text())
    |                     ^^^^
347 |                     self.add_result(
348 |                         "index_status_corrupt_file",
    |
help: Remove assignment to unused variable `data`

F401 `tools.rag_nav.cli` imported but unused; consider using `importlib.util.find_spec` to test for availability
   --> tests/test_rag_nav_comprehensive.py:487:28
    |
485 |                 # Check if module exists
486 |                 try:
487 |                     import tools.rag_nav.cli
    |                            ^^^^^^^^^^^^^^^^^
488 |
489 |                     self.add_result(
    |
help: Remove unused import: `tools.rag_nav.cli`

F841 Local variable `files` is assigned to but never used
    --> tests/test_rag_nav_comprehensive.py:1344:21
     |
1342 |                 # Should find callers
1343 |                 if result.items:
1344 |                     files = [getattr(item, "file", str(item)) for item in result.items]
     |                     ^^^^^
1345 |                     self.add_result(
1346 |                         "e2e_simple_where_used",
     |
help: Remove assignment to unused variable `files`

F401 `tools.rag_nav.models.SearchItem` imported but unused; consider using `importlib.util.find_spec` to test for availability
  --> tests/test_rag_nav_enriched_tools.py:34:46
   |
32 |         """Test that tool_rag_search attaches enrichment from graph nodes."""
33 |         try:
34 |             from tools.rag_nav.models import SearchItem, SearchResult, Snippet, SnippetLocation
   |                                              ^^^^^^^^^^
35 |             from tools.rag_nav.tool_handlers import tool_rag_search
36 |         except ImportError:
   |
help: Remove unused import

F401 `tools.rag_nav.models.SearchResult` imported but unused; consider using `importlib.util.find_spec` to test for availability
  --> tests/test_rag_nav_enriched_tools.py:34:58
   |
32 |         """Test that tool_rag_search attaches enrichment from graph nodes."""
33 |         try:
34 |             from tools.rag_nav.models import SearchItem, SearchResult, Snippet, SnippetLocation
   |                                                          ^^^^^^^^^^^^
35 |             from tools.rag_nav.tool_handlers import tool_rag_search
36 |         except ImportError:
   |
help: Remove unused import

F401 `tools.rag_nav.models.Snippet` imported but unused; consider using `importlib.util.find_spec` to test for availability
  --> tests/test_rag_nav_enriched_tools.py:34:72
   |
32 |         """Test that tool_rag_search attaches enrichment from graph nodes."""
33 |         try:
34 |             from tools.rag_nav.models import SearchItem, SearchResult, Snippet, SnippetLocation
   |                                                                        ^^^^^^^
35 |             from tools.rag_nav.tool_handlers import tool_rag_search
36 |         except ImportError:
   |
help: Remove unused import

F401 `tools.rag_nav.models.SnippetLocation` imported but unused; consider using `importlib.util.find_spec` to test for availability
  --> tests/test_rag_nav_enriched_tools.py:34:81
   |
32 |         """Test that tool_rag_search attaches enrichment from graph nodes."""
33 |         try:
34 |             from tools.rag_nav.models import SearchItem, SearchResult, Snippet, SnippetLocation
   |                                                                                 ^^^^^^^^^^^^^^^
35 |             from tools.rag_nav.tool_handlers import tool_rag_search
36 |         except ImportError:
   |
help: Remove unused import

F841 Local variable `mock_load_idx` is assigned to but never used
   --> tests/test_rag_nav_enriched_tools.py:118:72
    |
116 |         with (
117 |             patch("tools.rag_nav.tool_handlers._compute_route", return_value=mock_route),
118 |             patch("tools.rag_nav.tool_handlers.load_graph_indices") as mock_load_idx,
    |                                                                        ^^^^^^^^^^^^^
119 |             patch(
120 |                 "tools.rag_nav.tool_handlers.where_used_files_from_index",
    |
help: Remove assignment to unused variable `mock_load_idx`

F841 Local variable `result` is assigned to but never used
   --> tests/test_rag_operation_scripts.py:99:9
    |
 97 |         """Test that query from stdin is read correctly."""
 98 |         script_path = scripts_dir / "rag_plan_helper.sh"
 99 |         result = subprocess.run(
    |         ^^^^^^
100 |             [str(script_path)], check=False, capture_output=True, text=True, input="test query"
101 |         )
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_rag_operation_scripts.py:192:9
    |
190 |         """Test that script accepts query as command line args."""
191 |         script_path = scripts_dir / "rag_plan_snippet.py"
192 |         result = subprocess.run(
    |         ^^^^^^
193 |             [str(script_path), "test", "query", "string"],
194 |             check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_rag_operation_scripts.py:204:9
    |
202 |         """Test that script reads query from stdin."""
203 |         script_path = scripts_dir / "rag_plan_snippet.py"
204 |         result = subprocess.run(
    |         ^^^^^^
205 |             [str(script_path)],
206 |             check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_rag_operation_scripts.py:217:13
    |
215 |         script_path = scripts_dir / "rag_plan_snippet.py"
216 |         with tempfile.TemporaryDirectory() as tmpdir:
217 |             result = subprocess.run(
    |             ^^^^^^
218 |                 [str(script_path), "--repo", tmpdir, "test query"],
219 |                 check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_rag_operation_scripts.py:228:9
    |
226 |         """Test --limit flag."""
227 |         script_path = scripts_dir / "rag_plan_snippet.py"
228 |         result = subprocess.run(
    |         ^^^^^^
229 |             [str(script_path), "--limit", "10", "test query"],
230 |             check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_rag_operation_scripts.py:239:9
    |
237 |         """Test --min-score flag."""
238 |         script_path = scripts_dir / "rag_plan_snippet.py"
239 |         result = subprocess.run(
    |         ^^^^^^
240 |             [str(script_path), "--min-score", "0.5", "test query"],
241 |             check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_rag_operation_scripts.py:250:9
    |
248 |         """Test --min-confidence flag."""
249 |         script_path = scripts_dir / "rag_plan_snippet.py"
250 |         result = subprocess.run(
    |         ^^^^^^
251 |             [str(script_path), "--min-confidence", "0.7", "test query"],
252 |             check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_rag_operation_scripts.py:261:9
    |
259 |         """Test --no-log flag."""
260 |         script_path = scripts_dir / "rag_plan_snippet.py"
261 |         result = subprocess.run(
    |         ^^^^^^
262 |             [str(script_path), "--no-log", "test query"],
263 |             check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_rag_operation_scripts.py:272:9
    |
270 |         """Test behavior with missing repo."""
271 |         script_path = scripts_dir / "rag_plan_snippet.py"
272 |         result = subprocess.run(
    |         ^^^^^^
273 |             [str(script_path), "--repo", "/nonexistent/path", "test query"],
274 |             check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_rag_operation_scripts.py:321:9
    |
319 |         """Test --help flag displays usage."""
320 |         script_path = scripts_dir / "rag" / "index_workspace.py"
321 |         result = subprocess.run(
    |         ^^^^^^
322 |             [str(script_path), "--help"], check=False, capture_output=True, text=True
323 |         )
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_rag_operation_scripts.py:332:13
    |
330 |         with tempfile.TemporaryDirectory() as tmpdir:
331 |             # May fail due to missing dependencies, but should accept args
332 |             result = subprocess.run(
    |             ^^^^^^
333 |                 [str(script_path), tmpdir], check=False, capture_output=True, text=True
334 |             )
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_rag_operation_scripts.py:356:9
    |
354 |         """Test --help flag displays usage."""
355 |         script_path = scripts_dir / "rag" / "query_context.py"
356 |         result = subprocess.run(
    |         ^^^^^^
357 |             [str(script_path), "--help"], check=False, capture_output=True, text=True
358 |         )
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_rag_operation_scripts.py:365:13
    |
363 |         script_path = scripts_dir / "rag" / "query_context.py"
364 |         with tempfile.TemporaryDirectory() as tmpdir:
365 |             result = subprocess.run(
    |             ^^^^^^
366 |                 [str(script_path), "--repo", tmpdir, "test query"],
367 |                 check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_rag_operation_scripts.py:376:9
    |
374 |         """Test behavior with invalid repo path."""
375 |         script_path = scripts_dir / "rag" / "query_context.py"
376 |         result = subprocess.run(
    |         ^^^^^^
377 |             [str(script_path), "--repo", "/nonexistent", "test query"],
378 |             check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_rag_operation_scripts.py:388:13
    |
386 |         script_path = scripts_dir / "rag" / "query_context.py"
387 |         with tempfile.TemporaryDirectory() as tmpdir:
388 |             result = subprocess.run(
    |             ^^^^^^
389 |                 [str(script_path), "--repo", tmpdir],
390 |                 check=False,
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_rag_operation_scripts.py:400:9
    |
398 |         """Test that required args are validated."""
399 |         script_path = scripts_dir / "rag" / "query_context.py"
400 |         result = subprocess.run([str(script_path)], check=False, capture_output=True, text=True)
    |         ^^^^^^
401 |         # Should require query/repo args
402 |         # Exit code may vary
    |
help: Remove assignment to unused variable `result`

F841 Local variable `first_config` is assigned to but never used
   --> tests/test_rag_repo_complete.py:402:5
    |
400 |     # First init
401 |     init_workspace(plan, inspection, tool_config, non_interactive=True)
402 |     first_config = plan.rag_config_path.read_text()
    |     ^^^^^^^^^^^^
403 |
404 |     # Modify config
    |
help: Remove assignment to unused variable `first_config`

F841 Local variable `expected_workspace` is assigned to but never used
  --> tests/test_rag_repo_integration_edge_cases.py:66:9
   |
65 |         # Test workspace detection/creation
66 |         expected_workspace = repo_root / ".llmc" / "rag"
   |         ^^^^^^^^^^^^^^^^^^
67 |
68 |         # The workspace should be auto-detected or created
   |
help: Remove assignment to unused variable `expected_workspace`

F841 Local variable `entry` is assigned to but never used
   --> tests/test_rag_repo_integration_edge_cases.py:125:13
    |
123 |         # (Actual CLI invocation would be tested here)
124 |         for i, repo_path in enumerate(repos):
125 |             entry = {
    |             ^^^^^
126 |                 "repo_id": f"test_repo_{i}",
127 |                 "repo_path": str(repo_path),
    |
help: Remove assignment to unused variable `entry`

B011 Do not `assert False` (`python -O` removes these calls), raise `AssertionError()`
   --> tests/test_rag_repo_integration_edge_cases.py:358:20
    |
356 |             validate_repo_paths(repo_root, malicious_path)
357 |             # Should raise PathTraversalError
358 |             assert False, "Should have raised PathTraversalError"
    |                    ^^^^^
359 |         except PathTraversalError:
360 |             pass  # Expected
    |
help: Replace `assert False`

B011 Do not `assert False` (`python -O` removes these calls), raise `AssertionError()`
   --> tests/test_rag_repo_integration_edge_cases.py:531:20
    |
529 |             with open(registry_file) as f:
530 |                 yaml.safe_load(f)
531 |             assert False, "Should fail to parse corrupted YAML"
    |                    ^^^^^
532 |         except yaml.YAMLError:
533 |             pass  # Expected
    |
help: Replace `assert False`

B011 Do not `assert False` (`python -O` removes these calls), raise `AssertionError()`
   --> tests/test_rag_repo_integration_edge_cases.py:606:24
    |
604 |             try:
605 |                 validate_repo_paths(Path("/home/user/repo"), Path(path))
606 |                 assert False, f"Should have rejected: {path}"
    |                        ^^^^^
607 |             except PathTraversalError:
608 |                 pass  # Expected
    |
help: Replace `assert False`

B011 Do not `assert False` (`python -O` removes these calls), raise `AssertionError()`
   --> tests/test_rag_repo_integration_edge_cases.py:621:24
    |
619 |             try:
620 |                 validate_repo_paths(Path("/home/user/repo"), Path(path))
621 |                 assert False, f"Should have rejected absolute path: {path}"
    |                        ^^^^^
622 |             except PathTraversalError:
623 |                 pass  # Expected
    |
help: Replace `assert False`

F841 Local variable `long_path` is assigned to but never used
   --> tests/test_rag_repo_integration_edge_cases.py:654:9
    |
652 |         # Create very long but valid path
653 |         long_name = "a" * 255  # Many filesystems limit to 255 chars
654 |         long_path = Path(long_name)
    |         ^^^^^^^^^
655 |
656 |         # Should handle or reject appropriately
    |
help: Remove assignment to unused variable `long_path`

B007 Loop control variable `expected` not used within loop body
   --> tests/test_rag_repo_integration_edge_cases.py:703:24
    |
701 |         ]
702 |
703 |         for base, sub, expected in test_cases:
    |                        ^^^^^^^^
704 |             result = safe_subpath(base, sub)
705 |             # Should resolve to expected path
    |
help: Rename unused `expected` to `_expected`

F841 Local variable `result` is assigned to but never used
   --> tests/test_rag_repo_integration_edge_cases.py:704:13
    |
703 |         for base, sub, expected in test_cases:
704 |             result = safe_subpath(base, sub)
    |             ^^^^^^
705 |             # Should resolve to expected path
    |
help: Remove assignment to unused variable `result`

F841 Local variable `interval` is assigned to but never used
   --> tests/test_rag_repo_integration_edge_cases.py:816:9
    |
814 |         # Negative intervals don't make sense
815 |         # Should either reject or convert to 0
816 |         interval = -100
    |         ^^^^^^^^
817 |         # Implementation should handle this
    |
help: Remove assignment to unused variable `interval`

F841 Local variable `decision` is assigned to but never used
   --> tests/test_rag_router.py:782:13
    |
780 |             mock_cwd.return_value = Path("/tmp/repo")
781 |
782 |             decision = route_query("test query", Path("/tmp/custom"))
    |             ^^^^^^^^
783 |
784 |             mock_router_class.assert_called_once_with(Path("/tmp/custom"))
    |
help: Remove assignment to unused variable `decision`

F841 Local variable `decision` is assigned to but never used
   --> tests/test_rag_router.py:815:21
    |
813 |             with patch.object(cwd_instance, "parent", parent):
814 |                 with patch.object(parent, "__truediv__", lambda self, x: Path(f"/tmp/{x}")):
815 |                     decision = route_query("test query")
    |                     ^^^^^^^^
816 |
817 |                     # Should auto-detect repo root
    |
help: Remove assignment to unused variable `decision`

F841 Local variable `result` is assigned to but never used
   --> tests/test_refresh_sync_cron_scripts.py:112:13
    |
110 |         script_path = Path(__file__).parent.parent / "scripts" / "rag_refresh_cron.sh"
111 |         with tempfile.TemporaryDirectory() as tmpdir:
112 |             result = subprocess.run(
    |             ^^^^^^
113 |                 [str(script_path), "--repo", tmpdir], check=False, capture_output=True, text=True
114 |             )
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_refresh_sync_cron_scripts.py:121:13
    |
119 |         script_path = Path(__file__).parent.parent / "scripts" / "rag_refresh_cron.sh"
120 |         with tempfile.TemporaryDirectory() as tmpdir:
121 |             result = subprocess.run(
    |             ^^^^^^
122 |                 [str(script_path), f"--repo={tmpdir}"], check=False, capture_output=True, text=True
123 |             )
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> tests/test_refresh_sync_cron_scripts.py:412:13
    |
410 |         script_path = Path(__file__).parent.parent / "scripts" / "rag_sync.sh"
411 |         with tempfile.TemporaryDirectory() as tmpdir:
412 |             result = subprocess.run(
    |             ^^^^^^
413 |                 [str(script_path), f"--repo={tmpdir}"], check=False, capture_output=True, text=True
414 |             )
    |
help: Remove assignment to unused variable `result`

I001 [*] Import block is un-sorted or un-formatted
  --> tests/test_remote_providers.py:11:1
   |
 9 |   """
10 |
11 | / import sys
12 | | import time
13 | | from pathlib import Path
   | |________________________^
14 |
15 |   # Add repo to path
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> tests/test_remote_providers.py:48:5
   |
46 |     """Test token bucket rate limiter."""
47 |     print("\n2. Testing rate limiter...")
48 |     from tools.rag.enrichment_reliability import RateLimiter, RateLimitConfig
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
49 |
50 |     config = RateLimitConfig(
   |
help: Organize imports

PLW2901 `with` statement variable `home` overwritten by assignment target
  --> tests/test_repo_add_idempotency.py:20:9
   |
18 |     """Test that adding a new repo creates the workspace structure."""
19 |     with tempfile.TemporaryDirectory() as home:
20 |         home = Path(home)
   |         ^^^^
21 |
22 |         # Create a mock repo
   |

F841 Local variable `result` is assigned to but never used
  --> tests/test_repo_add_idempotency.py:47:9
   |
46 |         # Run add command
47 |         result = _cmd_add(args, tool_config, None)
   |         ^^^^^^
48 |
49 |         # Verify workspace was created
   |
help: Remove assignment to unused variable `result`

PLW2901 `with` statement variable `home` overwritten by assignment target
  --> tests/test_repo_add_idempotency.py:74:9
   |
72 |     """Test that adding an already-registered repo is idempotent."""
73 |     with tempfile.TemporaryDirectory() as home:
74 |         home = Path(home)
   |         ^^^^
75 |
76 |         # Create a mock repo with existing workspace
   |

F841 Local variable `result1` is assigned to but never used
   --> tests/test_repo_add_idempotency.py:106:9
    |
105 |         # First add
106 |         result1 = _cmd_add(args, tool_config, None)
    |         ^^^^^^^
107 |
108 |         # Read the configs after first add
    |
help: Remove assignment to unused variable `result1`

F841 Local variable `result2` is assigned to but never used
   --> tests/test_repo_add_idempotency.py:113:9
    |
112 |         # Second add (should be idempotent)
113 |         result2 = _cmd_add(args, tool_config, None)
    |         ^^^^^^^
114 |
115 |         # Read configs after second add
    |
help: Remove assignment to unused variable `result2`

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_repo_add_idempotency.py:134:9
    |
132 |     """Test that add doesn't clobber existing configs."""
133 |     with tempfile.TemporaryDirectory() as home:
134 |         home = Path(home)
    |         ^^^^
135 |
136 |         repo_root = home / "test_repo"
    |

F841 Local variable `result` is assigned to but never used
   --> tests/test_repo_add_idempotency.py:178:9
    |
177 |         # Add repo
178 |         result = _cmd_add(args, tool_config, None)
    |         ^^^^^^
179 |
180 |         # Verify custom configs are preserved
    |
help: Remove assignment to unused variable `result`

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_repo_add_idempotency.py:193:9
    |
191 |     """Test adding the same repo multiple times doesn't duplicate registry."""
192 |     with tempfile.TemporaryDirectory() as home:
193 |         home = Path(home)
    |         ^^^^
194 |
195 |         repo_root = home / "test_repo"
    |

B007 Loop control variable `i` not used within loop body
   --> tests/test_repo_add_idempotency.py:217:13
    |
216 |         # Add repo 3 times
217 |         for i in range(3):
    |             ^
218 |             result = _cmd_add(args, tool_config, None)
219 |             assert result == 0
    |
help: Rename unused `i` to `_i`

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_repo_add_idempotency.py:232:9
    |
230 |     """Test adding same repo via different path representations."""
231 |     with tempfile.TemporaryDirectory() as home:
232 |         home = Path(home)
    |         ^^^^
233 |
234 |         # Create repo with symlink
    |

F841 Local variable `result1` is assigned to but never used
   --> tests/test_repo_add_idempotency.py:259:9
    |
257 |             config=None,
258 |         )
259 |         result1 = _cmd_add(args1, tool_config, None)
    |         ^^^^^^^
260 |
261 |         # Add via symlink
    |
help: Remove assignment to unused variable `result1`

F841 Local variable `result2` is assigned to but never used
   --> tests/test_repo_add_idempotency.py:268:9
    |
266 |             config=None,
267 |         )
268 |         result2 = _cmd_add(args2, tool_config, None)
    |         ^^^^^^^
269 |
270 |         # Should still have only 1 entry (canonicalized to same repo)
    |
help: Remove assignment to unused variable `result2`

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_repo_add_idempotency.py:281:9
    |
279 |     """Test that workspace initialization creates proper structure."""
280 |     with tempfile.TemporaryDirectory() as home:
281 |         home = Path(home)
    |         ^^^^
282 |
283 |         repo_root = home / "test_repo"
    |

F841 Local variable `result` is assigned to but never used
   --> tests/test_repo_add_idempotency.py:306:9
    |
304 |         )
305 |
306 |         result = _cmd_add(args, tool_config, None)
    |         ^^^^^^
307 |
308 |         # Verify workspace structure
    |
help: Remove assignment to unused variable `result`

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_repo_add_idempotency.py:337:9
    |
335 |     """Test that add creates proper registry entry."""
336 |     with tempfile.TemporaryDirectory() as home:
337 |         home = Path(home)
    |         ^^^^
338 |
339 |         repo_root = home / "test_repo"
    |

F841 Local variable `result` is assigned to but never used
   --> tests/test_repo_add_idempotency.py:360:9
    |
358 |         )
359 |
360 |         result = _cmd_add(args, tool_config, None)
    |         ^^^^^^
361 |
362 |         # Verify registry entry
    |
help: Remove assignment to unused variable `result`

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_repo_add_idempotency.py:386:9
    |
384 |     """Test adding repo with custom profile."""
385 |     with tempfile.TemporaryDirectory() as home:
386 |         home = Path(home)
    |         ^^^^
387 |
388 |         repo_root = home / "test_repo"
    |

F841 Local variable `result1` is assigned to but never used
   --> tests/test_repo_add_idempotency.py:409:9
    |
407 |             config=None,
408 |         )
409 |         result1 = _cmd_add(args1, tool_config, None)
    |         ^^^^^^^
410 |
411 |         registry = RegistryAdapter(tool_config)
    |
help: Remove assignment to unused variable `result1`

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_repo_add_idempotency.py:421:9
    |
419 |     """Test add command with JSON output flag."""
420 |     with tempfile.TemporaryDirectory() as home:
421 |         home = Path(home)
    |         ^^^^
422 |
423 |         repo_root = home / "test_repo"
    |

F841 Local variable `result` is assigned to but never used
   --> tests/test_repo_add_idempotency.py:450:13
    |
448 |         output = io.StringIO()
449 |         with redirect_stdout(output):
450 |             result = _cmd_add(args, tool_config, None)
    |             ^^^^^^
451 |
452 |         # Verify JSON output
    |
help: Remove assignment to unused variable `result`

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_repo_add_idempotency.py:470:9
    |
468 |     """Test that add fails gracefully for non-existent repo."""
469 |     with tempfile.TemporaryDirectory() as home:
470 |         home = Path(home)
    |         ^^^^
471 |
472 |         registry_path = home / "registry.yml"
    |

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_repo_add_idempotency.py:505:9
    |
503 |     """Test that add creates all necessary directories."""
504 |     with tempfile.TemporaryDirectory() as home:
505 |         home = Path(home)
    |         ^^^^
506 |
507 |         repo_root = home / "test_repo"
    |

F841 Local variable `result` is assigned to but never used
   --> tests/test_repo_add_idempotency.py:528:9
    |
526 |         )
527 |
528 |         result = _cmd_add(args, tool_config, None)
    |         ^^^^^^
529 |
530 |         workspace_path = repo_root / ".llmc" / "rag"
    |
help: Remove assignment to unused variable `result`

PLW2901 `with` statement variable `home` overwritten by assignment target
   --> tests/test_repo_add_idempotency.py:551:9
    |
549 |     """Test that add is idempotent even if registry is modified externally."""
550 |     with tempfile.TemporaryDirectory() as home:
551 |         home = Path(home)
    |         ^^^^
552 |
553 |         repo_root = home / "test_repo"
    |

B007 Loop control variable `factor` not used within loop body
  --> tests/test_reranker_edge_cases.py:63:13
   |
62 |         # Should have sensible defaults
63 |         for factor, weight in default_weights.items():
   |             ^^^^^^
64 |             assert weight >= 0
   |
help: Rename unused `factor` to `_factor`

F841 Local variable `loaded` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:168:13
    |
167 |         with open(config_path) as f:
168 |             loaded = json.load(f)
    |             ^^^^^^
169 |
170 |         # Should handle small values
    |
help: Remove assignment to unused variable `loaded`

F841 Local variable `loaded` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:184:13
    |
183 |         with open(config_path) as f:
184 |             loaded = json.load(f)
    |             ^^^^^^
185 |
186 |         # Missing factors should use defaults
    |
help: Remove assignment to unused variable `loaded`

F841 Local variable `loaded` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:201:13
    |
200 |         with open(config_path) as f:
201 |             loaded = json.load(f)
    |             ^^^^^^
202 |
203 |         # Should preserve custom factors
    |
help: Remove assignment to unused variable `loaded`

F841 Local variable `non_existent` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:208:9
    |
206 |     def test_weights_config_not_found(self, tmp_path: Path):
207 |         """Test behavior when config file is missing."""
208 |         non_existent = tmp_path / "nonexistent.json"
    |         ^^^^^^^^^^^^
209 |
210 |         # Should handle missing config
    |
help: Remove assignment to unused variable `non_existent`

B011 Do not `assert False` (`python -O` removes these calls), raise `AssertionError()`
   --> tests/test_reranker_edge_cases.py:248:20
    |
246 |             with open(config_path) as f:
247 |                 json.load(f)
248 |             assert False, "Should have raised PermissionError"
    |                    ^^^^^
249 |         except PermissionError:
250 |             # Expected behavior
    |
help: Replace `assert False`

F841 Local variable `config_path` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:274:9
    |
272 |         }
273 |
274 |         config_path = self.create_weights_config(tmp_path, weights)
    |         ^^^^^^^^^^^
275 |
276 |         # May flatten or use nested
    |
help: Remove assignment to unused variable `config_path`

F841 Local variable `long_query` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:326:9
    |
324 |     def test_reranker_query_too_long(self, tmp_path: Path):
325 |         """Test handling of very long queries."""
326 |         long_query = " ".join(["word"] * 10000)
    |         ^^^^^^^^^^
327 |
328 |         # Should truncate or reject
    |
help: Remove assignment to unused variable `long_query`

F841 Local variable `hits` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:357:9
    |
355 |     def test_reranker_inconsistent_data(self, tmp_path: Path):
356 |         """Test reranking with inconsistent hit data."""
357 |         hits = [
    |         ^^^^
358 |             Mock(file="file1.py", text="valid text", score=0.5),
359 |             Mock(file=None, text=None, score=None),  # Invalid
    |
help: Remove assignment to unused variable `hits`

F841 Local variable `hits` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:445:9
    |
443 |         # - Position
444 |
445 |         hits = create_test_hits(tmp_path)
    |         ^^^^
446 |         query = "function_a"
    |
help: Remove assignment to unused variable `hits`

F841 Local variable `query` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:446:9
    |
445 |         hits = create_test_hits(tmp_path)
446 |         query = "function_a"
    |         ^^^^^
447 |
448 |         # Exact match should score highest
    |
help: Remove assignment to unused variable `query`

F841 Local variable `query` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:453:9
    |
451 |     def test_lightweight_token_overlap(self, tmp_path: Path):
452 |         """Test token overlap scoring."""
453 |         query = "def function return"
    |         ^^^^^
454 |
455 |         hits = [
    |
help: Remove assignment to unused variable `query`

F841 Local variable `hits` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:455:9
    |
453 |         query = "def function return"
454 |
455 |         hits = [
    |         ^^^^
456 |             Mock(file="file1.py", text="def function_a(): return 42"),  # All tokens
457 |             Mock(file="file2.py", text="def function_b(): return 1"),  # Partial
    |
help: Remove assignment to unused variable `hits`

F841 Local variable `query` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:466:9
    |
464 |     def test_lightweight_exact_match_boost(self, tmp_path: Path):
465 |         """Test exact match boosting."""
466 |         query = "function_a"
    |         ^^^^^
467 |
468 |         hits = [
    |
help: Remove assignment to unused variable `query`

F841 Local variable `hits` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:468:9
    |
466 |         query = "function_a"
467 |
468 |         hits = [
    |         ^^^^
469 |             Mock(file="file1.py", text="def function_a(): ..."),  # Exact
470 |             Mock(file="file2.py", text="function_a is called"),  # Contains
    |
help: Remove assignment to unused variable `hits`

F841 Local variable `query` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:478:9
    |
476 |     def test_lightweight_prefix_match(self, tmp_path: Path):
477 |         """Test prefix match scoring."""
478 |         query = "func"
    |         ^^^^^
479 |
480 |         hits = [
    |
help: Remove assignment to unused variable `query`

F841 Local variable `hits` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:480:9
    |
478 |         query = "func"
479 |
480 |         hits = [
    |         ^^^^
481 |             Mock(file="file1.py", text="function_a"),  # Starts with
482 |             Mock(file="file2.py", text="my_function"),  # Contains
    |
help: Remove assignment to unused variable `hits`

F841 Local variable `query` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:490:9
    |
488 |     def test_lightweight_case_sensitivity(self, tmp_path: Path):
489 |         """Test case sensitivity in lightweight reranker."""
490 |         query = "Function"
    |         ^^^^^
491 |
492 |         hits = [
    |
help: Remove assignment to unused variable `query`

F841 Local variable `hits` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:492:9
    |
490 |         query = "Function"
491 |
492 |         hits = [
    |         ^^^^
493 |             Mock(file="file1.py", text="Function"),  # Exact case
494 |             Mock(file="file2.py", text="function"),  # Different case
    |
help: Remove assignment to unused variable `hits`

F841 Local variable `query` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:502:9
    |
500 |     def test_lightweight_position_bias(self, tmp_path: Path):
501 |         """Test position-based scoring."""
502 |         query = "test"
    |         ^^^^^
503 |
504 |         hits = [
    |
help: Remove assignment to unused variable `query`

F841 Local variable `hits` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:504:9
    |
502 |         query = "test"
503 |
504 |         hits = [
    |         ^^^^
505 |             Mock(file="file1.py", text="test at start"),  # Early
506 |             Mock(file="file2.py", text="middle test word"),  # Middle
    |
help: Remove assignment to unused variable `hits`

F841 Local variable `query` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:514:9
    |
512 |     def test_lightweight_frequency_bias(self, tmp_path: Path):
513 |         """Test frequency-based scoring."""
514 |         query = "def"
    |         ^^^^^
515 |
516 |         hits = [
    |
help: Remove assignment to unused variable `query`

F841 Local variable `hits` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:516:9
    |
514 |         query = "def"
515 |
516 |         hits = [
    |         ^^^^
517 |             Mock(file="file1.py", text="def def def"),  # Frequent
518 |             Mock(file="file2.py", text="def once"),  # Less frequent
    |
help: Remove assignment to unused variable `hits`

F841 Local variable `query` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:525:9
    |
523 |     def test_lightweight_file_type_bias(self, tmp_path: Path):
524 |         """Test file type-based scoring."""
525 |         query = "class"
    |         ^^^^^
526 |
527 |         hits = [
    |
help: Remove assignment to unused variable `query`

F841 Local variable `hits` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:527:9
    |
525 |         query = "class"
526 |
527 |         hits = [
    |         ^^^^
528 |             Mock(file="file1.py", text="class Test"),  # Match + .py
529 |             Mock(file="file2.md", text="class Test"),  # Match + .md
    |
help: Remove assignment to unused variable `hits`

F841 Local variable `query` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:537:9
    |
535 |     def test_lightweight_path_match(self, tmp_path: Path):
536 |         """Test path-based scoring."""
537 |         query = "test"
    |         ^^^^^
538 |
539 |         hits = [
    |
help: Remove assignment to unused variable `query`

F841 Local variable `hits` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:539:9
    |
537 |         query = "test"
538 |
539 |         hits = [
    |         ^^^^
540 |             Mock(file="test_file.py", text="func"),  # In filename
541 |             Mock(file="other.py", text="test"),  # In content
    |
help: Remove assignment to unused variable `hits`

F841 Local variable `hits` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:555:9
    |
553 |         import time
554 |
555 |         hits = create_test_hits(tmp_path)
    |         ^^^^
556 |         query = "function"
    |
help: Remove assignment to unused variable `hits`

F841 Local variable `query` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:556:9
    |
555 |         hits = create_test_hits(tmp_path)
556 |         query = "function"
    |         ^^^^^
557 |
558 |         start = time.time()
    |
help: Remove assignment to unused variable `query`

F841 Local variable `hits` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:567:9
    |
565 |     def test_lightweight_deterministic(self, tmp_path: Path):
566 |         """Test that lightweight reranker is deterministic."""
567 |         hits = create_test_hits(tmp_path)
    |         ^^^^
568 |         query = "test"
    |
help: Remove assignment to unused variable `hits`

F841 Local variable `query` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:568:9
    |
566 |         """Test that lightweight reranker is deterministic."""
567 |         hits = create_test_hits(tmp_path)
568 |         query = "test"
    |         ^^^^^
569 |
570 |         # Run twice, should get same results
    |
help: Remove assignment to unused variable `query`

F841 Local variable `original_count` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:605:9
    |
603 |         """Test that reranking preserves all hits."""
604 |         hits = create_test_hits(tmp_path)
605 |         original_count = len(hits)
    |         ^^^^^^^^^^^^^^
606 |
607 |         # Rerank
    |
help: Remove assignment to unused variable `original_count`

F841 Local variable `hits` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:612:9
    |
610 |     def test_rerank_changes_order(self, tmp_path: Path):
611 |         """Test that reranking can change order."""
612 |         hits = create_test_hits(tmp_path)
    |         ^^^^
613 |
614 |         # Original order: file1, file2, file3
    |
help: Remove assignment to unused variable `hits`

F841 Local variable `weights` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:619:9
    |
617 |     def test_rerank_zero_weights(self, tmp_path: Path):
618 |         """Test reranking with all zero weights."""
619 |         weights = {factor: 0.0 for factor in ["exact_match", "token_overlap"]}
    |         ^^^^^^^
620 |
621 |         # Should return in original order
    |
help: Remove assignment to unused variable `weights`

F841 Local variable `weights` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:626:9
    |
624 |     def test_rerank_equal_weights(self, tmp_path: Path):
625 |         """Test reranking with all equal weights."""
626 |         weights = {factor: 1.0 for factor in ["exact_match", "token_overlap"]}
    |         ^^^^^^^
627 |
628 |         # Tied scores, may use original order
    |
help: Remove assignment to unused variable `weights`

F841 Local variable `hits` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:650:9
    |
648 |     def test_rerank_top_k_selection(self, tmp_path: Path):
649 |         """Test selection of top K results."""
650 |         hits = create_test_hits(tmp_path)
    |         ^^^^
651 |         top_k = 2
    |
help: Remove assignment to unused variable `hits`

F841 Local variable `top_k` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:651:9
    |
649 |         """Test selection of top K results."""
650 |         hits = create_test_hits(tmp_path)
651 |         top_k = 2
    |         ^^^^^
652 |
653 |         # Should return top 2 by score
    |
help: Remove assignment to unused variable `top_k`

F841 Local variable `hits` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:658:9
    |
656 |     def test_rerank_with_scores(self, tmp_path: Path):
657 |         """Test reranking preserves and uses original scores."""
658 |         hits = create_test_hits(tmp_path)
    |         ^^^^
659 |
660 |         # Each hit has original score
    |
help: Remove assignment to unused variable `hits`

F841 Local variable `hits` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:670:9
    |
668 |     def test_rerank_reduces_count(self, tmp_path: Path):
669 |         """Test that reranking doesn't duplicate hits."""
670 |         hits = create_test_hits(tmp_path)
    |         ^^^^
671 |
672 |         # Each hit appears once
    |
help: Remove assignment to unused variable `hits`

F841 Local variable `query` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:677:9
    |
675 |     def test_rerank_empty_query(self, tmp_path: Path):
676 |         """Test reranking with empty query."""
677 |         query = ""
    |         ^^^^^
678 |
679 |         # Should handle gracefully
    |
help: Remove assignment to unused variable `query`

F841 Local variable `queries` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:684:9
    |
682 |     def test_rerank_special_characters(self, tmp_path: Path):
683 |         """Test reranking with special characters in query."""
684 |         queries = [
    |         ^^^^^^^
685 |             "def test():",
686 |             "class MyClass:",
    |
help: Remove assignment to unused variable `queries`

F841 Local variable `query` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:695:9
    |
693 |     def test_rerank_unicode(self, tmp_path: Path):
694 |         """Test reranking with unicode in query."""
695 |         query = "Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ"
    |         ^^^^^
696 |
697 |         # Should handle unicode
    |
help: Remove assignment to unused variable `query`

F841 Local variable `query` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:702:9
    |
700 |     def test_rerank_long_query(self, tmp_path: Path):
701 |         """Test reranking with very long query."""
702 |         query = " ".join(["word"] * 1000)
    |         ^^^^^
703 |
704 |         # Should handle or truncate
    |
help: Remove assignment to unused variable `query`

F841 Local variable `hits` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:708:9
    |
706 |     def test_rerank_many_hits(self, tmp_path: Path):
707 |         """Test reranking with many hits."""
708 |         hits = [Mock(file=f"file{i}.py", text="content") for i in range(1000)]
    |         ^^^^
709 |
710 |         # Should handle large hit sets
    |
help: Remove assignment to unused variable `hits`

F841 Local variable `hits` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:715:9
    |
713 |     def test_rerank_nan_scores(self, tmp_path: Path):
714 |         """Test handling of NaN scores."""
715 |         hits = [
    |         ^^^^
716 |             Mock(file="file1.py", text="test", score=float("nan")),
717 |             Mock(file="file2.py", text="test", score=0.5),
    |
help: Remove assignment to unused variable `hits`

F841 Local variable `hits` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:725:9
    |
723 |     def test_rerank_inf_scores(self, tmp_path: Path):
724 |         """Test handling of infinite scores."""
725 |         hits = [
    |         ^^^^
726 |             Mock(file="file1.py", text="test", score=float("inf")),
727 |             Mock(file="file2.py", text="test", score=0.5),
    |
help: Remove assignment to unused variable `hits`

F841 Local variable `hits` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:735:9
    |
733 |     def test_rerank_negative_scores(self, tmp_path: Path):
734 |         """Test handling of negative scores."""
735 |         hits = [
    |         ^^^^
736 |             Mock(file="file1.py", text="test", score=-0.5),
737 |             Mock(file="file2.py", text="test", score=0.5),
    |
help: Remove assignment to unused variable `hits`

F841 Local variable `hits` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:754:9
    |
752 |     def test_rerank_with_limit(self, tmp_path: Path):
753 |         """Test reranking respects limit parameter."""
754 |         hits = create_test_hits(tmp_path)
    |         ^^^^
755 |         limit = 2
    |
help: Remove assignment to unused variable `hits`

F841 Local variable `limit` is assigned to but never used
   --> tests/test_reranker_edge_cases.py:755:9
    |
753 |         """Test reranking respects limit parameter."""
754 |         hits = create_test_hits(tmp_path)
755 |         limit = 2
    |         ^^^^^
756 |
757 |         # Rerank all, then limit to 2
    |
help: Remove assignment to unused variable `limit`

B007 Loop control variable `i` not used within loop body
   --> tests/test_router_critical.py:181:13
    |
179 |         failures = ["parse", "truncation", "timeout"]
180 |
181 |         for i, failure in enumerate(failures):
    |             ^
182 |             # Assume we're still within max retries
183 |             next_tier = choose_next_tier_on_failure(
    |
help: Rename unused `i` to `_i`

F841 Local variable `tier1` is assigned to but never used
   --> tests/test_router_critical.py:212:9
    |
211 |         # Initial selection should not be affected by previous failures
212 |         tier1 = choose_start_tier(metrics, settings, override=None)
    |         ^^^^^
213 |
214 |         # Simulate failure and retry
    |
help: Remove assignment to unused variable `tier1`

F841 Local variable `tier2` is assigned to but never used
   --> tests/test_router_critical.py:216:9
    |
214 |         # Simulate failure and retry
215 |         failure_metrics = {"tokens_in": 2000}
216 |         tier2 = choose_start_tier(failure_metrics, settings, override=None)
    |         ^^^^^
217 |
218 |         # After success, metrics should be fresh for next decision
    |
help: Remove assignment to unused variable `tier2`

F841 Local variable `tier1` is assigned to but never used
   --> tests/test_router_critical.py:227:9
    |
225 |         # First request - high token count
226 |         metrics1 = {"tokens_in": 50000}
227 |         tier1 = choose_start_tier(metrics1, settings)
    |         ^^^^^
228 |
229 |         # Second request - low token count (simulating success/recovery)
    |
help: Remove assignment to unused variable `tier1`

F841 Local variable `tier2` is assigned to but never used
   --> tests/test_router_critical.py:231:9
    |
229 |         # Second request - low token count (simulating success/recovery)
230 |         metrics2 = {"tokens_in": 1000}
231 |         tier2 = choose_start_tier(metrics2, settings)
    |         ^^^^^
232 |
233 |         # Should select tier based on current metrics, not cached backoff
    |
help: Remove assignment to unused variable `tier2`

F841 Local variable `results` is assigned to but never used
   --> tests/test_routing_integration.py:403:9
    |
401 |         from tools.rag.search import search_spans
402 |
403 |         results = search_spans(query, limit=1, repo_root=repo_root)
    |         ^^^^^^^
404 |
405 |         # We don't assert len(results) because the vector search itself might fail in this
    |
help: Remove assignment to unused variable `results`

PLW0127 Self-assignment of variable `UTC`
  --> tests/test_scheduler_eligibility_comprehensive.py:14:1
   |
12 | from tools.rag_daemon.scheduler import Scheduler
13 |
14 | UTC = UTC
   | ^^^
   |

I001 [*] Import block is un-sorted or un-formatted
  --> tests/test_schema_typescript.py:7:1
   |
 5 |   """
 6 |
 7 | / from pathlib import Path
 8 | | import tempfile
 9 | | import pytest
10 | |
11 | | from tools.rag.schema import (
12 | |     extract_schema_from_file,
13 | |     TypeScriptSchemaExtractor,
14 | |     Entity,
15 | |     Relation,
16 | | )
   | |_^
   |
help: Organize imports

F401 [*] `tools.rag.schema.TypeScriptSchemaExtractor` imported but unused
  --> tests/test_schema_typescript.py:13:5
   |
11 | from tools.rag.schema import (
12 |     extract_schema_from_file,
13 |     TypeScriptSchemaExtractor,
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^
14 |     Entity,
15 |     Relation,
   |
help: Remove unused import

F401 [*] `tools.rag.schema.Entity` imported but unused
  --> tests/test_schema_typescript.py:14:5
   |
12 |     extract_schema_from_file,
13 |     TypeScriptSchemaExtractor,
14 |     Entity,
   |     ^^^^^^
15 |     Relation,
16 | )
   |
help: Remove unused import

F401 [*] `tools.rag.schema.Relation` imported but unused
  --> tests/test_schema_typescript.py:15:5
   |
13 |     TypeScriptSchemaExtractor,
14 |     Entity,
15 |     Relation,
   |     ^^^^^^^^
16 | )
   |
help: Remove unused import

I001 [*] Import block is un-sorted or un-formatted
  --> tests/test_schema_typescript_integration.py:11:1
   |
 9 |   """
10 |
11 | / from pathlib import Path
12 | | import tempfile
13 | | import json
14 | | import shutil
15 | |
16 | | from tools.rag.schema import build_schema_graph
   | |_______________________________________________^
   |
help: Organize imports

F401 [*] `shutil` imported but unused
  --> tests/test_schema_typescript_integration.py:14:8
   |
12 | import tempfile
13 | import json
14 | import shutil
   |        ^^^^^^
15 |
16 | from tools.rag.schema import build_schema_graph
   |
help: Remove unused import: `shutil`

F841 Local variable `relation_triples` is assigned to but never used
   --> tests/test_schema_typescript_integration.py:121:9
    |
120 |         # ===== Verify relations =====
121 |         relation_triples = [(r.src, r.edge, r.dst) for r in graph.relations]
    |         ^^^^^^^^^^^^^^^^
122 |         
123 |         # Check for call relations
    |
help: Remove assignment to unused variable `relation_triples`

B905 `zip()` without an explicit `strict=` parameter
   --> tests/test_te_enrichment_manual.py:110:19
    |
109 |     # Compare with tolerance
110 |     for v1, v2 in zip(original_vec, decoded_vec):
    |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
111 |         assert abs(v1 - v2) < 1e-6
    |
help: Add explicit value for parameter `strict=`

B905 `zip()` without an explicit `strict=` parameter
   --> tests/test_te_stats_output.py:254:13
    |
252 |         assert len(actual_output_lines) == len(expected_output_lines)
253 |         for i, (actual_line, expected_line) in enumerate(
254 |             zip(actual_output_lines, expected_output_lines)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
255 |         ):
256 |             assert actual_line == expected_line, (
    |
help: Add explicit value for parameter `strict=`

PLW0127 Self-assignment of variable `UTC`
  --> tests/test_worker_pool_comprehensive.py:16:1
   |
14 | from tools.rag_daemon.workers import WorkerPool, make_job_id
15 |
16 | UTC = UTC
   | ^^^
   |

B007 Loop control variable `i` not used within loop body
   --> tests/test_worker_pool_comprehensive.py:300:9
    |
299 |     # Run enough failures to exceed max backoff
300 |     for i in range(10):
    |         ^
301 |         job = Job(job_id=make_job_id(), repo=repo, force=True)
302 |         workers.submit_jobs([job])
    |
help: Rename unused `i` to `_i`

F841 Local variable `state` is assigned to but never used
   --> tests/test_worker_pool_comprehensive.py:484:5
    |
483 |     # Check that output is captured in state
484 |     state = state_store.get(repo.repo_id)
    |     ^^^^^
485 |     # Note: The current implementation doesn't store stdout/stderr in state,
486 |     # but they're captured in the JobResult. This is a design limitation.
    |
help: Remove assignment to unused variable `state`

F841 Local variable `workers2` is assigned to but never used
   --> tests/test_worker_pool_comprehensive.py:533:5
    |
532 |     # Create new worker (simulates daemon restart)
533 |     workers2 = WorkerPool(cfg, state_store)
    |     ^^^^^^^^
534 |
535 |     # Verify state persisted
    |
help: Remove assignment to unused variable `workers2`

F401 `typing.Optional` imported but unused
 --> tools/rag/__init__.py:7:20
  |
5 | from pathlib import Path
6 | import sys
7 | from typing import Optional
  |                    ^^^^^^^^
8 |
9 | # Add repo root to sys.path to enable llmc imports even when not installed
  |
help: Remove unused import: `typing.Optional`

PLW2901 `for` loop variable `line` overwritten by assignment target
   --> tools/rag/__init__.py:108:21
    |
106 |                 # Look for class inheritance patterns
107 |                 for line in content.split("\n"):
108 |                     line = line.strip()
    |                     ^^^^
109 |                     if line.startswith("class ") and "(" in line:
110 |                         # Extract base class
    |

B905 `zip()` without an explicit `strict=` parameter
  --> tools/rag/benchmark.py:17:19
   |
16 | def _cosine(a: Sequence[float], b: Sequence[float]) -> float:
17 |     paired = list(zip(a, b))
   |                   ^^^^^^^^^
18 |     if not paired:
19 |         return 0.0
   |
help: Add explicit value for parameter `strict=`

B905 `zip()` without an explicit `strict=` parameter
  --> tools/rag/benchmark.py:29:34
   |
28 | def _dot(a: Sequence[float], b: Sequence[float]) -> float:
29 |     return sum(x * y for x, y in zip(a, b))
   |                                  ^^^^^^^^^
   |
help: Add explicit value for parameter `strict=`

B905 `zip()` without an explicit `strict=` parameter
   --> tools/rag/benchmark.py:122:32
    |
121 |         best_positive = max(
122 |             (s for s, label in zip(scores, candidate_labels) if label == 1), default=0.0
    |                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
123 |         )
124 |         best_negative = max(
    |
help: Add explicit value for parameter `strict=`

B905 `zip()` without an explicit `strict=` parameter
   --> tools/rag/benchmark.py:125:32
    |
123 |         )
124 |         best_negative = max(
125 |             (s for s, label in zip(scores, candidate_labels) if label == 0), default=0.0
    |                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
126 |         )
127 |         margins.append(best_positive - best_negative)
    |
help: Add explicit value for parameter `strict=`

B905 `zip()` without an explicit `strict=` parameter
   --> tools/rag/benchmark.py:128:50
    |
126 |         )
127 |         margins.append(best_positive - best_negative)
128 |         positive_scores.extend(s for s, label in zip(scores, candidate_labels) if label == 1)
    |                                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
129 |         negative_scores.extend(s for s, label in zip(scores, candidate_labels) if label == 0)
    |
help: Add explicit value for parameter `strict=`

B905 `zip()` without an explicit `strict=` parameter
   --> tools/rag/benchmark.py:129:50
    |
127 |         margins.append(best_positive - best_negative)
128 |         positive_scores.extend(s for s, label in zip(scores, candidate_labels) if label == 1)
129 |         negative_scores.extend(s for s, label in zip(scores, candidate_labels) if label == 0)
    |                                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
130 |
131 |     top1_accuracy = sum(hit_flags) / len(hit_flags) if hit_flags else 0.0
    |
help: Add explicit value for parameter `strict=`

PLW2901 `for` loop variable `line` overwritten by assignment target
  --> tools/rag/cli.py:85:13
   |
83 |     if use_stdin:
84 |         for line in sys.stdin:
85 |             line = line.strip()
   |             ^^^^
86 |             if line:
87 |                 collected.append(Path(line))
   |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> tools/rag/cli.py:222:9
    |
220 |         # Surface enrichment gating failures (e.g. zero rows or zero attached entities)
221 |         click.echo(str(err), err=True)
222 |         raise SystemExit(1)
    |         ^^^^^^^^^^^^^^^^^^^
223 |     except FileNotFoundError as err:
224 |         # Missing index DB or other filesystem issues
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> tools/rag/cli.py:226:9
    |
224 |         # Missing index DB or other filesystem issues
225 |         click.echo(str(err), err=True)
226 |         raise SystemExit(1)
    |         ^^^^^^^^^^^^^^^^^^^
227 |
228 |     graph.save(output_path)
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> tools/rag/cli.py:313:13
    |
311 |                 err=True,
312 |             )
313 |             raise SystemExit(1)
    |             ^^^^^^^^^^^^^^^^^^^
314 |     db_file = _db_path(repo_root, for_write=False)
315 |     if not db_file.exists():
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> tools/rag/cli.py:433:9
    |
431 |     except FileNotFoundError as err:
432 |         click.echo(str(err))
433 |         raise SystemExit(1)
    |         ^^^^^^^^^^^^^^^^^^^
434 |     if as_json:
435 |         payload = [
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> tools/rag/cli.py:641:9
    |
639 |     except Exception as e:
640 |         click.echo(f"Error inspecting entity: {e}", err=True)
641 |         raise SystemExit(1)
    |         ^^^^^^^^^^^^^^^^^^^
642 |
643 |     if as_json:
    |

F401 [*] `functools.lru_cache` imported but unused
  --> tools/rag/config.py:9:23
   |
 8 | import configparser
 9 | from functools import lru_cache
   |                       ^^^^^^^^^
10 | import logging
11 | import os
   |
help: Remove unused import: `functools.lru_cache`

PLW2901 `for` loop variable `raw` overwritten by assignment target
   --> tools/rag/config_enrichment.py:214:17
    |
212 |                 if not isinstance(raw, Mapping):
213 |                     continue
214 |                 raw = dict(raw)
    |                 ^^^
215 |                 raw.setdefault("chain", chain_name)
216 |                 spec = _parse_backend_spec(raw, default_chain=default_chain)
    |

UP028 Replace `yield` over `for` loop with `yield from`
   --> tools/rag/database.py:510:9
    |
508 |               """
509 |           )
510 | /         for row in cursor:
511 | |             yield row
    | |_____________________^
512 |
513 |       # ------------------------------------------------------------------
    |
help: Replace with `yield from`

I001 [*] Import block is un-sorted or un-formatted
  --> tools/rag/enrichment_adapters/__init__.py:8:1
   |
 6 |   """
 7 |
 8 | / from tools.rag.enrichment_adapters.ollama import OllamaBackend
 9 | | from tools.rag.enrichment_adapters.base import RemoteBackend
10 | | from tools.rag.enrichment_adapters.gemini import GeminiBackend
11 | | from tools.rag.enrichment_adapters.openai_compat import OpenAICompatBackend
12 | | from tools.rag.enrichment_adapters.anthropic import AnthropicBackend
   | |____________________________________________________________________^
13 |
14 |   __all__ = [
   |
help: Organize imports

F401 [*] `tools.rag.enrichment_config.EnrichmentProviderConfig` imported but unused
  --> tools/rag/enrichment_adapters/anthropic.py:12:41
   |
11 | from tools.rag.enrichment_adapters.base import RemoteBackend
12 | from tools.rag.enrichment_config import EnrichmentProviderConfig
   |                                         ^^^^^^^^^^^^^^^^^^^^^^^^
13 |
14 | logger = logging.getLogger(__name__)
   |
help: Remove unused import: `tools.rag.enrichment_config.EnrichmentProviderConfig`

I001 [*] Import block is un-sorted or un-formatted
  --> tools/rag/enrichment_adapters/base.py:12:1
   |
10 |   """
11 |
12 | / from __future__ import annotations
13 | |
14 | | import json
15 | | import logging
16 | | import re
17 | | from abc import ABC, abstractmethod
18 | | from dataclasses import dataclass
19 | | from typing import Any
20 | |
21 | | from tools.rag.enrichment_backends import BackendError
22 | | from tools.rag.enrichment_config import (
23 | |     EnrichmentProviderConfig,
24 | |     get_provider_metadata,
25 | | )
26 | | from tools.rag.enrichment_reliability import (
27 | |     CircuitBreaker,
28 | |     CircuitBreakerConfig,
29 | |     CircuitBreakerError,
30 | |     CostTracker,
31 | |     RateLimiter,
32 | |     RetryConfig,
33 | |     RetryMiddleware,
34 | | )
   | |_^
35 |
36 |   try:
   |
help: Organize imports

F401 [*] `dataclasses.dataclass` imported but unused
  --> tools/rag/enrichment_adapters/base.py:18:25
   |
16 | import re
17 | from abc import ABC, abstractmethod
18 | from dataclasses import dataclass
   |                         ^^^^^^^^^
19 | from typing import Any
   |
help: Remove unused import: `dataclasses.dataclass`

F401 [*] `tools.rag.enrichment_config.get_provider_metadata` imported but unused
  --> tools/rag/enrichment_adapters/base.py:24:5
   |
22 | from tools.rag.enrichment_config import (
23 |     EnrichmentProviderConfig,
24 |     get_provider_metadata,
   |     ^^^^^^^^^^^^^^^^^^^^^
25 | )
26 | from tools.rag.enrichment_reliability import (
   |
help: Remove unused import: `tools.rag.enrichment_config.get_provider_metadata`

F401 [*] `tools.rag.enrichment_reliability.CircuitBreakerConfig` imported but unused
  --> tools/rag/enrichment_adapters/base.py:28:5
   |
26 | from tools.rag.enrichment_reliability import (
27 |     CircuitBreaker,
28 |     CircuitBreakerConfig,
   |     ^^^^^^^^^^^^^^^^^^^^
29 |     CircuitBreakerError,
30 |     CostTracker,
   |
help: Remove unused import

F401 [*] `tools.rag.enrichment_reliability.CircuitBreakerError` imported but unused
  --> tools/rag/enrichment_adapters/base.py:29:5
   |
27 |     CircuitBreaker,
28 |     CircuitBreakerConfig,
29 |     CircuitBreakerError,
   |     ^^^^^^^^^^^^^^^^^^^
30 |     CostTracker,
31 |     RateLimiter,
   |
help: Remove unused import

F401 [*] `tools.rag.enrichment_config.EnrichmentProviderConfig` imported but unused
  --> tools/rag/enrichment_adapters/gemini.py:12:41
   |
11 | from tools.rag.enrichment_adapters.base import RemoteBackend
12 | from tools.rag.enrichment_config import EnrichmentProviderConfig
   |                                         ^^^^^^^^^^^^^^^^^^^^^^^^
13 |
14 | logger = logging.getLogger(__name__)
   |
help: Remove unused import: `tools.rag.enrichment_config.EnrichmentProviderConfig`

F401 [*] `tools.rag.enrichment_config.EnrichmentProviderConfig` imported but unused
  --> tools/rag/enrichment_adapters/openai_compat.py:15:41
   |
14 | from tools.rag.enrichment_adapters.base import RemoteBackend
15 | from tools.rag.enrichment_config import EnrichmentProviderConfig
   |                                         ^^^^^^^^^^^^^^^^^^^^^^^^
16 |
17 | logger = logging.getLogger(__name__)
   |
help: Remove unused import: `tools.rag.enrichment_config.EnrichmentProviderConfig`

I001 [*] Import block is un-sorted or un-formatted
  --> tools/rag/enrichment_config.py:7:1
   |
 5 |   """
 6 |
 7 | / from __future__ import annotations
 8 | |
 9 | | import os
10 | | from dataclasses import dataclass
11 | | from typing import Any
12 | |
13 | | from tools.rag.enrichment_reliability import PricingInfo, RateLimitConfig
   | |_________________________________________________________________________^
   |
help: Organize imports

F401 [*] `tools.rag.enrichment_config.EnrichmentProviderConfig` imported but unused
  --> tools/rag/enrichment_factory.py:26:5
   |
24 | from tools.rag.enrichment_backends import BackendAdapter
25 | from tools.rag.enrichment_config import (
26 |     EnrichmentProviderConfig,
   |     ^^^^^^^^^^^^^^^^^^^^^^^^
27 |     get_provider_metadata,
28 |     load_provider_config,
   |
help: Remove unused import: `tools.rag.enrichment_config.EnrichmentProviderConfig`

F401 [*] `tools.rag.enrichment_reliability.PricingInfo` imported but unused
  --> tools/rag/enrichment_factory.py:35:5
   |
33 |     CostTracker,
34 |     CostTrackerConfig,
35 |     PricingInfo,
   |     ^^^^^^^^^^^
36 |     RateLimiter,
37 | )
   |
help: Remove unused import: `tools.rag.enrichment_reliability.PricingInfo`

E731 Do not assign a `lambda` expression, use a `def`
   --> tools/rag/enrichment_pipeline.py:312:17
    |
310 |                         low_items.append((item, decision))
311 |                 
312 |                 key = lambda pair: pair[1].final_priority
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
313 |                 high_items.sort(key=key, reverse=True)
314 |                 mid_items.sort(key=key, reverse=True)
    |
help: Rewrite `key` as a `def`

I001 [*] Import block is un-sorted or un-formatted
  --> tools/rag/enrichment_reliability.py:10:1
   |
 8 |   """
 9 |
10 | / from __future__ import annotations
11 | |
12 | | import asyncio
13 | | import logging
14 | | import random
15 | | import time
16 | | from collections import deque
17 | | from dataclasses import dataclass, field
18 | | from datetime import date
19 | | from typing import Any, Callable
   | |________________________________^
20 |
21 |   logger = logging.getLogger(__name__)
   |
help: Organize imports

F401 [*] `asyncio` imported but unused
  --> tools/rag/enrichment_reliability.py:12:8
   |
10 | from __future__ import annotations
11 |
12 | import asyncio
   |        ^^^^^^^
13 | import logging
14 | import random
   |
help: Remove unused import: `asyncio`

UP035 [*] Import from `collections.abc` instead: `Callable`
  --> tools/rag/enrichment_reliability.py:19:1
   |
17 | from dataclasses import dataclass, field
18 | from datetime import date
19 | from typing import Any, Callable
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
20 |
21 | logger = logging.getLogger(__name__)
   |
help: Import from `collections.abc`

PLW2901 `for` loop variable `line` overwritten by assignment target
  --> tools/rag/eval/routing_eval.py:43:13
   |
41 |     with open(dataset_path) as f:
42 |         for line in f:
43 |             line = line.strip()
   |             ^^^^
44 |             if not line:
45 |                 continue
   |

PLW2901 `for` loop variable `line` overwritten by assignment target
  --> tools/rag/eval/search_eval.py:29:13
   |
27 |     with path.open("r", encoding="utf-8") as handle:
28 |         for line in handle:
29 |             line = line.strip()
   |             ^^^^
30 |             if not line:
31 |                 continue
   |

B905 `zip()` without an explicit `strict=` parameter
   --> tools/rag/graph_enrich.py:170:23
    |
168 |     keys = ["summary", "inputs", "outputs", "pitfalls", "evidence"]
169 |     out: dict[str, Any] = {}
170 |     for key, value in zip(keys, row):
    |                       ^^^^^^^^^^^^^^
171 |         if value is not None:
172 |             out[key] = value
    |
help: Add explicit value for parameter `strict=`

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
  --> tools/rag/graph_index.py:59:9
   |
57 |         data: dict[str, Any] = raw
58 |     except Exception as e:
59 |         raise GraphNotFound(f"Bad JSON in {path}: {e}")
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
60 |
61 |     if not isinstance(data, dict):
   |

E722 Do not use bare `except`
   --> tools/rag/inspector.py:220:21
    |
218 |                     try:
219 |                         data[key] = json.loads(row[key])
220 |                     except:
    |                     ^^^^^^
221 |                         data[key] = row[key]
    |

E722 Do not use bare `except`
   --> tools/rag/inspector.py:227:17
    |
225 |                     ev = json.loads(row["evidence"])
226 |                     data["evidence_count"] = len(ev)
227 |                 except:
    |                 ^^^^^^
228 |                     pass
229 |     except Exception:
    |

E722 Do not use bare `except`
   --> tools/rag/inspector.py:256:9
    |
254 |             graph = SchemaGraph.load(graph_path)
255 |             graph_status = "loaded"
256 |         except:
    |         ^^^^^^
257 |             pass
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
  --> tools/rag/lang.py:49:9
   |
47 |         return get_language(name)
48 |     except Exception as exc:  # pragma: no cover - tree-sitter loader errors
49 |         raise RuntimeError(f"Tree-sitter language '{name}' not available: {exc}")
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |

F841 Local variable `ok` is assigned to but never used
   --> tools/rag/quality.py:135:5
    |
133 |     empty = result["empty_count"]
134 |     short = result["short_count"]
135 |     ok = result["ok_count"]
    |     ^^
136 |
137 |     if result["status"] == "PASS":
    |
help: Remove assignment to unused variable `ok`

F401 `typing.Optional` imported but unused
  --> tools/rag/quality_check/__init__.py:18:29
   |
16 | from dataclasses import dataclass
17 | import re
18 | from typing import Literal, Optional
   |                             ^^^^^^^^
19 |
20 | # Rule version for telemetry and regression tracking
   |
help: Remove unused import: `typing.Optional`

PLW2901 `for` loop variable `line` overwritten by assignment target
  --> tools/rag/runner.py:74:17
   |
72 |         try:
73 |             for line in ragignore.read_text(encoding="utf-8", errors="ignore").splitlines():
74 |                 line = line.strip()
   |                 ^^^^
75 |                 if not line or line.startswith("#"):
76 |                     continue
   |

B905 `zip()` without an explicit `strict=` parameter
  --> tools/rag/search.py:70:34
   |
69 | def _dot(a: Sequence[float], b: Sequence[float]) -> float:
70 |     return sum(x * y for x, y in zip(a, b))
   |                                  ^^^^^^^^^
   |
help: Add explicit value for parameter `strict=`

E722 Do not use bare `except`
   --> tools/rag/search.py:291:25
    |
289 |                                 e_start = int(suffix)
290 |                                 e_end = e_start
291 |                         except:
    |                         ^^^^^^
292 |                             continue
    |

I001 [*] Import block is un-sorted or un-formatted
   --> tools/rag/service.py:526:13
    |
524 |           # Step 2: Enrich pending spans using EnrichmentPipeline
525 |           try:
526 | /             from tools.rag.enrichment_pipeline import EnrichmentPipeline, build_enrichment_prompt
527 | |             from tools.rag.enrichment_adapters.ollama import OllamaBackend
528 | |             from tools.rag.enrichment_router import build_router_from_toml
529 | |             from tools.rag.database import Database
    | |___________________________________________________^
530 |               
531 |               # Load configuration from target repo (preferred) or service defaults
    |
help: Organize imports

F841 Local variable `status` is assigned to but never used
   --> tools/rag/service.py:643:13
    |
642 |             print("  ðŸ“Š Rebuilding RAG Graph...")
643 |             status = build_graph_for_repo(repo)
    |             ^^^^^^
644 |             print("  âœ… Graph rebuilt successfully")
645 |         except Exception as e:
    |
help: Remove assignment to unused variable `status`

B007 Loop control variable `last_attempted` not used within loop body
    --> tools/rag/service.py:1050:40
     |
1048 |             repo_name = Path(repo_path).name
1049 |             print(f"\nðŸ“ {repo_name} ({len(repo_failures)} failures)")
1050 |             for span_hash, fail_count, last_attempted, reason in repo_failures[:5]:  # Show first 5
     |                                        ^^^^^^^^^^^^^^
1051 |                 # Extract filename from span_hash if it's a repo-level failure
1052 |                 if span_hash.startswith("repo:"):
     |
help: Rename unused `last_attempted` to `_last_attempted`

F841 Local variable `stop_p` is assigned to but never used
    --> tools/rag/service.py:1350:5
     |
1348 |     )
1349 |
1350 |     stop_p = subparsers.add_parser("stop", help="Stop the service")
     |     ^^^^^^
1351 |     restart_p = subparsers.add_parser("restart", help="Restart the service")
1352 |     status_p = subparsers.add_parser("status", help="Show service status")
     |
help: Remove assignment to unused variable `stop_p`

F841 Local variable `restart_p` is assigned to but never used
    --> tools/rag/service.py:1351:5
     |
1350 |     stop_p = subparsers.add_parser("stop", help="Stop the service")
1351 |     restart_p = subparsers.add_parser("restart", help="Restart the service")
     |     ^^^^^^^^^
1352 |     status_p = subparsers.add_parser("status", help="Show service status")
     |
help: Remove assignment to unused variable `restart_p`

F841 Local variable `status_p` is assigned to but never used
    --> tools/rag/service.py:1352:5
     |
1350 |     stop_p = subparsers.add_parser("stop", help="Stop the service")
1351 |     restart_p = subparsers.add_parser("restart", help="Restart the service")
1352 |     status_p = subparsers.add_parser("status", help="Show service status")
     |     ^^^^^^^^
1353 |
1354 |     logs_p = subparsers.add_parser("logs", help="View service logs")
     |
help: Remove assignment to unused variable `status_p`

F841 Local variable `list_p` is assigned to but never used
    --> tools/rag/service.py:1368:5
     |
1366 |     remove_p.add_argument("repo_path", help="Path to repository")
1367 |
1368 |     list_p = repo_sub.add_parser("list", help="List registered repositories")
     |     ^^^^^^
1369 |
1370 |     # Backwards compatibility - keep old commands
     |
help: Remove assignment to unused variable `list_p`

F841 Local variable `health_p` is assigned to but never used
    --> tools/rag/service.py:1380:5
     |
1379 |     # Health & diagnostics
1380 |     health_p = subparsers.add_parser("health", help="Check Ollama endpoint health")
     |     ^^^^^^^^
1381 |     config_p = subparsers.add_parser("config", help="Show current configuration")
     |
help: Remove assignment to unused variable `health_p`

F841 Local variable `config_p` is assigned to but never used
    --> tools/rag/service.py:1381:5
     |
1379 |     # Health & diagnostics
1380 |     health_p = subparsers.add_parser("health", help="Check Ollama endpoint health")
1381 |     config_p = subparsers.add_parser("config", help="Show current configuration")
     |     ^^^^^^^^
1382 |
1383 |     failures_p = subparsers.add_parser("failures", help="Manage failure cache")
     |
help: Remove assignment to unused variable `config_p`

F841 Local variable `failures_show_p` is assigned to but never used
    --> tools/rag/service.py:1385:5
     |
1383 |     failures_p = subparsers.add_parser("failures", help="Manage failure cache")
1384 |     failures_sub = failures_p.add_subparsers(dest="failures_command")
1385 |     failures_show_p = failures_sub.add_parser("show", help="Show failures (default)")
     |     ^^^^^^^^^^^^^^^
1386 |     clear_fail_p = failures_sub.add_parser("clear", help="Clear failures")
1387 |     clear_fail_p.add_argument("--repo", help="Clear failures for specific repo only")
     |
help: Remove assignment to unused variable `failures_show_p`

F841 Local variable `force_p` is assigned to but never used
    --> tools/rag/service.py:1397:5
     |
1395 |     interval_p.add_argument("seconds", type=int, help="Interval in seconds")
1396 |
1397 |     force_p = subparsers.add_parser("force-cycle", help="Trigger immediate enrichment cycle")
     |     ^^^^^^^
1398 |
1399 |     exorcist_p = subparsers.add_parser("exorcist", help="Nuclear option: rebuild RAG database")
     |
help: Remove assignment to unused variable `force_p`

F841 Local variable `enable_p` is assigned to but never used
    --> tools/rag/service.py:1403:5
     |
1401 |     exorcist_p.add_argument("--dry-run", action="store_true", help="Show what would be deleted")
1402 |
1403 |     enable_p = subparsers.add_parser("enable", help="Enable service to start on boot")
     |     ^^^^^^^^
1404 |     disable_p = subparsers.add_parser("disable", help="Disable service from starting on boot")
     |
help: Remove assignment to unused variable `enable_p`

F841 Local variable `disable_p` is assigned to but never used
    --> tools/rag/service.py:1404:5
     |
1403 |     enable_p = subparsers.add_parser("enable", help="Enable service to start on boot")
1404 |     disable_p = subparsers.add_parser("disable", help="Disable service from starting on boot")
     |     ^^^^^^^^^
1405 |
1406 |     # Hidden internal command for systemd
     |
help: Remove assignment to unused variable `disable_p`

PLW2901 `for` loop variable `line` overwritten by assignment target
   --> tools/rag/utils.py:121:17
    |
119 |         try:
120 |             for line in cfg.read_text(encoding="utf-8", errors="ignore").splitlines():
121 |                 line = line.strip()
    |                 ^^^^
122 |                 if not line or line.startswith("#"):
123 |                     continue
    |

E731 Do not assign a `lambda` expression, use a `def`
   --> tools/rag/workers.py:438:13
    |
436 |                     low_items.append((item, decision))
437 |
438 |             key = lambda pair: pair[1].final_priority  # type: ignore[assignment]
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
439 |             high_items.sort(key=key, reverse=True)
440 |             mid_items.sort(key=key, reverse=True)
    |
help: Rewrite `key` as a `def`

PLW0127 Self-assignment of variable `UTC`
  --> tools/rag_daemon/models.py:90:1
   |
90 | UTC = UTC
   | ^^^
   |

B007 Loop control variable `dirs` not used within loop body
   --> tools/rag_daemon/scheduler.py:116:23
    |
114 |             deleted_count = 0
115 |
116 |             for root, dirs, files in os.walk(pycache_dir):
    |                       ^^^^
117 |                 for filename in files:
118 |                     filepath = Path(root) / filename
    |
help: Rename unused `dirs` to `_dirs`

F403 `from tools.rag import *` used; unable to detect undefined names
 --> tools/rag_nav/__init__.py:2:1
  |
1 | # Compatibility shim for tests - redirects to tools.rag
2 | from tools.rag import *
  | ^^^^^^^^^^^^^^^^^^^^^^^
  |

F841 Local variable `enriched_graph` is assigned to but never used
   --> tools/rag_nav/tool_handlers.py:321:9
    |
319 |     # as the source of truth for rag_graph.json.
320 |     try:
321 |         enriched_graph = build_enriched_schema_graph(repo_root_path)
    |         ^^^^^^^^^^^^^^
322 |         # Since build_enriched_schema_graph already saves the file, we can return status early
323 |         # However, to maintain compatibility with the existing function structure which
    |
help: Remove assignment to unused variable `enriched_graph`

Found 656 errors.
[*] 215 fixable with the `--fix` option (299 hidden fixes can be enabled with the `--unsafe-fixes` option).
