# RMTA Report - 2026-01-16

## Summary
- **Total Tools Tested:** 3
- **‚úÖ Working:** 2
- **‚ö†Ô∏è Buggy:** 0
- **‚ùå Broken:** 1
- **üö´ Not Tested:** 5 (Blocked)

## Bootstrap Validation
- Bootstrap tool available: ‚úÖ YES (`/api/v1/health`)
- Instructions accurate: ‚ö†Ô∏è PARTIAL. The API works, but is unusable due to configuration and indexing issues not mentioned in the HLD.
- Issues found: 
  - The health check response initially showed an empty `workspaces` list. This was because the `[mcp.rest_api]` and `[mcp.workspaces]` sections were missing from the default `llmc.toml` configuration. This is a P1 bug as the feature should be configured by default. I manually added the config to proceed with testing.

## Test Results

### Working Tools (‚úÖ)
- `GET /api/v1/health`: Responded with `{"status":"ok"}` and correct schema. Initially showed no workspaces, but worked correctly after `llmc.toml` was fixed.
- `GET /api/v1/workspaces`: Responded with correct schema, but revealed that the default `llmc` workspace is not indexed (`"indexed": false`), which was the start of a deeper issue.

### Buggy Tools (‚ö†Ô∏è)
<list each buggy tool with specific issues>

### Broken Tools (‚ùå)
- `GET /api/v1/workspaces/{id}/search`: Returned a `500 Internal Server Error` instead of the documented `503 index_not_found` error when the index does not exist. This is blocked by RMTA-004.

### Not Tested (üö´)
- `GET /api/v1/workspaces/{id}/symbols/{name}`
- `GET /api/v1/workspaces/{id}/symbols/{name}/references`
- `GET /api/v1/workspaces/{id}/symbols/{name}/lineage`
- `GET /api/v1/workspaces/{id}/files/{path:path}`
- All other stub tools (non-REST)

Reason: Testing is blocked by a critical bug (RMTA-004) where the API does not recognize the indexed workspace.

## Incidents (Prioritized)

---

### RMTA-001: [P1] REST API enabled but not configured by default
**Tool:** All REST API v1 endpoints
**Severity:** P1 (High)

**What I Tried:**
1. Started the MCP daemon on the `feature/rest-api-v1` branch.
2. Called the `GET /api/v1/health` endpoint.

**Expected:**
Based on the HLD, I expected to see a list of default workspaces, allowing me to test the search and other endpoints.

**Actual:**
The API responded with `"workspaces": []`. The `llmc.toml` file was missing the `[mcp.rest_api]` and `[mcp.workspaces]` configuration sections entirely. The feature, while merged, is not enabled or configured by default.

**Evidence:**
```json
// Initial health check response
{"status":"ok","version":"1.0.0","api":"rest","workspaces":[],"timestamp":"2026-01-16T21:43:28.333520+00:00"}
```
**Fix:**
Manually appended the following to `llmc.toml` and restarted the daemon:
```toml
[mcp.rest_api]
enabled = true

[mcp.workspaces]
default = "llmc"

[mcp.workspaces.repos]
llmc = "/home/vmlinux/src/llmc"
```

---

### RMTA-002: [P2] Configured workspace is not indexed by default
**Tool:** All RAG-related REST API v1 endpoints
**Severity:** P2 (Medium)

**What I Tried:**
After fixing the config and restarting the daemon, I called `GET /api/v1/workspaces`.

**Expected:**
I expected the default workspace to be indexed or for the documentation to clearly state that manual indexing is required after initial setup.

**Actual:**
The `llmc` workspace was discovered but reported `"indexed": false`. This prevents any RAG-related API endpoints from being tested. An agent or new user would be blocked at this point.

**Evidence:**
```json
// /api/v1/workspaces response
{"workspaces":[{"id":"llmc","path":"/home/vmlinux/src/llmc","indexed":false,"span_count":null,"last_indexed":null}],"default":"llmc"}
```
---

### RMTA-003: [P2] Search on unindexed workspace returns 500 instead of 503
**Tool:** `GET /api/v1/workspaces/{id}/search`
**Severity:** P2 (Medium)

**What I Tried:**
I sent a search request to the `llmc` workspace, which I knew was not indexed.

**Expected:**
The HLD for the REST API specifies that a `503 Service Unavailable` with error code `index_not_found` should be returned.

**Actual:**
The server returned a `500 Internal Server Error` with a generic `internal_error` code. This does not follow the API contract and hides the true cause of the error from the client.

**Evidence:**
```
HTTP/1.1 500 Internal Server Error
...
{"error":{"code":"internal_error","message":"An unexpected error occurred",...}}
```
---

### RMTA-004: [P0] API does not recognize indexed workspace, blocking all RAG endpoints
**Tool:** All RAG-related REST API v1 endpoints
**Severity:** P0 (Critical)

**What I Tried:**
1. After discovering the workspace was not indexed (RMTA-002), I ran `llmc-cli repo bootstrap .` which completed successfully and reported that it indexed the files.
2. To ensure the daemon picked up the changes, I stopped and restarted it.
3. I called `GET /api/v1/workspaces` again.

**Expected:**
The API should report `"indexed": true` for the `llmc` workspace, allowing me to proceed with testing search and other RAG endpoints.

**Actual:**
The API persistently reports `"indexed": false`, even after a successful bootstrap and a daemon restart. This indicates a fundamental disconnect between the indexing process and the API's status checking. This bug blocks all further testing of the core RAG features of the REST API.

**Evidence:**
```bash
# After bootstrap and restart, the API still reports the same thing:
$ curl -s http://127.0.0.1:8765/api/v1/workspaces
{"workspaces":[{"id":"llmc","path":"/home/vmlinux/src/llmc","indexed":false,"span_count":null,"last_indexed":null}],"default":"llmc"}
```
---

## Documentation Drift
- The `HLD-REST-API-v1.md` is drifted from the implementation in several ways:
  - It assumes the feature is configured by default, which it is not (RMTA-001).
  - It does not mention the need for manual indexing (RMTA-002).
  - The error handling for unindexed workspaces is incorrect (RMTA-003).

## Recommendations

**P0 - Critical:**
1.  **Fix the index detection logic (RMTA-004):** The REST API must be able to correctly identify when a workspace has been indexed. This is the highest priority as it blocks the entire feature.

**P1 - High:**
1.  **Enable and configure the REST API by default (RMTA-001):** A newly checked out repository on this feature branch should have a working REST API without manual `llmc.toml` edits.

**P2 - Medium:**
1.  **Provide a clear path to indexing (RMTA-002):** The `repo bootstrap` command should be mentioned in the feature's documentation, and it should reliably cause the API to see the index as "ready".
2.  **Fix error handling for unindexed search (RMTA-003):** The API should return the documented `503 index_not_found` error, not a generic `500`.


## RMTA's Verdict
**BLOCKER.** The v1 REST API is fundamentally broken from an agent/user perspective. While the `/health` and `/workspaces` endpoints function, the core value proposition (RAG search) is completely inaccessible due to a critical bug preventing the API from recognizing an indexed workspace. The setup experience is also poor, requiring manual configuration file edits and undocumented indexing steps. The combination of these issues makes the feature unusable in its current state.
