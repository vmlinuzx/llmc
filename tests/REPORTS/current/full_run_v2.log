.........................................F
=================================== FAILURES ===================================
___________________ TestExecuteCode.test_call_tool_injection ___________________

self = <test_code_exec.TestExecuteCode object at 0x7fbd3c6c5430>

        def test_call_tool_injection(self):
            """Verify _call_tool is available in executed code namespace."""
            mock_caller = make_mock_tool_caller(
                {"test_tool": {"data": "mock_result", "meta": {}}}
            )

            result = execute_code(
                code="""
    result = _call_tool("test_tool", {"arg": "value"})
    print(f"Got: {result}")
    """,
                tool_caller=mock_caller,
            )
>           assert result.success
E           assert False
E            +  where False = CodeExecResult(success=False, stdout='', stderr='Traceback (most recent call last):\n  File "/tmp/tmpi7zdjmrp.py", lin...   ^^^^^^^^^^\nNameError: name \'_call_tool\' is not defined\n', return_value=None, error='Process exited with code 1').success

/app/tests/mcp/test_code_exec.py:56: AssertionError
=========================== short test summary info ============================
FAILED tests/mcp/test_code_exec.py::TestExecuteCode::test_call_tool_injection
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 41 passed, 1 skipped, 1 warning in 3.22s
