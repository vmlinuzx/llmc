# LLMC Agent Instructions

> **Drop this line in your AGENTS.md / CLINE.md / GEMINI.md:**
> `Read and follow ~/.llmc/LLMCAGENTS.md OR <repo>/.llmc/LLMCAGENTS.md before using LLMC tools.`

## What is LLMC?

LLMC (LLM Cost Compression) is a local RAG (Retrieval Augmented Generation) system that indexes, enriches, and embeds codebases. It gives you semantic search over code without burning API tokens.

**You have access to LLMC via CLI commands.** Use them to search code, get context, and understand projects.

---

## üöÄ Bootstrap (Start Here)

Before doing ANY code work in a repo, run these two commands:

```bash
# 1. Check if repo is set up for LLMC
llmc repo list

# 2. Search for relevant code (your first query)
cd /path/to/repo && rag search "your topic"
```

**If the repo isn't listed:** Run `llmc repo add /path/to/repo` to bootstrap it.

---

## üìã Core Commands (80% of usage)

### Semantic Search
```bash
# Search enriched code summaries (fast, uses local embeddings)
rag search "authentication flow"
rag search "database connection" --limit 10

# Full-text search in code content
rag grep "def process_"
```

### Get Context for a File
```bash
# See what's in a specific file (summaries + structure)
rag query --file src/auth/handler.py

# Get related files to understand context
rag related src/auth/handler.py
```

### Repository Health
```bash
# Quick health check for current repo
rag doctor

# Detailed stats
rag stats
```

---

## üéØ Progressive Disclosure Rules

**DO NOT** dump all commands at once. Follow these rules:

1. **Start with `rag search`** for any new topic
2. **Only use `rag query --file`** when you need deeper context on a specific file
3. **Use `rag grep`** for exact string matches (function names, imports, etc.)
4. **Check `rag doctor`** if searches return empty or stale results

### When to Use Which Command

| Goal | Command |
|------|---------|
| "Find code related to X" | `rag search "X"` |
| "Find exact function name" | `rag grep "function_name"` |
| "Understand this file" | `rag query --file path/to/file.py` |
| "What files relate to this?" | `rag related path/to/file.py` |
| "Is the index healthy?" | `rag doctor` |
| "How big is the index?" | `rag stats` |

---

## üîß Advanced Commands (Use Sparingly)

### Force Re-index
```bash
# Re-index a file after major changes
rag index --force

# Re-enrich (regenerate summaries)
rag enrich --force
```

### Service Management
```bash
# Check daemon status (handles background enrichment)
llmc service status

# View enrichment logs
llmc service logs -f
```

### MCP Mode (Optional)
If the repo has MCP configured, you can use the bootstrap tool:
```bash
llmc mcp bootstrap  # Discover all available tools
```

---

## üß† Token-Saving Guidelines

1. **Never query the entire codebase** - Always filter by topic or file
2. **Limit search results** - Use `--limit 5` unless you need more
3. **Prefer summaries over raw code** - `rag search` returns enriched summaries
4. **Use progressive refinement** - Start broad, then narrow down

### Example Workflow

```bash
# Step 1: Broad search
rag search "user authentication"

# Step 2: Found auth/handler.py looks relevant, get details
rag query --file src/auth/handler.py

# Step 3: Need exact import, use grep
rag grep "from auth import"
```

---

## ‚ùå Anti-Patterns

**DON'T:**
- Run `rag search` with no query or very broad terms
- Dump entire file contents when summaries suffice
- Skip checking `rag doctor` when results seem wrong
- Ignore the daemon (`llmc service status`) if enrichment seems stale

**DO:**
- Start with specific queries
- Use `--limit` to control output size
- Check index health when things seem off
- Trust the summaries - they're generated by LLMs specifically for code understanding

---

## üè• Troubleshooting

### "No results found"
```bash
rag doctor  # Check index health
llmc service status  # Is daemon running?
```

### "Results seem stale"
```bash
llmc service restart  # Trigger re-enrichment
rag doctor --verbose  # See pending work
```

### "Repo not recognized"
```bash
llmc repo add .  # Bootstrap the repo
llmc repo validate .  # Check config
```

---

## üìç Quick Reference

```
rag search "query"          ‚Üí Semantic search (start here!)
rag grep "pattern"          ‚Üí Exact text search
rag query --file FILE       ‚Üí File context
rag related FILE            ‚Üí Related files
rag doctor                  ‚Üí Health check
rag stats                   ‚Üí Index statistics
llmc service status         ‚Üí Daemon + repo health
llmc repo add PATH          ‚Üí Bootstrap new repo
```

---

*This file is auto-installed by `llmc repo add`. Version: 2025-12-06*
