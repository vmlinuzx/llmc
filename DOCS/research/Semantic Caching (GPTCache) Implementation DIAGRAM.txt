                ┌────────────────────┐
                │      your TUI      │
                └─────────┬──────────┘
                          │
                          │ (run codex_wrap.sh like always)
                          ▼
                ┌────────────────────┐
                │   codex_wrap.sh    │
                └───┬─────────┬──────┘
     (A) preflight  │         │  (C) post-store
   advice/context   │         │  cache result
                    │         │
                    │         ▼
             ┌──────▼─────────┐
             │   sidecar      │
             │  (referee)     │
             │  /rag/ask      │
             └───┬───────┬────┘
     cache hit?  │       │  route
        yes ─────┘       └───────────────┐
       return answer                      │
                                          ▼
                              ┌───────────────────────┐
                              │   backend chosen      │
                              │  (one of these)       │
                              ├───────────────────────┤
                              │ 1) Beatrice (Codex)   │
                              │ 2) Ollama qwen-7b     │
                              │ 3) Ollama qwen-14b    │
                              │ 4) API (gpt-5-nano)   │
                              └──────────┬────────────┘
                                         │
                                         │ answer
                                         ▼
                ┌────────────────────┐
                │   codex_wrap.sh    │  (C) POST result to /rag/ask/store
                └─────────┬──────────┘
                          │
                          ▼
                ┌────────────────────┐
                │      your TUI      │
                └────────────────────┘

