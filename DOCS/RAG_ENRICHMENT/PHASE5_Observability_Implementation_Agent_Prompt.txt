You are the implementation agent applying Phase 5 (observability and QoL)
changes to the LLMC enrichment CLI.

Repo snapshot: llmc tree from `llmc-20251123-004221.zip`, with Phases 0â€“4
already applied and green.

## Goal

Modify `scripts/qwen_enrich_batch.py` to:

- Add a per-run summary line.
- Optionally write a JSON summary (`LLMC_ENRICH_SUMMARY_JSON`).
- Add a `--dry-run-plan` mode to show planned spans and exit.
- Add `LLMC_ENRICH_FORCE_LEGACY` and `LLMC_ENRICH_STRICT_CONFIG` env toggles
  for config handling.

## Files in this patch bundle

- `scripts/qwen_enrich_batch.py.patch`
- `DOCS/RAG_ENRICHMENT/SDD_Enrichment_Pipeline_Observability_Phase5.md`
- `DOCS/RAG_ENRICHMENT/SDD_Enrichment_Pipeline_Observability_Phase5_Impl.md`
- `DOCS/RAG_ENRICHMENT/ENRICHMENT_PIPELINE_PHASE5_Operator_Guide.md`

## Implementation Steps (GitHub best practices)

1. **Create a feature branch**

   ```bash
   git checkout -b feature/enrichment-phase5-observability
   ```

2. **Apply the patch**

   From the repo root:

   ```bash
   git apply --check scripts/qwen_enrich_batch.py.patch
   git apply scripts/qwen_enrich_batch.py.patch
   ```

   If `git apply --check` fails, stop and surface the conflict instead of
   trying to edit the file manually.

3. **Review the changes**

   ```bash
   git diff
   ```

   Confirm that:
   - Only `scripts/qwen_enrich_batch.py` is modified.
   - Changes are small and additive (no mass deletions).

4. **Run tests**

   ```bash
   pytest tests/test_enrichment_integration.py -vv
   pytest tests/test_enrichment_batch.py -vv
   pytest tests -q
   ```

5. **Manual smoke tests**

   - Normal run:

     ```bash
     python scripts/qwen_enrich_batch.py --repo . --verbose
     ```

     Confirm a final summary line appears and, if you set
     `LLMC_ENRICH_SUMMARY_JSON`, that the JSON file is written.

   - Dry-run plan:

     ```bash
     python scripts/qwen_enrich_batch.py --repo . --dry-run-plan --max-spans 5
     ```

   - Strict config and force legacy:

     ```bash
     LLMC_ENRICH_STRICT_CONFIG=1 python scripts/qwen_enrich_batch.py --repo .
     LLMC_ENRICH_FORCE_LEGACY=1 python scripts/qwen_enrich_batch.py --repo . --verbose
     ```

6. **Commit**

   ```bash
   git add scripts/qwen_enrich_batch.py DOCS/RAG_ENRICHMENT/*.md
   git commit -m "Enrichment Phase 5: observability and config safety toggles"
   ```

7. **Open a PR**

   - Title: `Enrichment Phase 5: Observability & Config Safety`
   - Link to:
     - `DOCS/RAG_ENRICHMENT/SDD_Enrichment_Pipeline_Observability_Phase5.md`
   - Summarize the new flags/env vars and how to use them.
